"use strict";var e=require("../../ui-react/with-schemas/index.cjs"),l=require("react");const t=e=>typeof e,s=t(""),n=t(!0),a=t(0),o="Value",r="currentTarget",u="value",i=Math.min,d=isFinite,c=e=>null==e,m=(e,l,t,n)=>e==s?l:e==a?t:n,{PureComponent:b,Fragment:I,createContext:p,createElement:C,useCallback:h,useContext:g,useEffect:y,useLayoutEffect:v,useMemo:w,useRef:f,useState:T,useSyncExternalStore:R}=l,k=(e,...l)=>c(e)?{}:e(...l),S=(e,l)=>e.map(l),x=Object,O=x.entries,N=(e=[])=>x.fromEntries(e),V=(e,l)=>S(O(e),(([e,t])=>l(t,e)));var q=Object.defineProperty,P=Object.defineProperties,E=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,A=(e,l,t)=>l in e?q(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,F=(e,l)=>{for(var t in l||(l={}))H.call(l,t)&&A(e,t,l[t]);if(j)for(var t of j(l))B.call(l,t)&&A(e,t,l[t]);return e},L=(e,l)=>P(e,E(l)),M=(e,l)=>{var t={};for(var s in e)H.call(e,s)&&l.indexOf(s)<0&&(t[s]=e[s]);if(null!=e&&j)for(var s of j(e))l.indexOf(s)<0&&B.call(e,s)&&(t[s]=e[s]);return t};const D="editable",$=(l,t)=>S(e.useTableCellIds(l,t),(e=>l+"."+e)),z=(e,l,t)=>{const s=h(e,l);return t?s:void 0},G=(...e)=>w((()=>e),e),J=(e,l)=>w((()=>({store:e,tableId:l})),[e,l]),K=(e,l)=>w((()=>({queries:e,queryId:l})),[e,l]),Q=(e,l=!1,t,s=0,n,a,o,r)=>{const[[u,i,d],c]=T([e,l,s]),m=h((e=>{c(e),null==r||r(e)}),[r]),b=z((e=>m([e,e==u&&!i,d])),[m,u,i,d],t),I=h((e=>m([u,i,e])),[m,u,i]),p=!0===o?le:o;return[[u,i,d],b,w((()=>!1===o?null:C(p,{offset:d,limit:n,total:a,onChange:I})),[o,p,d,n,a,I])]},U=(e,l,n)=>w((()=>{const a=null!=l?l:e;return o=Array.isArray(a)?N(S(a,(e=>[e,e]))):a,r=(e,l)=>F(F({},{label:l,component:n}),t(e)==s?{label:e}:e),N(V(o,((e,l)=>[l,r(e,l)])));var o,r}),[l,n,e]),W=({className:e,headerRow:l,idColumn:t,params:[s,n,a,o,r,u]})=>C("table",{className:e},u?C("caption",null,u):null,!1===l?null:C("thead",null,C("tr",null,!1===t?null:C(X,{sort:null!=o?o:[],label:"Id",onClick:r}),V(s,(({label:e},l)=>C(X,{key:l,cellId:l,label:e,sort:null!=o?o:[],onClick:r}))))),C("tbody",null,S(a,(e=>C("tr",{key:e},!1===t?null:C("th",null,e),V(s,(({component:l,getComponentProps:t},s)=>C("td",{key:s},C(l,L(F(F({},k(t,e,s)),n),{rowId:e,cellId:s})))))))))),X=({cellId:e,sort:[l,t],label:s=(null!=e?e:""),onClick:n})=>C("th",{onClick:z((()=>null==n?void 0:n(e)),[n,e],n),className:c(t)||l!=e?void 0:`sorted ${t?"de":"a"}scending`},c(t)||l!=e?null:(t?"↓":"↑")+" ",s),Y=({localRowId:l,params:[t,s,n,a,o,r,u]})=>{const i=e.useRemoteRowId(o,l,r);return C("tr",null,!1===t?null:C(I,null,C("th",null,l),C("th",null,i)),V(s,(({component:e,getComponentProps:t},s)=>{const[o,r]=((e,l="",t)=>e.split(l,t))(s,".",2),d=o===n?l:o===a?i:null;return c(d)?null:C("td",{key:s},C(e,L(F({},k(t,d,r)),{store:u,tableId:o,rowId:d,cellId:r})))})))},Z=({thing:e,onThingChange:l,className:o,hasSchema:i,showType:c=!0})=>{const[b,I]=T(),[p,g]=T(),[y,v]=T(),[w,f]=T(),[R,k]=T();p!==e&&(I((e=>{const l=t(e);return(e=>e==s||e==n)(l)||l==a&&d(e)?l:void 0})(e)),g(e),v(e+""),f(Number(e)||0),k(!!e));const S=h(((e,t)=>{t(e),g(e),l(e)}),[l]),x=h((()=>{if(!(null==i?void 0:i())){const e=m(b,a,n,s),t=m(e,y,w,R);I(e),g(t),l(t)}}),[i,l,y,w,R,b]);return C("div",{className:o},c?C("button",{className:b,onClick:x},b):null,m(b,C("input",{key:b,value:y,onChange:h((e=>S(e[r][u]+"",v)),[S])}),C("input",{key:b,type:"number",value:w,onChange:h((e=>S(Number(e[r][u]||0),f)),[S])}),C("input",{key:b,type:"checkbox",checked:R,onChange:h((e=>S(!!e[r].checked,k)),[S])})))},_=({tableId:l,rowId:t,cellId:s,store:n,className:a,showType:o})=>{var r;return C(Z,{thing:e.useCell(l,t,s,n),onThingChange:e.useSetCellCallback(l,t,s,(e=>e),[],n),className:null!=a?a:D+"Cell",showType:o,hasSchema:null==(r=e.useStoreOrStoreById(n))?void 0:r.hasTablesSchema})},ee=({valueId:l,store:t,className:s,showType:n})=>{var a;return C(Z,{thing:e.useValue(l,t),onThingChange:e.useSetValueCallback(l,(e=>e),[],t),className:null!=s?s:D+o,showType:n,hasSchema:null==(a=e.useStoreOrStoreById(t))?void 0:a.hasValuesSchema})},le=({onChange:e,total:l,offset:t=0,limit:s=l,singular:n="row",plural:a=n+"s"})=>{(t>l||t<0)&&(t=0,e(0));const o=z((()=>e(t-s)),[e,t,s],t>0),r=z((()=>e(t+s)),[e,t,s],t+s<l);return C(I,null,l>s&&C(I,null,C("button",{className:"previous",disabled:0==t,onClick:o},"←"),C("button",{className:"next",disabled:t+s>=l,onClick:r},"→"),t+1," to ",i(l,t+s)," of "),l," ",1!=l?a:n)};exports.EditableCellView=_,exports.EditableValueView=ee,exports.RelationshipInHtmlTable=({relationshipId:l,relationships:t,editable:s,customCells:n,className:a,headerRow:o,idColumn:r=!0})=>{const[u,i,d,c]=((e,l)=>[e,null==e?void 0:e.getStore(),null==e?void 0:e.getLocalTableId(l),null==e?void 0:e.getRemoteTableId(l)])(e.useRelationshipsOrRelationshipsById(t),l),m=U([...$(d,i),...$(c,i)],n,s?_:e.CellView),b=G(r,m,d,c,l,u,i);return C("table",{className:a},!1===o?null:C("thead",null,C("tr",null,!1===r?null:C(I,null,C("th",null,d,".Id"),C("th",null,c,".Id")),V(m,(({label:e},l)=>C("th",{key:l},e))))),C("tbody",null,S(e.useRowIds(d,i),(e=>C(Y,{key:e,localRowId:e,params:b})))))},exports.ResultSortedTableInHtmlTable=l=>{var t=l,{queryId:s,cellId:n,descending:a,offset:o,limit:r,queries:u,sortOnClick:i,paginator:d=!1,customCells:c,onChange:m}=t,b=M(t,["queryId","cellId","descending","offset","limit","queries","sortOnClick","paginator","customCells","onChange"]);const[I,p,h]=Q(n,a,i,o,r,e.useResultRowCount(s,u),d,m);return C(W,L(F({},b),{params:G(U(e.useResultTableCellIds(s,u),c,e.ResultCellView),K(u,s),e.useResultSortedRowIds(s,...I,r,u),I,p,h)}))},exports.ResultTableInHtmlTable=l=>{var t=l,{queryId:s,queries:n,customCells:a}=t,o=M(t,["queryId","queries","customCells"]);return C(W,L(F({},o),{params:G(U(e.useResultTableCellIds(s,n),a,e.ResultCellView),K(n,s),e.useResultRowIds(s,n))}))},exports.SliceInHtmlTable=l=>{var t=l,{indexId:s,sliceId:n,indexes:a,editable:o,customCells:r}=t,u=M(t,["indexId","sliceId","indexes","editable","customCells"]);const[i,d,c]=((e,l)=>[e,null==e?void 0:e.getStore(),null==e?void 0:e.getTableId(l)])(e.useIndexesOrIndexesById(a),s);return C(W,L(F({},u),{params:G(U(e.useTableCellIds(c,d),r,o?_:e.CellView),J(d,c),e.useSliceRowIds(s,n,i))}))},exports.SortedTableInHtmlTable=l=>{var t=l,{tableId:s,cellId:n,descending:a,offset:o,limit:r,store:u,editable:i,sortOnClick:d,paginator:c=!1,onChange:m,customCells:b}=t,I=M(t,["tableId","cellId","descending","offset","limit","store","editable","sortOnClick","paginator","onChange","customCells"]);const[p,h,g]=Q(n,a,d,o,r,e.useRowCount(s,u),c,m);return C(W,L(F({},I),{params:G(U(e.useTableCellIds(s,u),b,i?_:e.CellView),J(u,s),e.useSortedRowIds(s,...p,r,u),p,h,g)}))},exports.SortedTablePaginator=le,exports.TableInHtmlTable=l=>{var t=l,{tableId:s,store:n,editable:a,customCells:o}=t,r=M(t,["tableId","store","editable","customCells"]);return C(W,L(F({},r),{params:G(U(e.useTableCellIds(s,n),o,a?_:e.CellView),J(n,s),e.useRowIds(s,n))}))},exports.ValuesInHtmlTable=({store:l,editable:t=!1,valueComponent:s=(t?ee:e.ValueView),getValueComponentProps:n,className:a,headerRow:r,idColumn:u})=>C("table",{className:a},!1===r?null:C("thead",null,C("tr",null,!1===u?null:C("th",null,"Id"),C("th",null,o))),C("tbody",null,S(e.useValueIds(l),(e=>C("tr",{key:e},!1===u?null:C("th",null,e),C("td",null,C(s,L(F({},k(n,e)),{valueId:e,store:l}))))))));
