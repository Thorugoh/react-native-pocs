"use strict";const e=e=>typeof e,t="",s=e(t),n=e=>t+e,r=e=>null==e,o=(e,t,s)=>r(e)?s?.():t(e),c=e=>Array.isArray(e),d=e=>e.length,l=(e,t)=>e.every(t),a=(e,t)=>l(e,((s,n)=>0==n||t(e[n-1],s)<=0)),i=(e,t)=>e.sort(t),u=(e,t)=>e.forEach(t),I=(e,...t)=>e.push(...t),h=Object.freeze,f=e=>t=>{return s=(t,s)=>t+e(s),x(t).reduce(s,0);var s},g=e=>e?.size??0,v=f(g),w=f(v),L=(e,t)=>e?.has(t)??!1,S=e=>r(e)||0==g(e),x=e=>[...e?.values()??[]],p=e=>e.clear(),y=(e,t)=>e?.forEach(t),R=(e,t)=>e?.delete(t),E=e=>new Map(e),b=e=>[...e?.keys()??[]],T=(e,t)=>e?.get(t),k=(e,t)=>y(e,((e,s)=>t(s,e))),z=(e,t,s)=>r(s)?(R(e,t),e):e?.set(t,s),A=(e,t,s,n)=>(L(e,t)?n?.(T(e,t)):z(e,t,s()),T(e,t)),C=(e,t,s,n,r=0)=>o((s?A:T)(e,t[r],r>d(t)-2?s:E),(o=>{if(r>d(t)-2)return n?.(o)&&z(e,t[r]),o;const c=C(o,t,s,n,r+1);return S(o)&&z(e,t[r]),c})),D=e=>new Set(c(e)||r(e)?e:[e]),M=(e,t)=>e?.add(t),j=(n,r)=>e(n)==s?e=>e(n):n??(()=>r??t),m=(e,t)=>(e??0)<(t??0)?-1:1,O=/^\d+$/,W=(()=>{const e=new WeakMap;return s=>(e.has(s)||e.set(s,(e=>{const s=E(),f=E(),[g,W,$]=(()=>{let e;const[s,n]=(()=>{const e=[];let s=0;return[n=>(n?e.shift():null)??t+s++,t=>{O.test(t)&&d(e)<1e3&&I(e,t)}]})(),c=E();return[(n,r,o,d=[],l=()=>[])=>{e??=X;const a=s(1);return z(c,a,[n,r,o,d,l]),M(C(r,o??[t],D),a),a},(s,n,...r)=>u(((e,s=[t])=>{const n=[],r=(e,t)=>t==d(s)?I(n,e):null===s[t]?y(e,(e=>r(e,t+1))):u([s[t],null],(s=>r(T(e,s),t+1)));return r(e,0),n})(s,n),(t=>y(t,(t=>T(c,t)[0](e,...n??[],...r))))),e=>o(T(c,e),(([,s,r])=>(C(s,r??[t],void 0,(t=>(R(t,e),S(t)?1:0))),z(c,e),n(e),r))),t=>o(T(c,t),(([t,,s=[],n,o])=>{const c=(...l)=>{const a=d(l);a==d(s)?t(e,...l,...o(l)):r(s[a])?u(n[a]?.(...l)??[],(e=>c(...l,e))):c(...l,s[a])};c()}))]})(),[q,B,F,G,H,J,K,,N,P,Q,U]=((e,t,s,n,a)=>{const i=e.hasRow,I=E(),h=E(),f=E(),g=E(),v=E(),w=E(),C=(t,s,...n)=>{const r=A(w,t,D);return u(n,(t=>M(r,t)&&s&&e.callListener(t))),n},j=(t,...s)=>o(T(w,t),(n=>{u(0==d(s)?x(n):s,(t=>{e.delListener(t),R(n,t)})),S(n)&&z(w,t)})),m=(e,s)=>{z(I,e,s),L(h,e)||(z(h,e,t()),z(g,e,E()),z(v,e,E()),a(f))},O=e=>{z(I,e),z(h,e),z(g,e),z(v,e),j(e),a(f)};return[()=>e,()=>b(I),e=>k(h,e),e=>L(h,e),e=>T(I,e),e=>T(h,e),(e,t)=>z(h,e,t),m,(t,n,o,a,I)=>{m(t,n);const h=E(),f=E(),w=T(g,t),S=T(v,t),x=t=>{const o=s=>e.getCell(n,t,s),u=T(w,t),g=i(n,t)?s(a(o,t)):void 0;var v,L;if(u===g||c(u)&&c(g)&&(L=g,d(v=u)===d(L)&&l(v,((e,t)=>L[t]===e)))||z(h,t,[u,g]),!r(I)){const e=T(S,t),s=i(n,t)?I(o,t):void 0;e!=s&&z(f,t,s)}},R=e=>{o((()=>{y(h,(([,e],t)=>z(w,t,e))),y(f,((e,t)=>z(S,t,e)))}),h,f,w,S,e),p(h),p(f)};k(w,x),e.hasTable(n)&&u(e.getRowIds(n),(e=>{L(w,e)||x(e)})),R(!0),j(t),C(t,0,e.addRowListener(n,null,((e,t,s)=>x(s))),e.addTableListener(n,(()=>R())))},O,e=>n(e,f),()=>k(w,O),C,j]})(e,E,(e=>{return r(e)?t:c(e)?(s=n,e.map(s)):n(e);var s}),g,W),V=(t,s,n)=>{const r=H(t);y(n,((t,n)=>s(n,(s=>y(t,(t=>s(t,(s=>e.forEachCell(r,t,s)))))))))},X={setIndexDefinition:(e,t,n,c,d,l=m)=>{const u=r(d)?void 0:([e],[t])=>d(e,t);return N(e,t,((t,n,d,I,h,g)=>{let v=0;const w=D(),x=D(),p=J(e);if(y(n,(([e,t],s)=>{const n=D(e),d=D(t);y(n,(e=>R(d,e)?R(n,e):0)),y(n,(e=>{M(w,e),o(T(p,e),(t=>{R(t,s),S(t)&&(z(p,e),v=1)}))})),y(d,(e=>{M(w,e),L(p,e)||(z(p,e,D()),v=1),M(T(p,e),s),r(c)||M(x,e)}))})),t(),S(h)||(g?k(p,(e=>M(x,e))):k(d,(e=>o(T(I,e),(e=>M(x,e))))),y(x,(e=>{const t=(t,s)=>l(T(h,t),T(h,s),e),s=[...T(p,e)];a(s,t)||(z(p,e,D(i(s,t))),M(w,e))}))),(v||g)&&!r(u)){const t=[...p];a(t,u)||(K(e,E(i(t,u))),v=1)}v&&W(s,[e]),y(w,(t=>W(f,[e,t])))}),j(n),o(c,j)),X},delIndexDefinition:e=>(P(e),X),getStore:q,getIndexIds:B,forEachIndex:e=>F(((t,s)=>e(t,(e=>V(t,e,s))))),forEachSlice:(e,t)=>V(e,t,J(e)),hasIndex:G,hasSlice:(e,t)=>L(J(e),t),getTableId:H,getSliceIds:e=>b(J(e)),getSliceRowIds:(e,t)=>x(T(J(e),t)),addIndexIdsListener:Q,addSliceIdsListener:(e,t)=>g(t,s,[e]),addSliceRowIdsListener:(e,t,s)=>g(s,f,[e,t]),delListener:e=>($(e),X),destroy:U,getListenerStats:()=>({sliceIds:v(s),sliceRowIds:w(f)})};return h(X)})(s)),e.get(s))})();exports.createIndexes=W;
