"use strict";const e=e=>null==e,t=(t,s,n)=>e(t)?n?.():s(t),s=(e,t,s)=>e.slice(t,s),n=Object.freeze,r=(e,t)=>e?.delete(t),c=e=>new Map(e),o=(e,t)=>e?.get(t),a=(t,s,n)=>e(n)?(r(t,s),t):t?.set(s,n),l=/\/([^?]*)/;exports.createWsServerSimple=i=>{const u=c();return i.on("connection",((n,i)=>{return t((d=i.url,v=l,d?.match(v)),(([,l])=>t(i.headers["sec-websocket-key"],(async t=>{const i=(S=c,f=d=u,g=v=l,f?.has(g)||a(d,v,S()),o(d,v));var d,v,S,f,g;a(i,t,n),n.on("message",(e=>(e=>{const n=e.indexOf("\n");-1!==n&&((e,s)=>{const n=((e,t)=>e+"\n"+t)(t,s);""===e?(e=>{((e,t)=>{e?.forEach(t)})(e,((e,s)=>{return r=e,s!==t?r.send(n):0;var r}))})(i):o(i,e)?.send(n)})(s(e,0,n),s(e,n+1))})(e.toString("utf8")))),n.on("close",(()=>{r(i,t),(t=>e(t)||0==(e=>e?.size??0)(t))(i)&&r(u,l)}))}))));var d,v})),n({getWebSocketServer:()=>i,destroy:()=>{u.clear(),i.close()}})};
