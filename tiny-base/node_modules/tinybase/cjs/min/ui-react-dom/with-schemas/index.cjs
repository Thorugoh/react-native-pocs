"use strict";var e=require("../../ui-react/with-schemas/index.cjs"),l=require("react");const t=e=>typeof e,s=t(""),a=t(!0),n=t(0),o="Value",u="currentTarget",r="value",d=Math.min,i=isFinite,c=e=>null==e,m=(e,l,t,a)=>e==s?l:e==n?t:a,{PureComponent:b,Fragment:I,createContext:h,createElement:C,useCallback:p,useContext:g,useEffect:w,useLayoutEffect:y,useMemo:T,useRef:R,useState:k,useSyncExternalStore:S}=l,x=(e,...l)=>c(e)?{}:e(...l),N=(e,l)=>e.map(l),V=Object,f=V.entries,v=(e=[])=>V.fromEntries(e),q=(e,l)=>N(f(e),(([e,t])=>l(t,e))),E="editable",H=(l,t)=>N(e.useTableCellIds(l,t),(e=>l+"."+e)),O=(e,l,t)=>{const s=p(e,l);return t?s:void 0},P=(...e)=>T((()=>e),e),B=(e,l)=>T((()=>({store:e,tableId:l})),[e,l]),A=(e,l)=>T((()=>({queries:e,queryId:l})),[e,l]),F=(e,l=!1,t,s=0,a,n,o,u)=>{const[[r,d,i],c]=k([e,l,s]),m=p((e=>{c(e),u?.(e)}),[u]),b=O((e=>m([e,e==r&&!d,i])),[m,r,d,i],t),I=p((e=>m([r,d,e])),[m,r,d]),h=!0===o?J:o;return[[r,d,i],b,T((()=>!1===o?null:C(h,{offset:i,limit:a,total:n,onChange:I})),[o,h,i,a,n,I])]},L=(e,l,a)=>T((()=>{const n=l??e;return o=Array.isArray(n)?v(N(n,(e=>[e,e]))):n,u=(e,l)=>{return{label:l,component:a,...(n=e,t(n)==s?{label:e}:e)};var n},v(q(o,((e,l)=>[l,u(e,l)])));var o,u}),[l,a,e]),M=({className:e,headerRow:l,idColumn:t,params:[s,a,n,o,u,r]})=>C("table",{className:e},r?C("caption",null,r):null,!1===l?null:C("thead",null,C("tr",null,!1===t?null:C(j,{sort:o??[],label:"Id",onClick:u}),q(s,(({label:e},l)=>C(j,{key:l,cellId:l,label:e,sort:o??[],onClick:u}))))),C("tbody",null,N(n,(e=>C("tr",{key:e},!1===t?null:C("th",null,e),q(s,(({component:l,getComponentProps:t},s)=>C("td",{key:s},C(l,{...x(t,e,s),...a,rowId:e,cellId:s}))))))))),j=({cellId:e,sort:[l,t],label:s=e??"",onClick:a})=>C("th",{onClick:O((()=>a?.(e)),[a,e],a),className:c(t)||l!=e?void 0:`sorted ${t?"de":"a"}scending`},c(t)||l!=e?null:(t?"↓":"↑")+" ",s),$=({localRowId:l,params:[t,s,a,n,o,u,r]})=>{const d=e.useRemoteRowId(o,l,u);return C("tr",null,!1===t?null:C(I,null,C("th",null,l),C("th",null,d)),q(s,(({component:e,getComponentProps:t},s)=>{const[o,u]=((e,l="",t)=>e.split(l,t))(s,".",2),i=o===a?l:o===n?d:null;return c(i)?null:C("td",{key:s},C(e,{...x(t,i,u),store:r,tableId:o,rowId:i,cellId:u}))})))},z=({thing:e,onThingChange:l,className:o,hasSchema:d,showType:c=!0})=>{const[b,I]=k(),[h,g]=k(),[w,y]=k(),[T,R]=k(),[S,x]=k();h!==e&&(I((e=>{const l=t(e);return(e=>e==s||e==a)(l)||l==n&&i(e)?l:void 0})(e)),g(e),y(e+""),R(Number(e)||0),x(!!e));const N=p(((e,t)=>{t(e),g(e),l(e)}),[l]),V=p((()=>{if(!d?.()){const e=m(b,n,a,s),t=m(e,w,T,S);I(e),g(t),l(t)}}),[d,l,w,T,S,b]);return C("div",{className:o},c?C("button",{className:b,onClick:V},b):null,m(b,C("input",{key:b,value:w,onChange:p((e=>N(e[u][r]+"",y)),[N])}),C("input",{key:b,type:"number",value:T,onChange:p((e=>N(Number(e[u][r]||0),R)),[N])}),C("input",{key:b,type:"checkbox",checked:S,onChange:p((e=>N(!!e[u].checked,x)),[N])})))},D=({tableId:l,rowId:t,cellId:s,store:a,className:n,showType:o})=>C(z,{thing:e.useCell(l,t,s,a),onThingChange:e.useSetCellCallback(l,t,s,(e=>e),[],a),className:n??E+"Cell",showType:o,hasSchema:e.useStoreOrStoreById(a)?.hasTablesSchema}),G=({valueId:l,store:t,className:s,showType:a})=>C(z,{thing:e.useValue(l,t),onThingChange:e.useSetValueCallback(l,(e=>e),[],t),className:s??E+o,showType:a,hasSchema:e.useStoreOrStoreById(t)?.hasValuesSchema}),J=({onChange:e,total:l,offset:t=0,limit:s=l,singular:a="row",plural:n=a+"s"})=>{(t>l||t<0)&&(t=0,e(0));const o=O((()=>e(t-s)),[e,t,s],t>0),u=O((()=>e(t+s)),[e,t,s],t+s<l);return C(I,null,l>s&&C(I,null,C("button",{className:"previous",disabled:0==t,onClick:o},"←"),C("button",{className:"next",disabled:t+s>=l,onClick:u},"→"),t+1," to ",d(l,t+s)," of "),l," ",1!=l?n:a)};exports.EditableCellView=D,exports.EditableValueView=G,exports.RelationshipInHtmlTable=({relationshipId:l,relationships:t,editable:s,customCells:a,className:n,headerRow:o,idColumn:u=!0})=>{const[r,d,i,c]=((e,l)=>[e,e?.getStore(),e?.getLocalTableId(l),e?.getRemoteTableId(l)])(e.useRelationshipsOrRelationshipsById(t),l),m=L([...H(i,d),...H(c,d)],a,s?D:e.CellView),b=P(u,m,i,c,l,r,d);return C("table",{className:n},!1===o?null:C("thead",null,C("tr",null,!1===u?null:C(I,null,C("th",null,i,".Id"),C("th",null,c,".Id")),q(m,(({label:e},l)=>C("th",{key:l},e))))),C("tbody",null,N(e.useRowIds(i,d),(e=>C($,{key:e,localRowId:e,params:b})))))},exports.ResultSortedTableInHtmlTable=({queryId:l,cellId:t,descending:s,offset:a,limit:n,queries:o,sortOnClick:u,paginator:r=!1,customCells:d,onChange:i,...c})=>{const[m,b,I]=F(t,s,u,a,n,e.useResultRowCount(l,o),r,i);return C(M,{...c,params:P(L(e.useResultTableCellIds(l,o),d,e.ResultCellView),A(o,l),e.useResultSortedRowIds(l,...m,n,o),m,b,I)})},exports.ResultTableInHtmlTable=({queryId:l,queries:t,customCells:s,...a})=>C(M,{...a,params:P(L(e.useResultTableCellIds(l,t),s,e.ResultCellView),A(t,l),e.useResultRowIds(l,t))}),exports.SliceInHtmlTable=({indexId:l,sliceId:t,indexes:s,editable:a,customCells:n,...o})=>{const[u,r,d]=((e,l)=>[e,e?.getStore(),e?.getTableId(l)])(e.useIndexesOrIndexesById(s),l);return C(M,{...o,params:P(L(e.useTableCellIds(d,r),n,a?D:e.CellView),B(r,d),e.useSliceRowIds(l,t,u))})},exports.SortedTableInHtmlTable=({tableId:l,cellId:t,descending:s,offset:a,limit:n,store:o,editable:u,sortOnClick:r,paginator:d=!1,onChange:i,customCells:c,...m})=>{const[b,I,h]=F(t,s,r,a,n,e.useRowCount(l,o),d,i);return C(M,{...m,params:P(L(e.useTableCellIds(l,o),c,u?D:e.CellView),B(o,l),e.useSortedRowIds(l,...b,n,o),b,I,h)})},exports.SortedTablePaginator=J,exports.TableInHtmlTable=({tableId:l,store:t,editable:s,customCells:a,...n})=>C(M,{...n,params:P(L(e.useTableCellIds(l,t),a,s?D:e.CellView),B(t,l),e.useRowIds(l,t))}),exports.ValuesInHtmlTable=({store:l,editable:t=!1,valueComponent:s=(t?G:e.ValueView),getValueComponentProps:a,className:n,headerRow:u,idColumn:r})=>C("table",{className:n},!1===u?null:C("thead",null,C("tr",null,!1===r?null:C("th",null,"Id"),C("th",null,o))),C("tbody",null,N(e.useValueIds(l),(e=>C("tr",{key:e},!1===r?null:C("th",null,e),C("td",null,C(s,{...x(a,e),valueId:e,store:l})))))));
