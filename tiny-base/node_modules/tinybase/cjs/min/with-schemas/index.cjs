"use strict";const e=e=>typeof e,t="",s=e(t),n=e(!0),r=e(0),o=e(e),a="type",l="default",i="Listener",c="Result",d="add",u="Has",g="Ids",h="Table",f=h+"s",I=h+g,b="Row",w=b+"Count",L=b+g,C="Sorted"+b+g,R="Cell",p=R+g,T="Value",v=T+"s",S=T+g,y=e=>t+e,M=(e,t)=>e.startsWith(t),V=(e,t)=>e.endsWith(t),m=(e,s=t,n)=>e.split(s,n),E=globalThis,x=Math,k=x.max,D=x.min,H=x.floor,J=isFinite,F=e=>null==e,Q=(e,t,s)=>F(e)?s?.():t(e),z=e=>e==s||e==n,N=t=>e(t)==s,O=t=>e(t)==o,W=e=>Array.isArray(e),A=(e,t,s)=>e.slice(t,s),P=e=>e.length,_=()=>{},j=(e,t)=>e.includes(t),U=(e,t)=>e.every(t),q=(e,t)=>P(e)===P(t)&&U(e,((e,s)=>t[s]===e)),B=(e,t)=>U(e,((s,n)=>0==n||t(e[n-1],s)<=0)),G=(e,t)=>e.sort(t),K=(e,t)=>e.forEach(t),X=(e,t)=>e.map(t),Y=e=>$(e,((e,t)=>e+t),0),Z=e=>0==P(e),$=(e,t,s)=>e.reduce(t,s),ee=(e,...t)=>e.push(...t),te=e=>e.pop(),se=e=>e.shift(),ne=Object,re=e=>ne.getPrototypeOf(e),oe=ne.entries,ae=ne.isFrozen,le=e=>!F(e)&&Q(re(e),(e=>e==ne.prototype||F(re(e))),(()=>!0)),ie=ne.keys,ce=ne.freeze,de=(e=[])=>ne.fromEntries(e),ue=(e,t)=>t in e,ge=(e,t)=>(delete e[t],e),he=(e,t)=>K(oe(e),(([e,s])=>t(s,e))),fe=(e,t)=>de(((e,t)=>X(oe(e),(([e,s])=>t(s,e))))(e,((e,s)=>[s,t(e,s)]))),Ie=e=>le(e)&&0==(e=>P(ie(e)))(e),be=(e,t,s)=>(ue(e,t)||(e[t]=s()),e[t]),we=(e,t,s,n=0)=>F(e)||!le(e)||!n&&Ie(e)||ae(e)?(s?.(),!1):(he(e,((s,n)=>{t(s,n)||ge(e,n)})),!!n||!Ie(e)),Le=e=>t=>$(ye(t),((t,s)=>t+e(s)),0),Ce=e=>e?.size??0,Re=Le(Ce),pe=Le(Re),Te=Le(pe),ve=(e,t)=>e?.has(t)??!1,Se=e=>F(e)||0==Ce(e),ye=e=>[...e?.values()??[]],Me=e=>e.clear(),Ve=(e,t)=>e?.forEach(t),me=(e,t)=>e?.delete(t),Ee=e=>new Map(e),xe=e=>[...e?.keys()??[]],ke=(e,t)=>e?.get(t),De=(e,t)=>Ve(e,((e,s)=>t(s,e))),He=(e,t,s)=>F(s)?(me(e,t),e):e?.set(t,s),Je=(e,t,s,n)=>(ve(e,t)?n?.(ke(e,t)):He(e,t,s()),ke(e,t)),Fe=(e,t,s,n=He)=>(fe(t,((t,n)=>s(e,n,t))),De(e,(s=>ue(t,s)?0:n(e,s))),e),Qe=(e,t,s,n)=>{const r={};return Ve(e,((e,o)=>{if(!s?.(e,o)){const s=t?t(e,o):e;n?.(s)||(r[o]=s)}})),r},ze=(e,t,s)=>Qe(e,(e=>Qe(e,t,s)),Se,Ie),Ne=(e,t,s)=>Qe(e,(e=>ze(e,t,s)),Se,Ie),Oe=(e,t)=>{const s=Ee();return Ve(e,((e,n)=>s.set(n,t?.(e)??e))),s},We=e=>Oe(e,Oe),Ae=e=>Oe(e,We),Pe=(e,t,s,n,r=0)=>Q((s?Je:ke)(e,t[r],r>P(t)-2?s:Ee),(o=>{if(r>P(t)-2)return n?.(o)&&He(e,t[r]),o;const a=Pe(o,t,s,n,r+1);return Se(o)&&He(e,t[r]),a})),_e=t=>{const s=e(t);return z(s)||s==r&&J(t)?s:void 0},je=e=>F(e)||!F(_e(e)),Ue=(e,t,s,n,r)=>F(r)?e.delCell(t,s,n,!0):e.setCell(t,s,n,r),qe=(e,t,s)=>F(s)?e.delValue(t):e.setValue(t,s),Be=e=>new Set(W(e)||F(e)?e:[e]),Ge=(e,t)=>e?.add(t),Ke=(e,t,s,n,r)=>{const o=e.hasRow,a=Ee(),l=Ee(),i=Ee(),c=Ee(),d=Ee(),u=Ee(),g=(t,s,...n)=>{const r=Je(u,t,Be);return K(n,(t=>Ge(r,t)&&s&&e.callListener(t))),n},h=(t,...s)=>Q(ke(u,t),(n=>{K(Z(s)?ye(n):s,(t=>{e.delListener(t),me(n,t)})),Se(n)&&He(u,t)})),f=(e,s)=>{He(a,e,s),ve(l,e)||(He(l,e,t()),He(c,e,Ee()),He(d,e,Ee()),r(i))},I=e=>{He(a,e),He(l,e),He(c,e),He(d,e),h(e),r(i)};return[()=>e,()=>xe(a),e=>De(l,e),e=>ve(l,e),e=>ke(a,e),e=>ke(l,e),(e,t)=>He(l,e,t),f,(t,n,r,a,l)=>{f(t,n);const i=Ee(),u=Ee(),I=ke(c,t),b=ke(d,t),w=t=>{const r=s=>e.getCell(n,t,s),c=ke(I,t),d=o(n,t)?s(a(r,t)):void 0;if(c===d||W(c)&&W(d)&&q(c,d)||He(i,t,[c,d]),!F(l)){const e=ke(b,t),s=o(n,t)?l(r,t):void 0;e!=s&&He(u,t,s)}},L=e=>{r((()=>{Ve(i,(([,e],t)=>He(I,t,e))),Ve(u,((e,t)=>He(b,t,e)))}),i,u,I,b,e),Me(i),Me(u)};De(I,w),e.hasTable(n)&&K(e.getRowIds(n),(e=>{ve(I,e)||w(e)})),L(!0),h(t),g(t,0,e.addRowListener(n,null,((e,t,s)=>w(s))),e.addTableListener(n,(()=>L())))},I,e=>n(e,i),()=>De(u,I),g,h]},Xe=(e,s)=>N(e)?t=>t(e):e??(()=>s??t),Ye=(e,t)=>{const s=new WeakMap;return n=>{s.has(n)||s.set(n,e(n));const r=s.get(n);return t?.(r),r}},Ze=/^\d+$/,$e=()=>{const e=[];let s=0;return[n=>(n?se(e):null)??t+s++,t=>{Ze.test(t)&&P(e)<1e3&&ee(e,t)}]},et=e=>{let s;const[n,r]=$e(),o=Ee();return[(r,a,l,i=[],c=()=>[])=>{s??=e();const d=n(1);return He(o,d,[r,a,l,i,c]),Ge(Pe(a,l??[t],Be),d),d},(e,n,...r)=>K(((e,s=[t])=>{const n=[],r=(e,t)=>t==P(s)?ee(n,e):null===s[t]?Ve(e,(e=>r(e,t+1))):K([s[t],null],(s=>r(ke(e,s),t+1)));return r(e,0),n})(e,n),(e=>Ve(e,(e=>ke(o,e)[0](s,...n??[],...r))))),e=>Q(ke(o,e),(([,s,n])=>(Pe(s,n??[t],void 0,(t=>(me(t,e),Se(t)?1:0))),He(o,e),r(e),n))),e=>Q(ke(o,e),(([e,,t=[],n,r])=>{const o=(...a)=>{const l=P(a);l==P(t)?e(s,...a,...r(a)):F(t[l])?K(n[l]?.(...a)??[],(e=>o(...a,e))):o(...a,t[l])};o()}))]},tt=Ye((e=>{let s,n,r,o=100,a=Ee(),l=Ee(),i=1;const c=Ee(),d=Ee(),[u,g,h]=et((()=>H)),f=Ee(),I=Ee(),b=[],w=[],L=(t,s)=>{i=0,e.transaction((()=>{const[n,r]=ke(f,s);Ve(n,((s,n)=>Ve(s,((s,r)=>Ve(s,((s,o)=>Ue(e,n,r,o,s[t]))))))),Ve(r,((s,n)=>qe(e,n,s[t])))})),i=1},C=e=>{He(f,e),He(I,e),g(d,[e])},R=(e,t)=>K(((e,t)=>e.splice(0,t))(e,t??P(e)),C),p=()=>R(b,P(b)-o),T=()=>Q(s,(()=>{ee(b,s),p(),R(w),s=void 0,r=1})),v=()=>{s=te(b),r=1};let S,y;const M=(e=t)=>(F(s)&&(s=t+n++,He(f,s,[a,l]),k(s,e),a=Ee(),l=Ee(),r=1),s),V=()=>{Z(b)||(((e,...t)=>{e.unshift(...t)})(w,M()),L(0,s),s=te(b),r=1)},m=()=>{Z(w)||(ee(b,s),s=se(w),L(1,s),r=1)},E=()=>{r&&(g(c),r=0)},x=e=>{const t=M(e);return E(),t},k=(e,t)=>(D(e)&&ke(I,e)!==t&&(He(I,e,t),g(d,[e])),H),D=e=>ve(f,e),H={setSize:e=>(o=e,p(),H),addCheckpoint:x,setCheckpoint:k,getStore:()=>e,getCheckpointIds:()=>[[...b],s,[...w]],forEachCheckpoint:e=>De(I,e),hasCheckpoint:D,getCheckpoint:e=>ke(I,e),goBackward:()=>(V(),E(),H),goForward:()=>(m(),E(),H),goTo:e=>{const t=j(b,e)?V:j(w,e)?m:null;for(;!F(t)&&e!=s;)t();return E(),H},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(h(e),H),clear:()=>(R(b),R(w),F(s)||C(s),s=void 0,n=0,x(),H),clearForward:()=>(Z(w)||(R(w),g(c)),H),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Re(c),checkpoint:Re(d)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,s,n,r,o)=>{if(i){T();const e=Je(a,t,Ee),l=Je(e,s,Ee),i=Je(l,n,(()=>[o,void 0]));i[1]=r,i[0]===r&&Se(He(l,n))&&Se(He(e,s))&&Se(He(a,t))&&v(),E()}})),y=e.addValueListener(null,((e,t,s,n)=>{if(i){T();const e=Je(l,t,(()=>[n,void 0]));e[1]=s,e[0]===s&&Se(He(l,t))&&v(),E()}}))}};return ce(H.clear())}),(e=>e._registerListeners())),st=m("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),nt=Ee(X(st,((e,t)=>[e,t]))),rt=e=>st[63&e],ot=(e,t)=>ke(nt,e[t])??0,at=E.crypto?e=>E.crypto.getRandomValues(e):e=>X(e,(()=>H(256*x.random()))),lt=(e,t)=>(e??0)<(t??0)?-1:1,it=(e=16)=>$(at(new Uint8Array(e)),((e,t)=>e+rt(t)),""),ct=Ye((e=>{const s=Ee(),n=Ee(),[r,o,a]=et((()=>C)),[l,i,c,d,u,g,h,,f,I,b,w]=Ke(e,Ee,(e=>F(e)?t:W(e)?X(e,y):y(e)),r,o),L=(t,s,n)=>{const r=u(t);Ve(n,((t,n)=>s(n,(s=>Ve(t,(t=>s(t,(s=>e.forEachCell(r,t,s)))))))))},C={setIndexDefinition:(e,t,r,a,l,i=lt)=>{const c=F(l)?void 0:([e],[t])=>l(e,t);return f(e,t,((t,r,l,d,u,f)=>{let I=0;const b=Be(),w=Be(),L=g(e);if(Ve(r,(([e,t],s)=>{const n=Be(e),r=Be(t);Ve(n,(e=>me(r,e)?me(n,e):0)),Ve(n,(e=>{Ge(b,e),Q(ke(L,e),(t=>{me(t,s),Se(t)&&(He(L,e),I=1)}))})),Ve(r,(e=>{Ge(b,e),ve(L,e)||(He(L,e,Be()),I=1),Ge(ke(L,e),s),F(a)||Ge(w,e)}))})),t(),Se(u)||(f?De(L,(e=>Ge(w,e))):De(l,(e=>Q(ke(d,e),(e=>Ge(w,e))))),Ve(w,(e=>{const t=(t,s)=>i(ke(u,t),ke(u,s),e),s=[...ke(L,e)];B(s,t)||(He(L,e,Be(G(s,t))),Ge(b,e))}))),(I||f)&&!F(c)){const t=[...L];B(t,c)||(h(e,Ee(G(t,c))),I=1)}I&&o(s,[e]),Ve(b,(t=>o(n,[e,t])))}),Xe(r),Q(a,Xe)),C},delIndexDefinition:e=>(I(e),C),getStore:l,getIndexIds:i,forEachIndex:e=>c(((t,s)=>e(t,(e=>L(t,e,s))))),forEachSlice:(e,t)=>L(e,t,g(e)),hasIndex:d,hasSlice:(e,t)=>ve(g(e),t),getTableId:u,getSliceIds:e=>xe(g(e)),getSliceRowIds:(e,t)=>ye(ke(g(e),t)),addIndexIdsListener:b,addSliceIdsListener:(e,t)=>r(t,s,[e]),addSliceRowIdsListener:(e,t,s)=>r(s,n,[e,t]),delListener:e=>(a(e),C),destroy:w,getListenerStats:()=>({sliceIds:Re(s),sliceRowIds:pe(n)})};return ce(C)})),dt=Ee([["avg",[(e,t)=>Y(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>k(...e),(e,t)=>k(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:k(t,e)]],["min",[e=>D(...e),(e,t)=>D(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:D(t,e)]],["sum",[e=>Y(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),ut=(e,t,s,n,r,o=!1)=>{if(Se(s))return;const[a,l,i,c]=r;return o||=F(e),Ve(n,(([s,n])=>{o||(e=F(s)?l?.(e,n,t++):F(n)?i?.(e,s,t--):c?.(e,n,s,t),o||=F(e))})),o?a(ye(s),Ce(s)):e},gt=Ye((e=>{const s=Ee(),[n,r,o]=et((()=>w)),[a,l,i,c,d,u,g,,h,f,I,b]=Ke(e,_,(e=>isNaN(e)||F(e)||!0===e||!1===e||e===t?void 0:1*e),n,r),w={setMetricDefinition:(e,t,n,o,a,l,i)=>{const c=O(n)?[n,a,l,i]:ke(dt,n)??ke(dt,"sum");return h(e,t,((t,n,o,a,l,i)=>{const d=u(e),h=Ce(a);i||=F(d),t();let f=ut(d,h,a,n,c,i);J(f)||(f=void 0),f!=d&&(g(e,f),r(s,[e],f,d))}),Xe(o,1)),w},delMetricDefinition:e=>(f(e),w),getStore:a,getMetricIds:l,forEachMetric:i,hasMetric:c,getTableId:d,getMetric:u,addMetricIdsListener:I,addMetricListener:(e,t)=>n(t,s,[e]),delListener:e=>(o(e),w),destroy:b,getListenerStats:()=>({metric:Re(s)})};return ce(w)})),ht=Ye((e=>{const s=e.createStore,n=s(),r=s(),o=Ee(),{addListener:a,callListeners:l,delListener:u}=r,[g,f,I,T,v,,,S,,y,M,V,m,E]=Ke(e,(()=>!0),_,a,l),x=(e,t,...s)=>K(s,(s=>Ge(Je(Je(o,t,Ee),e,Be),s))),k=e=>{Q(ke(o,e),(e=>{De(e,((e,t)=>Ve(t,(t=>e.delListener(t))))),Me(e)})),K([r,n],(t=>t.delTable(e)))},D=(e,t,s)=>x(t,e,t.addStartTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),H={setQueryDefinition:(s,o,a)=>{S(s,o),k(s);const l=[],i=[[null,[o,null,null,[],Ee()]]],c=[],d=[],u=[];a({select:(e,s)=>{const n=O(e)?[P(l)+t,e]:[F(s)?e:s,t=>t(e,s)];return ee(l,n),{as:e=>n[0]=e}},join:(e,t,s)=>{const n=F(s)||O(t)?null:t,r=F(n)?t:s,o=[e,[e,n,O(r)?r:e=>e(r),[],Ee()]];return ee(i,o),{as:e=>o[0]=e}},where:(e,t,s)=>ee(c,O(e)?e:F(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,r)=>{const o=[e,[e,O(t)?[t,s,n,r]:ke(dt,t)??[(e,t)=>t]]];return ee(d,o),{as:e=>o[0]=e}},having:(e,t)=>ee(u,O(e)?e:s=>s(e)===t)});const g=Ee(l);if(Se(g))return H;const h=Ee(i);De(h,((e,[,t])=>Q(ke(h,t),(({3:t})=>F(e)?0:ee(t,e)))));const f=Ee(d);let I=n;if(Se(f)&&Z(u))I=r;else{D(s,I,r);const e=Ee();De(f,((t,[s,n])=>Ge(Je(e,s,Be),[t,n])));const t=Be();De(g,(s=>ve(e,s)?0:Ge(t,s)));const n=Ee(),o=(t,n,o,a)=>Q(t,(([l,i,c,d])=>{De(n,((t,[s])=>{const n=Je(l,t,Ee),r=ke(n,o),i=a?void 0:s;if(r!==i){const s=Be([[r,i]]),a=Ce(n);He(n,o,i),Ve(ke(e,t),(([e,t])=>{const r=ut(d[e],a,n,s,t);d[e]=F(_e(r))?null:r}))}})),Se(i)||!U(u,(e=>e((e=>d[e]))))?r.delRow(s,c):F(c)?t[2]=r.addRow(s,d):r.setRow(s,c,d)}));x(I,s,I.addRowListener(s,null,((r,a,l,i)=>{const c=[],d=[],u=Ee(),g=I.hasRow(s,l);let h=!g;Ve(t,(e=>{const[t,n,r]=i(s,l,e);ee(c,n),ee(d,r),h||=t})),De(e,(e=>{const[t,,n]=i(s,l,e);(h||t)&&He(u,e,[n])})),h&&o(Pe(n,c,void 0,(([,e])=>(me(e,l),Se(e)))),u,l,1),g&&o(Pe(n,d,(()=>{const e={};return Ve(t,(t=>e[t]=I.getCell(s,l,t))),[Ee(),Be(),void 0,e]}),(([,e])=>{Ge(e,l)})),u,l)})))}D(s,e,I);const b=(t,n,r,a)=>{const l=t=>e.getCell(n,r,t);K(a,(n=>{const[r,,o,a,i]=ke(h,n),c=o?.(l,t),[d,u]=ke(i,t)??[];c!=d&&(F(u)||E(s,u),He(i,t,F(c)?null:[c,...m(s,1,e.addRowListener(r,c,(()=>b(t,r,c,a))))]))})),(t=>{const n=(s,n)=>e.getCell(...F(n)?[o,t,s]:s===o?[o,t,n]:[ke(h,s)?.[0],ke(ke(h,s)?.[4],t)?.[0],n]);I.transaction((()=>U(c,(e=>e(n)))?De(g,((e,r)=>Ue(I,s,t,e,r(n,t)))):I.delRow(s,t)))})(t)},{3:w}=ke(h,null);return I.transaction((()=>m(s,1,e.addRowListener(o,null,((t,n,r)=>{e.hasRow(o,r)?b(r,o,r,w):(I.delRow(s,r),Ve(h,(({4:e})=>Q(ke(e,r),(([,t])=>{E(s,t),He(e,r)})))))}))))),H},delQueryDefinition:e=>(k(e),y(e),H),getStore:g,getQueryIds:f,forEachQuery:I,hasQuery:T,getTableId:v,addQueryIdsListener:e=>M((()=>e(H))),delListener:e=>(u(e),H),destroy:V,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=r.getListenerStats();return n}};return fe({[h]:[1,1],[h+p]:[0,1],[w]:[0,1],[L]:[0,1],[C]:[0,5],[b]:[1,2],[p]:[0,2],[R]:[1,3]},(([e,t],s)=>{K(e?["get","has","forEach"]:["get"],(e=>H[e+c+s]=(...t)=>r[e+s](...t))),H[d+c+s+i]=(...e)=>r[d+s+i](...A(e,0,t),((s,...n)=>e[t](H,...n)),!0)})),ce(H)})),ft=Ye((e=>{const s=Ee(),n=Ee(),r=Ee(),o=Ee(),[a,l,i]=et((()=>T)),[c,d,u,g,h,f,,,I,b,w,L]=Ke(e,(()=>[Ee(),Ee(),Ee(),Ee()]),(e=>F(e)?void 0:e+t),a,l),C=(e,t,s)=>Q(f(e),(([n,,r])=>{if(!ve(r,t)){const o=Be();if(h(e)!=p(e))Ge(o,t);else{let e=t;for(;!F(e)&&!ve(o,e);)Ge(o,e),e=ke(n,e)}if(s)return o;He(r,t,o)}return ke(r,t)})),R=(e,t)=>Q(f(e),(([,,e])=>He(e,t))),p=e=>ke(s,e),T={setRelationshipDefinition:(e,t,a,i)=>(He(s,e,a),I(e,t,((t,s)=>{const a=Be(),i=Be(),c=Be(),[d,u]=f(e);Ve(s,(([t,s],n)=>{F(t)||(Ge(i,t),Q(ke(u,t),(e=>{me(e,n),Se(e)&&He(u,t)}))),F(s)||(Ge(i,s),ve(u,s)||He(u,s,Be()),Ge(ke(u,s),n)),Ge(a,n),He(d,n,s),De(ke(o,e),(t=>{ve(C(e,t),n)&&Ge(c,t)}))})),t(),Ve(a,(t=>l(n,[e,t]))),Ve(i,(t=>l(r,[e,t]))),Ve(c,(t=>{R(e,t),l(o,[e,t])}))}),Xe(i)),T),delRelationshipDefinition:e=>(He(s,e),b(e),T),getStore:c,getRelationshipIds:d,forEachRelationship:t=>u((s=>t(s,(t=>e.forEachRow(h(s),t))))),hasRelationship:g,getLocalTableId:h,getRemoteTableId:p,getRemoteRowId:(e,t)=>ke(f(e)?.[0],t),getLocalRowIds:(e,t)=>ye(ke(f(e)?.[1],t)),getLinkedRowIds:(e,t)=>F(f(e))?[t]:ye(C(e,t,!0)),addRelationshipIdsListener:w,addRemoteRowIdListener:(e,t,s)=>a(s,n,[e,t]),addLocalRowIdsListener:(e,t,s)=>a(s,r,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(C(e,t),a(s,o,[e,t])),delListener:e=>(R(...i(e)??[]),T),destroy:L,getListenerStats:()=>({remoteRowId:pe(n),localRowIds:pe(r),linkedRowIds:pe(o)})};return ce(T)})),It=new E.TextEncoder,bt=e=>{let t=2166136261;return K(It.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},wt=([e,t])=>Ct(e,t),Lt=([e,t,s])=>[e,t,s],Ct=(e,t)=>t?[e,t]:[e],Rt=(e,t,s)=>[e,t,s],pt=e=>e[2],Tt=(e,t)=>bt(e+":"+t),vt=(e,t)=>t>e?(e?bt(e):0)^bt(t):0,St=(e,t)=>((e??"")>(t??"")?e:t)??"",yt=(e,t,s)=>{t>e[1]&&(e[1]=t),e[2]=s>>>0},Mt=(e=t)=>Ct(de(),e),Vt=(e=t)=>[Ee(),e,0],mt=([e,t,s],n=Lt)=>[Qe(e,n),t,s],Et=([e,t],s=wt)=>Ct(Qe(e,s),t),xt=(t,s)=>W(t)&&3==P(t)&&N(t[1])&&e(t[2])==r&&J(t[2])&&s(t[0]),kt=e=>[e,e],Dt=(e,t=Re)=>t(e[0])+t(e[1]),Ht=()=>[Ee(),Ee()],Jt=e=>[...e],Ft=([e,t])=>e===t,Qt=JSON.stringify,zt=JSON.parse,Nt=e=>Qt(e,((e,t)=>t instanceof Map?ne.fromEntries([...t]):t)),Ot=(e,t,s)=>He(e,t,ke(e,t)==-s?void 0:s),Wt=()=>{let e,t,s=!1,n=!1,o=0,c=[];const g=Ee(),C=Ee(),M=Ee(),V=Ee(),m=Ee(),E=Ee(),x=Ee(),k=Ee(),D=Ee(),H=Ee(),J=Ee(),N=Ee(),P=Ee(),_=Ee(),U=Be(),B=Ee(),Y=Ee(),Z=Ee(),$=Ee(),te=Ht(),se=Ht(),ne=Ht(),re=Ht(),oe=Ht(),ae=Ht(),le=Ht(),ie=Ht(),de=Ht(),he=Ht(),be=Ht(),Le=Ht(),ye=Ht(),Pe=Ht(),je=Ht(),Ke=Ht(),Xe=Ht(),Ye=Ht(),Ze=Ht(),tt=Ht(),st=Ht(),nt=Ht(),rt=Ee(),ot=Ht(),[at,it,ct,dt]=et((()=>Os)),ut=e=>{if(!we(e,((e,t)=>j([a,l],t))))return!1;const t=e[a];return!(!z(t)&&t!=r||(_e(e[l])!=t&&ge(e,l),0))},gt=W,ht=(t,s)=>(!e||ve(J,s)||Yt(s))&&we(t,((e,t)=>ft(s,t,e)),(()=>Yt(s))),ft=(e,t,s,n)=>we(n?s:Lt(s,e,t),((n,r)=>Q(It(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>Yt(e,t))),It=(t,s,n,r)=>e?Q(ke(ke(J,t),n),(e=>_e(r)!=e[a]?Yt(t,s,n,r,e[l]):r),(()=>Yt(t,s,n,r))):F(_e(r))?Yt(t,s,n,r):r,bt=(e,t)=>we(t?e:Ct(e),((t,s)=>Q(wt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Zt())),wt=(e,s)=>t?Q(ke(P,e),(t=>_e(s)!=t[a]?Zt(e,s,t[l]):s),(()=>Zt(e,s))):F(_e(s))?Zt(e,s):s,Lt=(e,t,s)=>(Q(ke(N,t),(([n,r])=>{Ve(n,((t,s)=>{ue(e,s)||(e[s]=t)})),Ve(r,(n=>{ue(e,n)||Yt(t,s,n)}))})),e),Ct=e=>(t&&(Ve(_,((t,s)=>{ue(e,s)||(e[s]=t)})),Ve(U,(t=>{ue(e,t)||Zt(t)}))),e),Rt=e=>Fe(J,e,((e,t,s)=>{const n=Ee(),r=Be();Fe(Je(J,t,Ee),s,((e,t,s)=>{He(e,t,s),Q(s[l],(e=>He(n,t,e)),(()=>Ge(r,t)))})),He(N,t,[n,r])}),((e,t)=>{He(J,t),He(N,t)})),pt=e=>Fe(P,e,((e,t,s)=>{He(P,t,s),Q(s[l],(e=>He(_,t,e)),(()=>Ge(U,t)))}),((e,t)=>{He(P,t),He(_,t),me(U,t)})),Tt=e=>Ie(e)?xs():ys(e),vt=e=>Fe(Z,e,((e,t,s)=>St(t,s)),((e,t)=>At(t))),St=(e,t)=>Fe(Je(Z,e,(()=>(Ut(e,1),He(B,e,$e()),He(Y,e,Ee()),Ee()))),t,((t,s,n)=>yt(e,t,s,n)),((t,s)=>Pt(e,t,s))),yt=(e,t,s,n,r)=>Fe(Je(t,s,(()=>(qt(e,s,1),Ee()))),n,((t,n,r)=>Mt(e,s,t,n,r)),((n,o)=>_t(e,t,s,n,o,r))),Mt=(e,t,s,n,r)=>{ve(s,n)||Bt(e,t,n,1);const o=ke(s,n);r!==o&&(Gt(e,t,n,o,r),He(s,n,r))},Vt=(e,t,s,n,r)=>Q(ke(t,s),(t=>Mt(e,s,t,n,r)),(()=>yt(e,t,s,Lt({[n]:r},e,s)))),mt=e=>Ie(e)?Hs():Ms(e),Et=e=>Fe($,e,((e,t,s)=>xt(t,s)),((e,t)=>jt(t))),xt=(e,t)=>{ve($,e)||Kt(e,1);const s=ke($,e);t!==s&&(Xt(e,s,t),He($,e,t))},Qt=e=>ke(Z,e)??St(e,{}),At=e=>St(e,{}),Pt=(e,t,s)=>{const[,n]=ke(B,e);n(s),yt(e,t,s,{},!0)},_t=(e,t,s,n,r,o)=>{const a=ke(ke(N,e)?.[0],r);if(!F(a)&&!o)return Mt(e,s,n,r,a);const l=t=>{Gt(e,s,t,ke(n,t)),Bt(e,s,t,-1),He(n,t)};F(a)?l(r):De(n,l),Se(n)&&(qt(e,s,-1),Se(He(t,s))&&(Ut(e,-1),He(Z,e),He(B,e),He(Y,e)))},jt=e=>{const t=ke(_,e);if(!F(t))return xt(e,t);Xt(e,ke($,e)),Kt(e,-1),He($,e)},Ut=(e,t)=>Ot(g,e,t),qt=(e,t,s)=>Ot(Je(V,e,Ee),t,s)&&He(M,e,Je(M,e,(()=>0))+s),Bt=(e,t,s,n)=>{const r=ke(Y,e),o=ke(r,s)??0;(0==o&&1==n||1==o&&-1==n)&&Ot(Je(C,e,Ee),s,n),He(r,s,o!=-n?o+n:null),Ot(Je(Je(m,e,Ee),t,Ee),s,n)},Gt=(e,t,s,n,r)=>{Je(Je(Je(E,e,Ee),t,Ee),s,(()=>[n,0]))[1]=r,c[3]?.(e,t,s,r)},Kt=(e,t)=>Ot(x,e,t),Xt=(e,t,s)=>{Je(k,e,(()=>[t,0]))[1]=s,c[4]?.(e,s)},Yt=(e,t,s,n,r)=>(ee(Je(Je(Je(D,e,Ee),t,Ee),s,(()=>[])),n),r),Zt=(e,t,s)=>(ee(Je(H,e,(()=>[])),t),s),$t=(e,t,s)=>Q(ke(ke(ke(E,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...kt(fs(e,t,s))])),es=e=>Q(ke(k,e),(([e,t])=>[!0,e,t]),(()=>[!1,...kt(ws(e))])),ts=e=>Se(D)||Se(Ke[e])?0:Ve(e?Ae(D):D,((t,s)=>Ve(t,((t,n)=>Ve(t,((t,r)=>it(Ke[e],[s,n,r],t))))))),ss=e=>Se(H)||Se(Xe[e])?0:Ve(e?Oe(H):H,((t,s)=>it(Xe[e],[s],t))),ns=(e,t,s,n)=>{if(!Se(e))return it(t,n,(()=>Qe(e))),De(e,((e,t)=>it(s,[...n??[],e],1==t))),1},rs=e=>{const t=Ls();t!=s&&it(te[e],void 0,t);const n=Se(he[e]),r=Se(ye[e])&&Se(Pe[e])&&Se(de[e])&&Se(be[e])&&Se(ae[e])&&Se(le[e])&&Se(ie[e])&&n&&Se(ne[e])&&Se(re[e]),o=Se(je[e])&&Se(Le[e])&&Se(oe[e])&&Se(se[e]);if(!r||!o){const t=e?[Oe(g),We(C),Oe(M),We(V),Ae(m),Ae(E)]:[g,C,M,V,m,E];if(!r){ns(t[0],ne[e],re[e]),Ve(t[1],((t,s)=>ns(t,ae[e],le[e],[s]))),Ve(t[2],((t,s)=>{0!=t&&it(ie[e],[s],ds(s))}));const s=Be();Ve(t[3],((t,r)=>{ns(t,de[e],be[e],[r])&&!n&&(it(he[e],[r,null]),Ge(s,r))})),n||Ve(t[5],((t,n)=>{if(!ve(s,n)){const s=Be();Ve(t,(e=>Ve(e,(([t,n],r)=>n!==t?Ge(s,r):me(e,r))))),Ve(s,(t=>it(he[e],[n,t])))}})),Ve(t[4],((t,s)=>Ve(t,((t,n)=>ns(t,ye[e],Pe[e],[s,n])))))}if(!o){let s;Ve(t[5],((t,n)=>{let r;Ve(t,((t,o)=>{let a;Ve(t,(([t,l],i)=>{l!==t&&(it(je[e],[n,o,i],l,t,$t),s=r=a=1)})),a&&it(Le[e],[n,o],$t)})),r&&it(oe[e],[n],$t)})),s&&it(se[e],void 0,$t)}}},os=e=>{const t=vs();t!=n&&it(Ye[e],void 0,t);const s=Se(tt[e])&&Se(st[e]),r=Se(nt[e])&&Se(Ze[e]);if(!s||!r){const t=e?[Oe(x),Oe(k)]:[x,k];if(s||ns(t[0],tt[e],st[e]),!r){let s;Ve(t[1],(([t,n],r)=>{n!==t&&(it(nt[e],[r],n,t,es),s=1)})),s&&it(Ze[e],void 0,es)}}},as=(e,...t)=>(Qs((()=>e(...X(t,y)))),Os),ls=()=>Ne(Z),is=()=>xe(Z),cs=e=>xe(ke(Y,y(e))),ds=e=>Ce(ke(Z,y(e))),us=e=>xe(ke(Z,y(e))),gs=(e,t,s,n=0,r)=>{return X(A(G((o=ke(Z,y(e)),a=(e,s)=>[F(t)?s:ke(e,y(t)),s],X([...o?.entries()??[]],(([e,t])=>a(t,e)))),(([e],[t])=>lt(e,t)*(s?-1:1))),n,F(r)?r:n+r),(([,e])=>e));var o,a},hs=(e,t)=>xe(ke(ke(Z,y(e)),y(t))),fs=(e,t,s)=>ke(ke(ke(Z,y(e)),y(t)),y(s)),Is=()=>Qe($),bs=()=>xe($),ws=e=>ke($,y(e)),Ls=()=>!Se(Z),Cs=e=>ve(Z,y(e)),Rs=(e,t)=>ve(ke(Y,y(e)),y(t)),ps=(e,t)=>ve(ke(Z,y(e)),y(t)),Ts=(e,t,s)=>ve(ke(ke(Z,y(e)),y(t)),y(s)),vs=()=>!Se($),Ss=e=>ve($,y(e)),ys=e=>as((()=>(e=>we(e,ht,Yt))(e)?vt(e):0)),Ms=e=>as((()=>bt(e)?Et(e):0)),Vs=e=>{try{Tt(zt(e))}catch{}return Os},ms=t=>as((()=>{if((e=we(t,(e=>we(e,ut))))&&(Rt(t),!Se(Z))){const e=ls();xs(),ys(e)}})),Es=e=>as((()=>{if(t=(e=>we(e,ut))(e)){const s=Is();Fs(),Hs(),t=!0,pt(e),Ms(s)}})),xs=()=>as((()=>vt({}))),ks=e=>as((e=>ve(Z,e)?At(e):0),e),Ds=(e,t)=>as(((e,t)=>Q(ke(Z,e),(s=>ve(s,t)?Pt(e,s,t):0))),e,t),Hs=()=>as((()=>Et({}))),Js=()=>as((()=>{Rt({}),e=!1})),Fs=()=>as((()=>{pt({}),t=!1})),Qs=(e,t)=>{if(-1!=o){zs();const s=e();return Ns(t),s}},zs=()=>(-1!=o&&o++,1==o&&(c[0]?.(),it(rt)),Os),Ns=e=>(o>0&&(o--,0==o&&(o=1,ts(1),Se(E)||rs(1),ss(1),Se(k)||os(1),e?.(Os)&&(Ve(E,((e,t)=>Ve(e,((e,s)=>Ve(e,(([e],n)=>Ue(Os,t,s,n,e))))))),Me(E),Ve(k,(([e],t)=>qe(Os,t,e))),Me(k)),it(ot[0],void 0),o=-1,ts(0),Se(E)||rs(0),ss(0),Se(k)||os(0),c[1]?.(),it(ot[1],void 0),c[2]?.(),o=0,s=Ls(),n=vs(),K([g,C,M,V,m,E,D,x,k,H],Me))),Os),Os={getContent:()=>[ls(),Is()],getTables:ls,getTableIds:is,getTable:e=>ze(ke(Z,y(e))),getTableCellIds:cs,getRowCount:ds,getRowIds:us,getSortedRowIds:gs,getRow:(e,t)=>Qe(ke(ke(Z,y(e)),y(t))),getCellIds:hs,getCell:fs,getValues:Is,getValueIds:bs,getValue:ws,hasTables:Ls,hasTable:Cs,hasTableCell:Rs,hasRow:ps,hasCell:Ts,hasValues:vs,hasValue:Ss,getTablesJson:()=>Nt(Z),getValuesJson:()=>Nt($),getJson:()=>Nt([Z,$]),getTablesSchemaJson:()=>Nt(J),getValuesSchemaJson:()=>Nt(P),getSchemaJson:()=>Nt([J,P]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>as((()=>{const t=O(e)?e():e;gt(t)&&(([e,t])=>{(Ie(e)?xs:ys)(e),(Ie(t)?Hs:Ms)(t)})(t)})),setTables:ys,setTable:(e,t)=>as((e=>ht(t,e)?St(e,t):0),e),setRow:(e,t,s)=>as(((e,t)=>ft(e,t,s)?yt(e,Qt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Qs((()=>{let n;return ft(e,n,t)&&(e=y(e),yt(e,Qt(e),n=((e,t)=>{const[s]=ke(B,e);let n;do{n=s(t)}while(ve(ke(Z,e),n));return n})(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>as(((e,t)=>{if(ft(e,t,s,1)){const n=Qt(e);fe(s,((s,r)=>Vt(e,n,t,r,s)))}}),e,t),setCell:(e,t,s,n)=>as(((e,t,s)=>Q(It(e,t,s,O(n)?n(fs(e,t,s)):n),(n=>Vt(e,Qt(e),t,s,n)))),e,t,s),setValues:Ms,setPartialValues:e=>as((()=>bt(e,1)?fe(e,((e,t)=>xt(t,e))):0)),setValue:(e,t)=>as((e=>Q(wt(e,O(t)?t(ws(e)):t),(t=>xt(e,t)))),e),applyChanges:e=>as((()=>{fe(e[0],((e,t)=>F(e)?ks(t):fe(e,((e,s)=>F(e)?Ds(t,s):fe(e,((e,n)=>Ue(Os,t,s,n,e))))))),fe(e[1],((e,t)=>qe(Os,t,e)))})),setTablesJson:Vs,setValuesJson:e=>{try{mt(zt(e))}catch{}return Os},setJson:e=>as((()=>{try{const[t,s]=zt(e);Tt(t),mt(s)}catch{Vs(e)}})),setTablesSchema:ms,setValuesSchema:Es,setSchema:(e,t)=>as((()=>{ms(e),Es(t)})),delTables:xs,delTable:ks,delRow:Ds,delCell:(e,t,s,n)=>as(((e,t,s)=>Q(ke(Z,e),(r=>Q(ke(r,t),(o=>ve(o,s)?_t(e,r,t,o,s,n):0))))),e,t,s),delValues:Hs,delValue:e=>as((e=>ve($,e)?jt(e):0),e),delTablesSchema:Js,delValuesSchema:Fs,delSchema:()=>as((()=>{Js(),Fs()})),transaction:Qs,startTransaction:zs,getTransactionChanges:()=>[Qe(E,((e,t)=>-1===ke(g,t)?void 0:Qe(e,((e,s)=>-1===ke(ke(V,t),s)?void 0:Qe(e,(([,e])=>e),(e=>Ft(e)))),Se,Ie)),Se,Ie),Qe(k,(([,e])=>e),(e=>Ft(e))),1],getTransactionLog:()=>[!Se(E),!Se(k),Ne(E,Jt,Ft),Ne(D),Qe(k,Jt,Ft),Qe(H),Qe(g),ze(V),Ne(m),Qe(x)],finishTransaction:Ns,forEachTable:e=>Ve(Z,((t,s)=>e(s,(e=>Ve(t,((t,s)=>e(s,(e=>De(t,e))))))))),forEachTableCell:(e,t)=>De(ke(Y,y(e)),t),forEachRow:(e,t)=>Ve(ke(Z,y(e)),((e,s)=>t(s,(t=>De(e,t))))),forEachCell:(e,t,s)=>De(ke(ke(Z,y(e)),y(t)),s),forEachValue:e=>De($,e),addSortedRowIdsListener:(e,t,s,n,r,o,a)=>{let l=gs(e,t,s,n,r);return at((()=>{const a=gs(e,t,s,n,r);q(a,l)||(l=a,o(Os,e,t,s,n,r,l))}),he[a?1:0],[e,t],[is])},addStartTransactionListener:e=>at(e,rt),addWillFinishTransactionListener:e=>at(e,ot[0]),addDidFinishTransactionListener:e=>at(e,ot[1]),callListener:e=>(dt(e),Os),delListener:e=>(ct(e),Os),getListenerStats:()=>({hasTables:Dt(te),tables:Dt(se),tableIds:Dt(ne),hasTable:Dt(re),table:Dt(oe),tableCellIds:Dt(ae),hasTableCell:Dt(le,pe),rowCount:Dt(ie),rowIds:Dt(de),sortedRowIds:Dt(he),hasRow:Dt(be,pe),row:Dt(Le,pe),cellIds:Dt(ye,pe),hasCell:Dt(Pe,Te),cell:Dt(je,Te),invalidCell:Dt(Ke,Te),hasValues:Dt(Ye),values:Dt(Ze),valueIds:Dt(tt),hasValue:Dt(st),value:Dt(nt),invalidValue:Dt(Xe),transaction:Re(rt)+Dt(ot)}),isMergeable:()=>!1,createStore:Wt,addListener:at,callListeners:it,setInternalListeners:(e,t,s,n,r)=>c=[e,t,s,n,r]};return fe({[u+f]:[0,te,[],()=>[Ls()]],[f]:[0,se],[I]:[0,ne],[u+h]:[1,re,[is],e=>[Cs(...e)]],[h]:[1,oe,[is]],[h+p]:[1,ae,[is]],[u+h+R]:[2,le,[is,cs],e=>[Rs(...e)]],[w]:[1,ie,[is]],[L]:[1,de,[is]],[u+b]:[2,be,[is,us],e=>[ps(...e)]],[b]:[2,Le,[is,us]],[p]:[2,ye,[is,us]],[u+R]:[3,Pe,[is,us,hs],e=>[Ts(...e)]],[R]:[3,je,[is,us,hs],e=>kt(fs(...e))],InvalidCell:[3,Ke],[u+v]:[0,Ye,[],()=>[vs()]],[v]:[0,Ze],[S]:[0,tt],[u+T]:[1,st,[bs],e=>[Ss(...e)]],[T]:[1,nt,[bs],e=>kt(ws(e[0]))],InvalidValue:[1,Xe]},(([e,t,s,n],r)=>{Os[d+r+i]=(...r)=>at(r[e],t[r[e+1]?1:0],e>0?A(r,0,e):void 0,s,n)})),ce(Os)},At=2**36,Pt=2**30,_t=2**24,jt=2**18,Ut=4096,qt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Bt=(e=t)=>[Vt(e),Vt(e)];exports.createCheckpoints=tt,exports.createIndexes=ct,exports.createMergeableStore=e=>{let s=1,n=Bt(),r=0;const o=Ee(),a=Be(),[l,c]=(e=>{let t=0,s=-1;const n=Q(e,(e=>{const t=bt(e);return rt(t/_t)+rt(t/jt)+rt(t/Ut)+rt(t/64)+rt(t)}),(()=>it(5))),r=e=>{const n=t,[r,o]=F(e)||""==e?[0,0]:[ot(a=e,0)*At+ot(a,1)*Pt+ot(a,2)*_t+ot(a,3)*jt+ot(a,4)*Ut+64*ot(a,5)+ot(a,6),ot(a,7)*jt+ot(a,8)*Ut+64*ot(a,9)+ot(a,10)];var a;t=k(n,r,E.HLC_TIME??Date.now()),s=t==n?t==r?k(s,o):s:t==r?o:-1};return[()=>{return r(),o=++s,rt((e=t)/At)+rt(e/Pt)+rt(e/_t)+rt(e/jt)+rt(e/Ut)+rt(e/64)+rt(e)+rt(o/jt)+rt(o/Ut)+rt(o/64)+rt(o)+n;var e,o},r]})(e),u=Wt(),g=e=>{const t=s;return s=0,e(),s=t,w},h=(e,s=0)=>{const r={},o={},[[a,l=t,i=0],d]=e,[u,g]=n,[h,I,b]=u;let w=s?i:b,L=l;he(a,(([e,n=t,o=0],a)=>{const l=Je(h,a,Vt),[i,c,d]=l;let u=s?o:d,g=n;he(e,((e,t)=>{const[n,o,l]=f(e,Je(i,t,Vt),be(be(r,a,de),t,de),s);u^=s?0:(o?Tt(t,o):0)^Tt(t,l),g=St(g,n)})),u^=s?0:vt(c,n),yt(l,n,u),w^=s?0:(d?Tt(a,d):0)^Tt(a,l[2]),L=St(L,g)})),w^=s?0:vt(I,l),yt(u,l,w);const[C]=f(d,g,o,s);return c(St(L,C)),[r,o,1]},f=(e,s,n,r)=>{const[o,a=t,l=0]=e,[i,c,d]=s;let u=a,g=r?l:d;return he(o,(([e,s,o=0],a)=>{const l=Je(i,a,(()=>[void 0,t,0])),[,c,d]=l;(!c||s>c)&&(yt(l,s,r?o:bt(Nt(e??null)+":"+s)),l[0]=e,n[a]=e,g^=r?0:Tt(a,d)^Tt(a,l[2]),u=St(u,s))})),g^=r?0:vt(c,a),yt(s,a,g),[u,d,s[2]]},I=()=>[mt(n[0],(e=>mt(e,(e=>mt(e))))),mt(n[1])],b=e=>g((()=>u.applyChanges(h(e)))),w={getMergeableContent:I,getMergeableContentHashes:()=>[n[0][2],n[1][2]],getMergeableTableHashes:()=>Qe(n[0][0],pt),getMergeableTableDiff:e=>{const t=Mt(n[0][1]),s={};return De(n[0][0],((n,[r,o,a])=>ue(e,n)?a!=e[n]?s[n]=a:0:t[0][n]=Et([r,o],(e=>Et(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return he(e,((e,s)=>Q(ke(n[0][0],s),(([n,,r])=>r!=e?De(n,((e,[,,n])=>be(t,s,de)[e]=n)):0)))),t},getMergeableRowDiff:e=>{const t=Mt(n[0][1]),s={};return he(e,((e,r)=>De(ke(n[0][0],r)?.[0],((n,[o,a,l])=>ue(e,n)?l!==e[n]?be(s,r,de)[n]=l:0:be(t[0],r,Mt)[0][n]=Et([o,a]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return he(e,((e,s)=>Q(ke(n[0][0],s),(([n])=>he(e,((e,r)=>Q(ke(n,r),(([n,,o])=>o!==e?De(n,((e,[,,n])=>be(be(t,s,de),r,de)[e]=n)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=n,r={};return he(e,((e,s)=>he(e,((e,n)=>Q(ke(t,s),(([t,o])=>Q(ke(t,n),(([t,a])=>De(t,((t,[l,i,c])=>c!==e[t]?be(be(r,s,(()=>Mt(o)))[0],n,(()=>Mt(a)))[0][t]=[l,i]:0)))))))))),Ct(r,s)},getMergeableValueHashes:()=>Qe(n[1][0],pt),getMergeableValueDiff:e=>{const[,[t,s]]=n,r=Qe(t,wt,(([,,t],s)=>t==e?.[s]));return Ct(r,s)},setMergeableContent:e=>g((()=>(e=>W(e)&&2==P(e)&&xt(e[0],(e=>we(e,(e=>xt(e,(e=>we(e,(e=>xt(e,(e=>we(e,(e=>xt(e,je)),void 0,1)))),void 0,1)))),void 0,1)))&&xt(e[1],(e=>we(e,(e=>xt(e,je)),void 0,1))))(e)?u.transaction((()=>{u.delTables().delValues(),n=Bt(),u.applyChanges(h(e,1))})):0)),setDefaultContent:e=>(u.transaction((()=>{r=1,u.setContent(e),r=0})),w),getTransactionMergeableChanges:(e=!1)=>{const[[t,s,r],[l,i,c]]=n,d=e?Rt:Ct,u={};Ve(o,((e,s)=>Q(ke(t,s),(([t,n,r])=>{const o={};Ve(e,((e,s)=>Q(ke(t,s),(([t,n,r])=>{const a={};Ve(e,(e=>{Q(ke(t,e),(([t,s,n])=>a[e]=d(t,s,n)))})),o[s]=d(a,n,r)})))),u[s]=d(o,n,r)}))));const g={};return Ve(a,(e=>Q(ke(l,e),(([t,s,n])=>g[e]=d(t,s,n))))),[d(u,s,r),d(g,i,c),1]},applyMergeableChanges:b,merge:e=>{const t=I(),s=e.getMergeableContent();return e.applyMergeableChanges(t),b(s)}};return u.setInternalListeners((()=>{}),(()=>{}),(()=>{Me(o),Me(a)}),((e,n,a,i)=>{Ge(Je(Je(o,e,Ee),n,Be),a),s&&h([[{[e]:[{[n]:[{[a]:[i,r?t:l()]}]}]}],[{}],1])}),((e,n)=>{Ge(a,e),s&&h([[{}],[{[e]:[n,r?t:l()]}],1])})),fe(u,((e,t)=>w[t]=M(t,"set")||M(t,"del")||M(t,"apply")||V(t,"Transaction")||t=="call"+i?(...t)=>(e(...t),w):M(t,d)&&V(t,i)?(...s)=>{const n=qt[A(t,3,-8)]??0,r=s[n];return s[n]=(e,...t)=>r(w,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),ce(w)},exports.createMetrics=gt,exports.createQueries=ht,exports.createRelationships=ft,exports.createStore=Wt,exports.defaultSorter=lt,exports.getUniqueId=it;
