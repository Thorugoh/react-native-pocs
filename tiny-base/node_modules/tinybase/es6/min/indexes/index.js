const e=e=>typeof e,n="",l=e(n),t=e=>n+e,r=e=>null==e,s=(e,n,l)=>r(e)?null==l?void 0:l():n(e),o=e=>Array.isArray(e),u=e=>e.length,d=(e,n)=>e.every(n),i=(e,n)=>d(e,((l,t)=>0==t||n(e[t-1],l)<=0)),a=(e,n)=>e.sort(n),c=(e,n)=>e.forEach(n),v=(e,...n)=>e.push(...n),I=Object.freeze,h=e=>n=>{return l=(n,l)=>n+e(l),x(n).reduce(l,0);var l},f=e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0},g=h(f),w=h(g),L=(e,n)=>{var l;return null!=(l=null==e?void 0:e.has(n))&&l},S=e=>r(e)||0==f(e),x=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},p=e=>e.clear(),y=(e,n)=>null==e?void 0:e.forEach(n),R=(e,n)=>null==e?void 0:e.delete(n),E=e=>new Map(e),b=e=>{var n;return[...null!=(n=null==e?void 0:e.keys())?n:[]]},T=(e,n)=>null==e?void 0:e.get(n),k=(e,n)=>y(e,((e,l)=>n(l,e))),z=(e,n,l)=>r(l)?(R(e,n),e):null==e?void 0:e.set(n,l),A=(e,n,l,t)=>(L(e,n)?null==t||t(T(e,n)):z(e,n,l()),T(e,n)),C=(e,n,l,t,r=0)=>s((l?A:T)(e,n[r],r>u(n)-2?l:E),(s=>{if(r>u(n)-2)return(null==t?void 0:t(s))&&z(e,n[r]),s;const o=C(s,n,l,t,r+1);return S(s)&&z(e,n[r]),o})),D=e=>new Set(o(e)||r(e)?e:[e]),M=(e,n)=>null==e?void 0:e.add(n),j=(t,r)=>e(t)==l?e=>e(t):null!=t?t:()=>null!=r?r:n,m=(e,n)=>(null!=e?e:0)<(null!=n?n:0)?-1:1,O=/^\d+$/,W=(()=>{const e=new WeakMap;return l=>(e.has(l)||e.set(l,(e=>{const l=E(),h=E(),[f,W,$]=(()=>{let e;const[l,t]=(()=>{const e=[];let l=0;return[t=>{var r;return null!=(r=t?e.shift():null)?r:n+l++},n=>{O.test(n)&&u(e)<1e3&&v(e,n)}]})(),o=E();return[(t,r,s,u=[],d=()=>[])=>{null!=e||(e=X);const i=l(1);return z(o,i,[t,r,s,u,d]),M(C(r,null!=s?s:[n],D),i),i},(l,t,...r)=>c(((e,l=[n])=>{const t=[],r=(e,n)=>n==u(l)?v(t,e):null===l[n]?y(e,(e=>r(e,n+1))):c([l[n],null],(l=>r(T(e,l),n+1)));return r(e,0),t})(l,t),(n=>y(n,(n=>T(o,n)[0](e,...null!=t?t:[],...r))))),e=>s(T(o,e),(([,l,r])=>(C(l,null!=r?r:[n],void 0,(n=>(R(n,e),S(n)?1:0))),z(o,e),t(e),r))),n=>s(T(o,n),(([n,,l=[],t,s])=>{const o=(...d)=>{var i,a;const v=u(d);v==u(l)?n(e,...d,...s(d)):r(l[v])?c(null!=(a=null==(i=t[v])?void 0:i.call(t,...d))?a:[],(e=>o(...d,e))):o(...d,l[v])};o()}))]})(),[q,B,F,G,H,J,K,,N,P,Q,U]=((e,n,l,t,i)=>{const a=e.hasRow,v=E(),I=E(),h=E(),f=E(),g=E(),w=E(),C=(n,l,...t)=>{const r=A(w,n,D);return c(t,(n=>M(r,n)&&l&&e.callListener(n))),t},j=(n,...l)=>s(T(w,n),(t=>{c(0==u(l)?x(t):l,(n=>{e.delListener(n),R(t,n)})),S(t)&&z(w,n)})),m=(e,l)=>{z(v,e,l),L(I,e)||(z(I,e,n()),z(f,e,E()),z(g,e,E()),i(h))},O=e=>{z(v,e),z(I,e),z(f,e),z(g,e),j(e),i(h)};return[()=>e,()=>b(v),e=>k(I,e),e=>L(I,e),e=>T(v,e),e=>T(I,e),(e,n)=>z(I,e,n),m,(n,t,s,i,v)=>{m(n,t);const I=E(),h=E(),w=T(f,n),S=T(g,n),x=n=>{const s=l=>e.getCell(t,n,l),c=T(w,n),f=a(t,n)?l(i(s,n)):void 0;var g,L;if(c===f||o(c)&&o(f)&&(L=f,u(g=c)===u(L)&&d(g,((e,n)=>L[n]===e)))||z(I,n,[c,f]),!r(v)){const e=T(S,n),l=a(t,n)?v(s,n):void 0;e!=l&&z(h,n,l)}},R=e=>{s((()=>{y(I,(([,e],n)=>z(w,n,e))),y(h,((e,n)=>z(S,n,e)))}),I,h,w,S,e),p(I),p(h)};k(w,x),e.hasTable(t)&&c(e.getRowIds(t),(e=>{L(w,e)||x(e)})),R(!0),j(n),C(n,0,e.addRowListener(t,null,((e,n,l)=>x(l))),e.addTableListener(t,(()=>R())))},O,e=>t(e,h),()=>k(w,O),C,j]})(e,E,(e=>{return r(e)?n:o(e)?(l=t,e.map(l)):t(e);var l}),f,W),V=(n,l,t)=>{const r=H(n);y(t,((n,t)=>l(t,(l=>y(n,(n=>l(n,(l=>e.forEachCell(r,n,l)))))))))},X={setIndexDefinition:(e,n,t,o,u,d=m)=>{const c=r(u)?void 0:([e],[n])=>u(e,n);return N(e,n,((n,t,u,v,I,f)=>{let g=0;const w=D(),x=D(),p=J(e);if(y(t,(([e,n],l)=>{const t=D(e),u=D(n);y(t,(e=>R(u,e)?R(t,e):0)),y(t,(e=>{M(w,e),s(T(p,e),(n=>{R(n,l),S(n)&&(z(p,e),g=1)}))})),y(u,(e=>{M(w,e),L(p,e)||(z(p,e,D()),g=1),M(T(p,e),l),r(o)||M(x,e)}))})),n(),S(I)||(f?k(p,(e=>M(x,e))):k(u,(e=>s(T(v,e),(e=>M(x,e))))),y(x,(e=>{const n=(n,l)=>d(T(I,n),T(I,l),e),l=[...T(p,e)];i(l,n)||(z(p,e,D(a(l,n))),M(w,e))}))),(g||f)&&!r(c)){const n=[...p];i(n,c)||(K(e,E(a(n,c))),g=1)}g&&W(l,[e]),y(w,(n=>W(h,[e,n])))}),j(t),s(o,j)),X},delIndexDefinition:e=>(P(e),X),getStore:q,getIndexIds:B,forEachIndex:e=>F(((n,l)=>e(n,(e=>V(n,e,l))))),forEachSlice:(e,n)=>V(e,n,J(e)),hasIndex:G,hasSlice:(e,n)=>L(J(e),n),getTableId:H,getSliceIds:e=>b(J(e)),getSliceRowIds:(e,n)=>x(T(J(e),n)),addIndexIdsListener:Q,addSliceIdsListener:(e,n)=>f(n,l,[e]),addSliceRowIdsListener:(e,n,l)=>f(l,h,[e,n]),delListener:e=>($(e),X),destroy:U,getListenerStats:()=>({sliceIds:g(l),sliceRowIds:w(h)})};return I(X)})(l)),e.get(l))})();export{W as createIndexes};
