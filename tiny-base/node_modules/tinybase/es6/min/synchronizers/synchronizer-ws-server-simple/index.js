const e=e=>null==e,n=(n,l,r)=>e(n)?null==r?void 0:r():l(n),l=(e,n,l)=>e.slice(n,l),r=Object.freeze,t=(e,n)=>null==e?void 0:e.delete(n),o=e=>new Map(e),u=(e,n)=>null==e?void 0:e.get(n),c=(n,l,r)=>e(r)?(t(n,l),n):null==n?void 0:n.set(l,r),s=/\/([^?]*)/,a=a=>{const v=o();return a.on("connection",((r,a)=>{return n((i=a.url,d=s,null==i?void 0:i.match(d)),(([,s])=>n(a.headers["sec-websocket-key"],(n=>{return a=function*(){const a=(h=o,y=d=s,null!=(g=null==(f=i=v)?void 0:f.has(y))&&g||c(i,d,h()),u(i,d));var i,d,h,f,y,g;c(a,n,r),r.on("message",(e=>(e=>{const r=e.indexOf("\n");-1!==r&&((e,l)=>{var r;const t=((e,n)=>e+"\n"+n)(n,l);""===e?(e=>{((e,n)=>{null==e||e.forEach(n)})(e,((e,l)=>{return r=e,l!==n?r.send(t):0;var r}))})(a):null==(r=u(a,e))||r.send(t)})(l(e,0,r),l(e,r+1))})(e.toString("utf8")))),r.on("close",(()=>{t(a,n),(n=>e(n)||0==(e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0})(n))(a)&&t(v,s)}))},new Promise(((e,n)=>{var l=e=>{try{t(a.next(e))}catch(e){n(e)}},r=e=>{try{t(a.throw(e))}catch(e){n(e)}},t=n=>n.done?e(n.value):Promise.resolve(n.value).then(l,r);t((a=a.apply(void 0,null)).next())}));var a}))));var i,d})),r({getWebSocketServer:()=>a,destroy:()=>{v.clear(),a.close()}})};export{a as createWsServerSimple};
