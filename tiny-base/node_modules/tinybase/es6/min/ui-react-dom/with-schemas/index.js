import{useRowIds as e,useTableCellIds as l,useRowCount as t,useSortedRowIds as n,useValueIds as a,ValueView as o,useIndexesOrIndexesById as r,useSliceRowIds as s,useRelationshipsOrRelationshipsById as u,useResultRowIds as i,useResultTableCellIds as c,useResultRowCount as d,useResultSortedRowIds as m,useSetCellCallback as h,useCell as p,useStoreOrStoreById as b,useSetValueCallback as C,useValue as g,CellView as I,ResultCellView as y,useRemoteRowId as f}from"../../ui-react/with-schemas/index.js";import v from"react";const k=e=>typeof e,w=k(""),N=k(!0),O=k(0),T="Value",x="currentTarget",S="value",q=Math.min,P=isFinite,j=e=>null==e,R=(e,l,t,n)=>e==w?l:e==O?t:n,{PureComponent:E,Fragment:V,createContext:A,createElement:F,useCallback:L,useContext:M,useEffect:D,useLayoutEffect:$,useMemo:z,useRef:B,useState:G,useSyncExternalStore:H}=v,J=(e,...l)=>j(e)?{}:e(...l),K=(e,l)=>e.map(l),Q=Object,U=Q.entries,W=(e=[])=>Q.fromEntries(e),X=(e,l)=>K(U(e),(([e,t])=>l(t,e)));var Y=Object.defineProperty,Z=Object.defineProperties,_=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,ne=(e,l,t)=>l in e?Y(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,ae=(e,l)=>{for(var t in l||(l={}))le.call(l,t)&&ne(e,t,l[t]);if(ee)for(var t of ee(l))te.call(l,t)&&ne(e,t,l[t]);return e},oe=(e,l)=>Z(e,_(l)),re=(e,l)=>{var t={};for(var n in e)le.call(e,n)&&l.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&ee)for(var n of ee(e))l.indexOf(n)<0&&te.call(e,n)&&(t[n]=e[n]);return t};const se="editable",ue=(e,t)=>K(l(e,t),(l=>e+"."+l)),ie=(e,l,t)=>{const n=L(e,l);return t?n:void 0},ce=(...e)=>z((()=>e),e),de=(e,l)=>z((()=>({store:e,tableId:l})),[e,l]),me=(e,l)=>z((()=>({queries:e,queryId:l})),[e,l]),he=(e,l=!1,t,n=0,a,o,r,s)=>{const[[u,i,c],d]=G([e,l,n]),m=L((e=>{d(e),null==s||s(e)}),[s]),h=ie((e=>m([e,e==u&&!i,c])),[m,u,i,c],t),p=L((e=>m([u,i,e])),[m,u,i]),b=!0===r?Se:r;return[[u,i,c],h,z((()=>!1===r?null:F(b,{offset:c,limit:a,total:o,onChange:p})),[r,b,c,a,o,p])]},pe=(e,l,t)=>z((()=>{const n=null!=l?l:e;return a=Array.isArray(n)?W(K(n,(e=>[e,e]))):n,o=(e,l)=>ae(ae({},{label:l,component:t}),k(e)==w?{label:e}:e),W(X(a,((e,l)=>[l,o(e,l)])));var a,o}),[l,t,e]),be=({className:e,headerRow:l,idColumn:t,params:[n,a,o,r,s,u]})=>F("table",{className:e},u?F("caption",null,u):null,!1===l?null:F("thead",null,F("tr",null,!1===t?null:F(Ce,{sort:null!=r?r:[],label:"Id",onClick:s}),X(n,(({label:e},l)=>F(Ce,{key:l,cellId:l,label:e,sort:null!=r?r:[],onClick:s}))))),F("tbody",null,K(o,(e=>F("tr",{key:e},!1===t?null:F("th",null,e),X(n,(({component:l,getComponentProps:t},n)=>F("td",{key:n},F(l,oe(ae(ae({},J(t,e,n)),a),{rowId:e,cellId:n})))))))))),Ce=({cellId:e,sort:[l,t],label:n=(null!=e?e:""),onClick:a})=>F("th",{onClick:ie((()=>null==a?void 0:a(e)),[a,e],a),className:j(t)||l!=e?void 0:`sorted ${t?"de":"a"}scending`},j(t)||l!=e?null:(t?"↓":"↑")+" ",n),ge=({localRowId:e,params:[l,t,n,a,o,r,s]})=>{const u=f(o,e,r);return F("tr",null,!1===l?null:F(V,null,F("th",null,e),F("th",null,u)),X(t,(({component:l,getComponentProps:t},o)=>{const[r,i]=((e,l="",t)=>e.split(l,t))(o,".",2),c=r===n?e:r===a?u:null;return j(c)?null:F("td",{key:o},F(l,oe(ae({},J(t,c,i)),{store:s,tableId:r,rowId:c,cellId:i})))})))},Ie=({thing:e,onThingChange:l,className:t,hasSchema:n,showType:a=!0})=>{const[o,r]=G(),[s,u]=G(),[i,c]=G(),[d,m]=G(),[h,p]=G();s!==e&&(r((e=>{const l=k(e);return(e=>e==w||e==N)(l)||l==O&&P(e)?l:void 0})(e)),u(e),c(e+""),m(Number(e)||0),p(!!e));const b=L(((e,t)=>{t(e),u(e),l(e)}),[l]),C=L((()=>{if(!(null==n?void 0:n())){const e=R(o,O,N,w),t=R(e,i,d,h);r(e),u(t),l(t)}}),[n,l,i,d,h,o]);return F("div",{className:t},a?F("button",{className:o,onClick:C},o):null,R(o,F("input",{key:o,value:i,onChange:L((e=>b(e[x][S]+"",c)),[b])}),F("input",{key:o,type:"number",value:d,onChange:L((e=>b(Number(e[x][S]||0),m)),[b])}),F("input",{key:o,type:"checkbox",checked:h,onChange:L((e=>b(!!e[x].checked,p)),[b])})))},ye=t=>{var n=t,{tableId:a,store:o,editable:r,customCells:s}=n,u=re(n,["tableId","store","editable","customCells"]);return F(be,oe(ae({},u),{params:ce(pe(l(a,o),s,r?Te:I),de(o,a),e(a,o))}))},fe=e=>{var a=e,{tableId:o,cellId:r,descending:s,offset:u,limit:i,store:c,editable:d,sortOnClick:m,paginator:h=!1,onChange:p,customCells:b}=a,C=re(a,["tableId","cellId","descending","offset","limit","store","editable","sortOnClick","paginator","onChange","customCells"]);const[g,y,f]=he(r,s,m,u,i,t(o,c),h,p);return F(be,oe(ae({},C),{params:ce(pe(l(o,c),b,d?Te:I),de(c,o),n(o,...g,i,c),g,y,f)}))},ve=({store:e,editable:l=!1,valueComponent:t=(l?xe:o),getValueComponentProps:n,className:r,headerRow:s,idColumn:u})=>F("table",{className:r},!1===s?null:F("thead",null,F("tr",null,!1===u?null:F("th",null,"Id"),F("th",null,T))),F("tbody",null,K(a(e),(l=>F("tr",{key:l},!1===u?null:F("th",null,l),F("td",null,F(t,oe(ae({},J(n,l)),{valueId:l,store:e})))))))),ke=e=>{var t=e,{indexId:n,sliceId:a,indexes:o,editable:u,customCells:i}=t,c=re(t,["indexId","sliceId","indexes","editable","customCells"]);const[d,m,h]=((e,l)=>[e,null==e?void 0:e.getStore(),null==e?void 0:e.getTableId(l)])(r(o),n);return F(be,oe(ae({},c),{params:ce(pe(l(h,m),i,u?Te:I),de(m,h),s(n,a,d))}))},we=({relationshipId:l,relationships:t,editable:n,customCells:a,className:o,headerRow:r,idColumn:s=!0})=>{const[i,c,d,m]=((e,l)=>[e,null==e?void 0:e.getStore(),null==e?void 0:e.getLocalTableId(l),null==e?void 0:e.getRemoteTableId(l)])(u(t),l),h=pe([...ue(d,c),...ue(m,c)],a,n?Te:I),p=ce(s,h,d,m,l,i,c);return F("table",{className:o},!1===r?null:F("thead",null,F("tr",null,!1===s?null:F(V,null,F("th",null,d,".Id"),F("th",null,m,".Id")),X(h,(({label:e},l)=>F("th",{key:l},e))))),F("tbody",null,K(e(d,c),(e=>F(ge,{key:e,localRowId:e,params:p})))))},Ne=e=>{var l=e,{queryId:t,queries:n,customCells:a}=l,o=re(l,["queryId","queries","customCells"]);return F(be,oe(ae({},o),{params:ce(pe(c(t,n),a,y),me(n,t),i(t,n))}))},Oe=e=>{var l=e,{queryId:t,cellId:n,descending:a,offset:o,limit:r,queries:s,sortOnClick:u,paginator:i=!1,customCells:h,onChange:p}=l,b=re(l,["queryId","cellId","descending","offset","limit","queries","sortOnClick","paginator","customCells","onChange"]);const[C,g,I]=he(n,a,u,o,r,d(t,s),i,p);return F(be,oe(ae({},b),{params:ce(pe(c(t,s),h,y),me(s,t),m(t,...C,r,s),C,g,I)}))},Te=({tableId:e,rowId:l,cellId:t,store:n,className:a,showType:o})=>{var r;return F(Ie,{thing:p(e,l,t,n),onThingChange:h(e,l,t,(e=>e),[],n),className:null!=a?a:se+"Cell",showType:o,hasSchema:null==(r=b(n))?void 0:r.hasTablesSchema})},xe=({valueId:e,store:l,className:t,showType:n})=>{var a;return F(Ie,{thing:g(e,l),onThingChange:C(e,(e=>e),[],l),className:null!=t?t:se+T,showType:n,hasSchema:null==(a=b(l))?void 0:a.hasValuesSchema})},Se=({onChange:e,total:l,offset:t=0,limit:n=l,singular:a="row",plural:o=a+"s"})=>{(t>l||t<0)&&(t=0,e(0));const r=ie((()=>e(t-n)),[e,t,n],t>0),s=ie((()=>e(t+n)),[e,t,n],t+n<l);return F(V,null,l>n&&F(V,null,F("button",{className:"previous",disabled:0==t,onClick:r},"←"),F("button",{className:"next",disabled:t+n>=l,onClick:s},"→"),t+1," to ",q(l,t+n)," of "),l," ",1!=l?o:a)};export{Te as EditableCellView,xe as EditableValueView,we as RelationshipInHtmlTable,Oe as ResultSortedTableInHtmlTable,Ne as ResultTableInHtmlTable,ke as SliceInHtmlTable,fe as SortedTableInHtmlTable,Se as SortedTablePaginator,ye as TableInHtmlTable,ve as ValuesInHtmlTable};
