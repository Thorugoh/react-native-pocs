var e,n;e=this,n=function(e){"use strict";const n=e=>typeof e,t="",l=n(t),r=e=>null==e,o=(e,n,t)=>r(e)?null==t?void 0:t():n(e),s=e=>Array.isArray(e),i=e=>e.length,d=(e,n)=>e.forEach(n),u=(e,...n)=>e.push(...n),a=Object.freeze,c=e=>n=>{return t=(n,t)=>n+e(t),w(n).reduce(t,0);var t},v=e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0},f=c(v),R=c(f),h=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},p=e=>r(e)||0==v(e),w=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},g=e=>e.clear(),L=(e,n)=>null==e?void 0:e.forEach(n),I=(e,n)=>null==e?void 0:e.delete(n),y=e=>new Map(e),b=(e,n)=>null==e?void 0:e.get(n),T=(e,n)=>L(e,((e,t)=>n(t,e))),m=(e,n,t)=>r(t)?(I(e,n),e):null==e?void 0:e.set(n,t),k=(e,n,t,l)=>(h(e,n)?null==l||l(b(e,n)):m(e,n,t()),b(e,n)),E=(e,n,t,l,r=0)=>o((t?k:b)(e,n[r],r>i(n)-2?t:y),(o=>{if(r>i(n)-2)return(null==l?void 0:l(o))&&m(e,n[r]),o;const s=E(o,n,t,l,r+1);return p(o)&&m(e,n[r]),s})),x=e=>new Set(s(e)||r(e)?e:[e]),S=(e,n)=>null==e?void 0:e.add(n),j=/^\d+$/,z=(()=>{const e=new WeakMap;return c=>(e.has(c)||e.set(c,(e=>{const c=y(),v=y(),f=y(),z=y(),[A,D,M]=(()=>{let e;const[n,l]=(()=>{const e=[];let n=0;return[l=>{var r;return null!=(r=l?e.shift():null)?r:t+n++},n=>{j.test(n)&&i(e)<1e3&&u(e,n)}]})(),s=y();return[(l,r,o,i=[],d=()=>[])=>{null!=e||(e=Q);const u=n(1);return m(s,u,[l,r,o,i,d]),S(E(r,null!=o?o:[t],x),u),u},(n,l,...r)=>d(((e,n=[t])=>{const l=[],r=(e,t)=>t==i(n)?u(l,e):null===n[t]?L(e,(e=>r(e,t+1))):d([n[t],null],(n=>r(b(e,n),t+1)));return r(e,0),l})(n,l),(n=>L(n,(n=>b(s,n)[0](e,...null!=l?l:[],...r))))),e=>o(b(s,e),(([,n,r])=>(E(n,null!=r?r:[t],void 0,(n=>(I(n,e),p(n)?1:0))),m(s,e),l(e),r))),n=>o(b(s,n),(([n,,t=[],l,o])=>{const s=(...u)=>{var a,c;const v=i(u);v==i(t)?n(e,...u,...o(u)):r(t[v])?d(null!=(c=null==(a=l[v])?void 0:a.call(l,...u))?c:[],(e=>s(...u,e))):s(...u,t[v])};s()}))]})(),[B,C,O,W,$,q,,,F,G,H,J]=((e,n,l,u,a)=>{const c=e.hasRow,v=y(),f=y(),R=y(),E=y(),j=y(),z=y(),A=(n,t,...l)=>{const r=k(z,n,x);return d(l,(n=>S(r,n)&&t&&e.callListener(n))),l},D=(n,...t)=>o(b(z,n),(l=>{d(0==i(t)?w(l):t,(n=>{e.delListener(n),I(l,n)})),p(l)&&m(z,n)})),M=(e,n)=>{m(v,e,n),h(f,e)||(m(f,e,[y(),y(),y(),y()]),m(E,e,y()),m(j,e,y()),a(R))},B=e=>{m(v,e),m(f,e),m(E,e),m(j,e),D(e),a(R)};return[()=>e,()=>{return[...null!=(n=null==(e=v)?void 0:e.keys())?n:[]];var e,n},e=>T(f,e),e=>h(f,e),e=>b(v,e),e=>b(f,e),(e,n)=>m(f,e,n),M,(n,l,o,u,a)=>{M(n,l);const v=y(),f=y(),R=b(E,n),p=b(j,n),w=n=>{const o=t=>e.getCell(l,n,t),d=b(R,n),h=c(l,n)?(w=u(o,n),r(w)?void 0:w+t):void 0;var w,g,L,I;if(d===h||s(d)&&s(h)&&(L=h,i(g=d)===i(L)&&(I=(e,n)=>L[n]===e,g.every(I)))||m(v,n,[d,h]),!r(a)){const e=b(p,n),t=c(l,n)?a(o,n):void 0;e!=t&&m(f,n,t)}},I=e=>{o((()=>{L(v,(([,e],n)=>m(R,n,e))),L(f,((e,n)=>m(p,n,e)))}),v,f,R,p,e),g(v),g(f)};T(R,w),e.hasTable(l)&&d(e.getRowIds(l),(e=>{h(R,e)||w(e)})),I(!0),D(n),A(n,0,e.addRowListener(l,null,((e,n,t)=>w(t))),e.addTableListener(l,(()=>I())))},B,e=>u(e,R),()=>T(z,B),A,D]})(e,0,0,A,D),K=(e,n,t)=>o(q(e),(([l,,o])=>{if(!h(o,n)){const s=x();if($(e)!=P(e))S(s,n);else{let e=n;for(;!r(e)&&!h(s,e);)S(s,e),e=b(l,e)}if(t)return s;m(o,n,s)}return b(o,n)})),N=(e,n)=>o(q(e),(([,,e])=>m(e,n))),P=e=>b(c,e),Q={setRelationshipDefinition:(e,s,i,d)=>{return m(c,e,i),F(e,s,((n,t)=>{const l=x(),s=x(),i=x(),[d,u]=q(e);L(t,(([n,t],a)=>{r(n)||(S(s,n),o(b(u,n),(e=>{I(e,a),p(e)&&m(u,n)}))),r(t)||(S(s,t),h(u,t)||m(u,t,x()),S(b(u,t),a)),S(l,a),m(d,a,t),T(b(z,e),(n=>{h(K(e,n),a)&&S(i,n)}))})),n(),L(l,(n=>D(v,[e,n]))),L(s,(n=>D(f,[e,n]))),L(i,(n=>{N(e,n),D(z,[e,n])}))}),n(u=d)==l?e=>e(u):null!=u?u:()=>t),Q;var u},delRelationshipDefinition:e=>(m(c,e),G(e),Q),getStore:B,getRelationshipIds:C,forEachRelationship:n=>O((t=>n(t,(n=>e.forEachRow($(t),n))))),hasRelationship:W,getLocalTableId:$,getRemoteTableId:P,getRemoteRowId:(e,n)=>{var t;return b(null==(t=q(e))?void 0:t[0],n)},getLocalRowIds:(e,n)=>{var t;return w(b(null==(t=q(e))?void 0:t[1],n))},getLinkedRowIds:(e,n)=>r(q(e))?[n]:w(K(e,n,!0)),addRelationshipIdsListener:H,addRemoteRowIdListener:(e,n,t)=>A(t,v,[e,n]),addLocalRowIdsListener:(e,n,t)=>A(t,f,[e,n]),addLinkedRowIdsListener:(e,n,t)=>(K(e,n),A(t,z,[e,n])),delListener:e=>{var n;return N(...null!=(n=M(e))?n:[]),Q},destroy:J,getListenerStats:()=>({remoteRowId:R(v),localRowIds:R(f),linkedRowIds:R(z)})};return a(Q)})(c)),e.get(c))})();e.createRelationships=z},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
