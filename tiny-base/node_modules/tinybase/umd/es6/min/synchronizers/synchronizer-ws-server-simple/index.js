var e,n;e=this,n=function(e){"use strict";const n=e=>null==e,t=(e,t,o)=>n(e)?null==o?void 0:o():t(e),o=(e,n,t)=>e.slice(n,t),l=Object.freeze,r=(e,n)=>null==e?void 0:e.delete(n),s=e=>new Map(e),i=(e,n)=>null==e?void 0:e.get(n),u=(e,t,o)=>n(o)?(r(e,t),e):null==e?void 0:e.set(t,o),c=/\/([^?]*)/;e.createWsServerSimple=e=>{const a=s();return e.on("connection",((e,l)=>{return t((d=l.url,v=c,null==d?void 0:d.match(v)),(([,c])=>t(l.headers["sec-websocket-key"],(t=>{return l=function*(){const l=(f=s,p=v=c,null!=(y=null==(h=d=a)?void 0:h.has(p))&&y||u(d,v,f()),i(d,v));var d,v,f,h,p,y;u(l,t,e),e.on("message",(e=>(e=>{const n=e.indexOf("\n");-1!==n&&((e,n)=>{var o;const r=((e,n)=>e+"\n"+n)(t,n);""===e?(e=>{((e,n)=>{null==e||e.forEach(n)})(e,((e,n)=>{return o=e,n!==t?o.send(r):0;var o}))})(l):null==(o=i(l,e))||o.send(r)})(o(e,0,n),o(e,n+1))})(e.toString("utf8")))),e.on("close",(()=>{r(l,t),(e=>n(e)||0==(e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0})(e))(l)&&r(a,c)}))},new Promise(((e,n)=>{var t=e=>{try{r(l.next(e))}catch(e){n(e)}},o=e=>{try{r(l.throw(e))}catch(e){n(e)}},r=n=>n.done?e(n.value):Promise.resolve(n.value).then(t,o);r((l=l.apply(void 0,null)).next())}));var l}))));var d,v})),l({getWebSocketServer:()=>e,destroy:()=>{a.clear(),e.close()}})}},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseSynchronizerWsServerSimple={});
