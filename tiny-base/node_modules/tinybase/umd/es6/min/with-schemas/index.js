var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",l=t(n),s=t(!0),r=t(0),o=t(t),a="type",i="default",d="Listener",c="Result",u="add",g="Has",v="Ids",h="Table",f=h+"s",b=h+v,I="Row",p=I+"Count",w=I+v,L="Sorted"+I+v,C="Cell",R=C+v,T="Value",S=T+"s",y=T+v,M=e=>n+e,m=(e,t)=>e.startsWith(t),V=(e,t)=>e.endsWith(t),E=(e,t=n,l)=>e.split(t,l),k=globalThis,D=Math,x=D.max,H=D.min,J=D.floor,O=isFinite,F=e=>null==e,Q=(e,t,n)=>F(e)?null==n?void 0:n():t(e),j=e=>e==l||e==s,P=e=>t(e)==l,z=e=>t(e)==o,N=e=>Array.isArray(e),W=(e,t,n)=>e.slice(t,n),A=e=>e.length,_=()=>{},B=(e,t)=>e.includes(t),U=(e,t)=>e.every(t),q=(e,t)=>A(e)===A(t)&&U(e,((e,n)=>t[n]===e)),G=(e,t)=>U(e,((n,l)=>0==l||t(e[l-1],n)<=0)),K=(e,t)=>e.sort(t),X=(e,t)=>e.forEach(t),Y=(e,t)=>e.map(t),Z=e=>ee(e,((e,t)=>e+t),0),$=e=>0==A(e),ee=(e,t,n)=>e.reduce(t,n),te=(e,...t)=>e.push(...t),ne=e=>e.pop(),le=e=>e.shift(),se=Object,re=e=>se.getPrototypeOf(e),oe=se.entries,ae=se.isFrozen,ie=e=>!F(e)&&Q(re(e),(e=>e==se.prototype||F(re(e))),(()=>!0)),de=se.keys,ce=se.freeze,ue=(e=[])=>se.fromEntries(e),ge=(e,t)=>t in e,ve=(e,t)=>(delete e[t],e),he=(e,t)=>X(oe(e),(([e,n])=>t(n,e))),fe=(e,t)=>ue(((e,t)=>Y(oe(e),(([e,n])=>t(n,e))))(e,((e,n)=>[n,t(e,n)]))),be=e=>ie(e)&&0==(e=>A(de(e)))(e),Ie=(e,t,n)=>(ge(e,t)||(e[t]=n()),e[t]),pe=(e,t,n,l=0)=>F(e)||!ie(e)||!l&&be(e)||ae(e)?(null==n||n(),!1):(he(e,((n,l)=>{t(n,l)||ve(e,l)})),!!l||!be(e)),we=e=>t=>ee(Me(t),((t,n)=>t+e(n)),0),Le=e=>{var t;return null!=(t=null==e?void 0:e.size)?t:0},Ce=we(Le),Re=we(Ce),Te=we(Re),Se=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},ye=e=>F(e)||0==Le(e),Me=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},me=e=>e.clear(),Ve=(e,t)=>null==e?void 0:e.forEach(t),Ee=(e,t)=>null==e?void 0:e.delete(t),ke=e=>new Map(e),De=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},xe=(e,t)=>null==e?void 0:e.get(t),He=(e,t)=>Ve(e,((e,n)=>t(n,e))),Je=(e,t,n)=>F(n)?(Ee(e,t),e):null==e?void 0:e.set(t,n),Oe=(e,t,n,l)=>(Se(e,t)?null==l||l(xe(e,t)):Je(e,t,n()),xe(e,t)),Fe=(e,t,n,l=Je)=>(fe(t,((t,l)=>n(e,l,t))),He(e,(n=>ge(t,n)?0:l(e,n))),e),Qe=(e,t,n,l)=>{const s={};return Ve(e,((e,r)=>{if(!(null==n?void 0:n(e,r))){const n=t?t(e,r):e;(null==l?void 0:l(n))||(s[r]=n)}})),s},je=(e,t,n)=>Qe(e,(e=>Qe(e,t,n)),ye,be),Pe=(e,t,n)=>Qe(e,(e=>je(e,t,n)),ye,be),ze=(e,t)=>{const n=ke();return Ve(e,((e,l)=>{var s;return n.set(l,null!=(s=null==t?void 0:t(e))?s:e)})),n},Ne=e=>ze(e,ze),We=e=>ze(e,Ne),Ae=(e,t,n,l,s=0)=>Q((n?Oe:xe)(e,t[s],s>A(t)-2?n:ke),(r=>{if(s>A(t)-2)return(null==l?void 0:l(r))&&Je(e,t[s]),r;const o=Ae(r,t,n,l,s+1);return ye(r)&&Je(e,t[s]),o})),_e=e=>{const n=t(e);return j(n)||n==r&&O(e)?n:void 0},Be=e=>F(e)||!F(_e(e)),Ue=(e,t,n,l,s)=>F(s)?e.delCell(t,n,l,!0):e.setCell(t,n,l,s),qe=(e,t,n)=>F(n)?e.delValue(t):e.setValue(t,n),Ge=e=>new Set(N(e)||F(e)?e:[e]),Ke=(e,t)=>null==e?void 0:e.add(t),Xe=(e,t,n,l,s)=>{const r=e.hasRow,o=ke(),a=ke(),i=ke(),d=ke(),c=ke(),u=ke(),g=(t,n,...l)=>{const s=Oe(u,t,Ge);return X(l,(t=>Ke(s,t)&&n&&e.callListener(t))),l},v=(t,...n)=>Q(xe(u,t),(l=>{X($(n)?Me(l):n,(t=>{e.delListener(t),Ee(l,t)})),ye(l)&&Je(u,t)})),h=(e,n)=>{Je(o,e,n),Se(a,e)||(Je(a,e,t()),Je(d,e,ke()),Je(c,e,ke()),s(i))},f=e=>{Je(o,e),Je(a,e),Je(d,e),Je(c,e),v(e),s(i)};return[()=>e,()=>De(o),e=>He(a,e),e=>Se(a,e),e=>xe(o,e),e=>xe(a,e),(e,t)=>Je(a,e,t),h,(t,l,s,o,a)=>{h(t,l);const i=ke(),u=ke(),f=xe(d,t),b=xe(c,t),I=t=>{const s=n=>e.getCell(l,t,n),d=xe(f,t),c=r(l,t)?n(o(s,t)):void 0;if(d===c||N(d)&&N(c)&&q(d,c)||Je(i,t,[d,c]),!F(a)){const e=xe(b,t),n=r(l,t)?a(s,t):void 0;e!=n&&Je(u,t,n)}},p=e=>{s((()=>{Ve(i,(([,e],t)=>Je(f,t,e))),Ve(u,((e,t)=>Je(b,t,e)))}),i,u,f,b,e),me(i),me(u)};He(f,I),e.hasTable(l)&&X(e.getRowIds(l),(e=>{Se(f,e)||I(e)})),p(!0),v(t),g(t,0,e.addRowListener(l,null,((e,t,n)=>I(n))),e.addTableListener(l,(()=>p())))},f,e=>l(e,i),()=>He(u,f),g,v]},Ye=(e,t)=>P(e)?t=>t(e):null!=e?e:()=>null!=t?t:n,Ze=(e,t)=>{const n=new WeakMap;return l=>{n.has(l)||n.set(l,e(l));const s=n.get(l);return null==t||t(s),s}},$e=/^\d+$/,et=()=>{const e=[];let t=0;return[l=>{var s;return null!=(s=l?le(e):null)?s:n+t++},t=>{$e.test(t)&&A(e)<1e3&&te(e,t)}]},tt=e=>{let t;const[l,s]=et(),r=ke();return[(s,o,a,i=[],d=()=>[])=>{null!=t||(t=e());const c=l(1);return Je(r,c,[s,o,a,i,d]),Ke(Ae(o,null!=a?a:[n],Ge),c),c},(e,l,...s)=>X(((e,t=[n])=>{const l=[],s=(e,n)=>n==A(t)?te(l,e):null===t[n]?Ve(e,(e=>s(e,n+1))):X([t[n],null],(t=>s(xe(e,t),n+1)));return s(e,0),l})(e,l),(e=>Ve(e,(e=>xe(r,e)[0](t,...null!=l?l:[],...s))))),e=>Q(xe(r,e),(([,t,l])=>(Ae(t,null!=l?l:[n],void 0,(t=>(Ee(t,e),ye(t)?1:0))),Je(r,e),s(e),l))),e=>Q(xe(r,e),(([e,,n=[],l,s])=>{const r=(...o)=>{var a,i;const d=A(o);d==A(n)?e(t,...o,...s(o)):F(n[d])?X(null!=(i=null==(a=l[d])?void 0:a.call(l,...o))?i:[],(e=>r(...o,e))):r(...o,n[d])};r()}))]},nt=Ze((e=>{let t,l,s,r=100,o=ke(),a=ke(),i=1;const d=ke(),c=ke(),[u,g,v]=tt((()=>H)),h=ke(),f=ke(),b=[],I=[],p=(t,n)=>{i=0,e.transaction((()=>{const[l,s]=xe(h,n);Ve(l,((n,l)=>Ve(n,((n,s)=>Ve(n,((n,r)=>Ue(e,l,s,r,n[t]))))))),Ve(s,((n,l)=>qe(e,l,n[t])))})),i=1},w=e=>{Je(h,e),Je(f,e),g(c,[e])},L=(e,t)=>X(((e,t)=>e.splice(0,t))(e,null!=t?t:A(e)),w),C=()=>L(b,A(b)-r),R=()=>Q(t,(()=>{te(b,t),C(),L(I),t=void 0,s=1})),T=()=>{t=ne(b),s=1};let S,y;const M=(e=n)=>(F(t)&&(t=n+l++,Je(h,t,[o,a]),D(t,e),o=ke(),a=ke(),s=1),t),m=()=>{$(b)||(((e,...t)=>{e.unshift(...t)})(I,M()),p(0,t),t=ne(b),s=1)},V=()=>{$(I)||(te(b,t),t=le(I),p(1,t),s=1)},E=()=>{s&&(g(d),s=0)},k=e=>{const t=M(e);return E(),t},D=(e,t)=>(x(e)&&xe(f,e)!==t&&(Je(f,e,t),g(c,[e])),H),x=e=>Se(h,e),H={setSize:e=>(r=e,C(),H),addCheckpoint:k,setCheckpoint:D,getStore:()=>e,getCheckpointIds:()=>[[...b],t,[...I]],forEachCheckpoint:e=>He(f,e),hasCheckpoint:x,getCheckpoint:e=>xe(f,e),goBackward:()=>(m(),E(),H),goForward:()=>(V(),E(),H),goTo:e=>{const n=B(b,e)?m:B(I,e)?V:null;for(;!F(n)&&e!=t;)n();return E(),H},addCheckpointIdsListener:e=>u(e,d),addCheckpointListener:(e,t)=>u(t,c,[e]),delListener:e=>(v(e),H),clear:()=>(L(b),L(I),F(t)||w(t),t=void 0,l=0,k(),H),clearForward:()=>($(I)||(L(I),g(d)),H),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Ce(d),checkpoint:Ce(c)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,n,l,s,r)=>{if(i){R();const e=Oe(o,t,ke),a=Oe(e,n,ke),i=Oe(a,l,(()=>[r,void 0]));i[1]=s,i[0]===s&&ye(Je(a,l))&&ye(Je(e,n))&&ye(Je(o,t))&&T(),E()}})),y=e.addValueListener(null,((e,t,n,l)=>{if(i){R();const e=Oe(a,t,(()=>[l,void 0]));e[1]=n,e[0]===n&&ye(Je(a,t))&&T(),E()}}))}};return ce(H.clear())}),(e=>e._registerListeners())),lt=E("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),st=ke(Y(lt,((e,t)=>[e,t]))),rt=e=>lt[63&e],ot=(e,t)=>{var n;return null!=(n=xe(st,e[t]))?n:0},at=k.crypto?e=>k.crypto.getRandomValues(e):e=>Y(e,(()=>J(256*D.random()))),it=(e,t)=>(null!=e?e:0)<(null!=t?t:0)?-1:1,dt=(e=16)=>ee(at(new Uint8Array(e)),((e,t)=>e+rt(t)),""),ct=Ze((e=>{const t=ke(),l=ke(),[s,r,o]=tt((()=>w)),[a,i,d,c,u,g,v,,h,f,b,I]=Xe(e,ke,(e=>F(e)?n:N(e)?Y(e,M):M(e)),s,r),p=(t,n,l)=>{const s=u(t);Ve(l,((t,l)=>n(l,(n=>Ve(t,(t=>n(t,(n=>e.forEachCell(s,t,n)))))))))},w={setIndexDefinition:(e,n,s,o,a,i=it)=>{const d=F(a)?void 0:([e],[t])=>a(e,t);return h(e,n,((n,s,a,c,u,h)=>{let f=0;const b=Ge(),I=Ge(),p=g(e);if(Ve(s,(([e,t],n)=>{const l=Ge(e),s=Ge(t);Ve(l,(e=>Ee(s,e)?Ee(l,e):0)),Ve(l,(e=>{Ke(b,e),Q(xe(p,e),(t=>{Ee(t,n),ye(t)&&(Je(p,e),f=1)}))})),Ve(s,(e=>{Ke(b,e),Se(p,e)||(Je(p,e,Ge()),f=1),Ke(xe(p,e),n),F(o)||Ke(I,e)}))})),n(),ye(u)||(h?He(p,(e=>Ke(I,e))):He(a,(e=>Q(xe(c,e),(e=>Ke(I,e))))),Ve(I,(e=>{const t=(t,n)=>i(xe(u,t),xe(u,n),e),n=[...xe(p,e)];G(n,t)||(Je(p,e,Ge(K(n,t))),Ke(b,e))}))),(f||h)&&!F(d)){const t=[...p];G(t,d)||(v(e,ke(K(t,d))),f=1)}f&&r(t,[e]),Ve(b,(t=>r(l,[e,t])))}),Ye(s),Q(o,Ye)),w},delIndexDefinition:e=>(f(e),w),getStore:a,getIndexIds:i,forEachIndex:e=>d(((t,n)=>e(t,(e=>p(t,e,n))))),forEachSlice:(e,t)=>p(e,t,g(e)),hasIndex:c,hasSlice:(e,t)=>Se(g(e),t),getTableId:u,getSliceIds:e=>De(g(e)),getSliceRowIds:(e,t)=>Me(xe(g(e),t)),addIndexIdsListener:b,addSliceIdsListener:(e,n)=>s(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>s(n,l,[e,t]),delListener:e=>(o(e),w),destroy:I,getListenerStats:()=>({sliceIds:Ce(t),sliceRowIds:Re(l)})};return ce(w)})),ut=ke([["avg",[(e,t)=>Z(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,l)=>e+(t-n)/l]],["max",[e=>x(...e),(e,t)=>x(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:x(t,e)]],["min",[e=>H(...e),(e,t)=>H(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:H(t,e)]],["sum",[e=>Z(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),gt=(e,t,n,l,s,r=!1)=>{if(ye(n))return;const[o,a,i,d]=s;return r||(r=F(e)),Ve(l,(([n,l])=>{r||(e=F(n)?null==a?void 0:a(e,l,t++):F(l)?null==i?void 0:i(e,n,t--):null==d?void 0:d(e,l,n,t),r||(r=F(e)))})),r?o(Me(n),Le(n)):e},vt=Ze((e=>{const t=ke(),[l,s,r]=tt((()=>I)),[o,a,i,d,c,u,g,,v,h,f,b]=Xe(e,_,(e=>isNaN(e)||F(e)||!0===e||!1===e||e===n?void 0:1*e),l,s),I={setMetricDefinition:(e,n,l,r,o,a,i)=>{var d;const c=z(l)?[l,o,a,i]:null!=(d=xe(ut,l))?d:xe(ut,"sum");return v(e,n,((n,l,r,o,a,i)=>{const d=u(e),v=Le(o);i||(i=F(d)),n();let h=gt(d,v,o,l,c,i);O(h)||(h=void 0),h!=d&&(g(e,h),s(t,[e],h,d))}),Ye(r,1)),I},delMetricDefinition:e=>(h(e),I),getStore:o,getMetricIds:a,forEachMetric:i,hasMetric:d,getTableId:c,getMetric:u,addMetricIdsListener:f,addMetricListener:(e,n)=>l(n,t,[e]),delListener:e=>(r(e),I),destroy:b,getListenerStats:()=>({metric:Ce(t)})};return ce(I)}));var ht=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;const It=Ze((e=>{const t=e.createStore,l=t(),s=t(),r=ke(),{addListener:o,callListeners:a,delListener:i}=s,[g,v,f,b,T,,,S,,y,M,m,V,E]=Xe(e,(()=>!0),_,o,a),k=(e,t,...n)=>X(n,(n=>Ke(Oe(Oe(r,t,ke),e,Ge),n))),D=e=>{Q(xe(r,e),(e=>{He(e,((e,t)=>Ve(t,(t=>e.delListener(t))))),me(e)})),X([s,l],(t=>t.delTable(e)))},x=(e,t,n)=>k(t,e,t.addStartTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),H={setQueryDefinition:(t,r,o)=>{S(t,r),D(t);const a=[],i=[[null,[r,null,null,[],ke()]]],d=[],c=[],u=[];o({select:(e,t)=>{const l=z(e)?[A(a)+n,e]:[F(t)?e:t,n=>n(e,t)];return te(a,l),{as:e=>l[0]=e}},join:(e,t,n)=>{const l=F(n)||z(t)?null:t,s=F(l)?t:n,r=[e,[e,l,z(s)?s:e=>e(s),[],ke()]];return te(i,r),{as:e=>r[0]=e}},where:(e,t,n)=>te(d,z(e)?e:F(n)?n=>n(e)===t:l=>l(e,t)===n),group:(e,t,n,l,s)=>{var r;const o=[e,[e,z(t)?[t,n,l,s]:null!=(r=xe(ut,t))?r:[(e,t)=>t]]];return te(c,o),{as:e=>o[0]=e}},having:(e,t)=>te(u,z(e)?e:n=>n(e)===t)});const g=ke(a);if(ye(g))return H;const v=ke(i);He(v,((e,[,t])=>Q(xe(v,t),(({3:t})=>F(e)?0:te(t,e)))));const h=ke(c);let f=l;if(ye(h)&&$(u))f=s;else{x(t,f,s);const e=ke();He(h,((t,[n,l])=>Ke(Oe(e,n,Ge),[t,l])));const n=Ge();He(g,(t=>Se(e,t)?0:Ke(n,t)));const l=ke(),r=(n,l,r,o)=>Q(n,(([a,i,d,c])=>{He(l,((t,[n])=>{const l=Oe(a,t,ke),s=xe(l,r),i=o?void 0:n;if(s!==i){const n=Ge([[s,i]]),o=Le(l);Je(l,r,i),Ve(xe(e,t),(([e,t])=>{const s=gt(c[e],o,l,n,t);c[e]=F(_e(s))?null:s}))}})),ye(i)||!U(u,(e=>e((e=>c[e]))))?s.delRow(t,d):F(d)?n[2]=s.addRow(t,c):s.setRow(t,d,c)}));k(f,t,f.addRowListener(t,null,((s,o,a,i)=>{const d=[],c=[],u=ke(),g=f.hasRow(t,a);let v=!g;Ve(n,(e=>{const[n,l,s]=i(t,a,e);te(d,l),te(c,s),v||(v=n)})),He(e,(e=>{const[n,,l]=i(t,a,e);(v||n)&&Je(u,e,[l])})),v&&r(Ae(l,d,void 0,(([,e])=>(Ee(e,a),ye(e)))),u,a,1),g&&r(Ae(l,c,(()=>{const e={};return Ve(n,(n=>e[n]=f.getCell(t,a,n))),[ke(),Ge(),void 0,e]}),(([,e])=>{Ke(e,a)})),u,a)})))}x(t,e,f);const b=(n,l,s,o)=>{const a=t=>e.getCell(l,s,t);X(o,(l=>{var s;const[r,,o,i,d]=xe(v,l),c=null==o?void 0:o(a,n),[u,g]=null!=(s=xe(d,n))?s:[];c!=u&&(F(g)||E(t,g),Je(d,n,F(c)?null:[c,...V(t,1,e.addRowListener(r,c,(()=>b(n,r,c,i))))]))})),(n=>{const l=(t,l)=>{var s,o,a;return e.getCell(...F(l)?[r,n,t]:t===r?[r,n,l]:[null==(s=xe(v,t))?void 0:s[0],null==(a=xe(null==(o=xe(v,t))?void 0:o[4],n))?void 0:a[0],l])};f.transaction((()=>U(d,(e=>e(l)))?He(g,((e,s)=>Ue(f,t,n,e,s(l,n)))):f.delRow(t,n)))})(n)},{3:I}=xe(v,null);return f.transaction((()=>V(t,1,e.addRowListener(r,null,((n,l,s)=>{e.hasRow(r,s)?b(s,r,s,I):(f.delRow(t,s),Ve(v,(({4:e})=>Q(xe(e,s),(([,n])=>{E(t,n),Je(e,s)})))))}))))),H},delQueryDefinition:e=>(D(e),y(e),H),getStore:g,getQueryIds:v,forEachQuery:f,hasQuery:b,getTableId:T,addQueryIdsListener:e=>M((()=>e(H))),delListener:e=>(i(e),H),destroy:m,getListenerStats:()=>{const e=s.getListenerStats(),{tables:t,tableIds:n,transaction:l}=e;return((e,t)=>{var n={};for(var l in e)ft.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&ht)for(var l of ht(e))t.indexOf(l)<0&&bt.call(e,l)&&(n[l]=e[l]);return n})(e,["tables","tableIds","transaction"])}};return fe({[h]:[1,1],[h+R]:[0,1],[p]:[0,1],[w]:[0,1],[L]:[0,5],[I]:[1,2],[R]:[0,2],[C]:[1,3]},(([e,t],n)=>{X(e?["get","has","forEach"]:["get"],(e=>H[e+c+n]=(...t)=>s[e+n](...t))),H[u+c+n+d]=(...e)=>s[u+n+d](...W(e,0,t),((n,...l)=>e[t](H,...l)),!0)})),ce(H)})),pt=Ze((e=>{const t=ke(),l=ke(),s=ke(),r=ke(),[o,a,i]=tt((()=>R)),[d,c,u,g,v,h,,,f,b,I,p]=Xe(e,(()=>[ke(),ke(),ke(),ke()]),(e=>F(e)?void 0:e+n),o,a),w=(e,t,n)=>Q(h(e),(([l,,s])=>{if(!Se(s,t)){const r=Ge();if(v(e)!=C(e))Ke(r,t);else{let e=t;for(;!F(e)&&!Se(r,e);)Ke(r,e),e=xe(l,e)}if(n)return r;Je(s,t,r)}return xe(s,t)})),L=(e,t)=>Q(h(e),(([,,e])=>Je(e,t))),C=e=>xe(t,e),R={setRelationshipDefinition:(e,n,o,i)=>(Je(t,e,o),f(e,n,((t,n)=>{const o=Ge(),i=Ge(),d=Ge(),[c,u]=h(e);Ve(n,(([t,n],l)=>{F(t)||(Ke(i,t),Q(xe(u,t),(e=>{Ee(e,l),ye(e)&&Je(u,t)}))),F(n)||(Ke(i,n),Se(u,n)||Je(u,n,Ge()),Ke(xe(u,n),l)),Ke(o,l),Je(c,l,n),He(xe(r,e),(t=>{Se(w(e,t),l)&&Ke(d,t)}))})),t(),Ve(o,(t=>a(l,[e,t]))),Ve(i,(t=>a(s,[e,t]))),Ve(d,(t=>{L(e,t),a(r,[e,t])}))}),Ye(i)),R),delRelationshipDefinition:e=>(Je(t,e),b(e),R),getStore:d,getRelationshipIds:c,forEachRelationship:t=>u((n=>t(n,(t=>e.forEachRow(v(n),t))))),hasRelationship:g,getLocalTableId:v,getRemoteTableId:C,getRemoteRowId:(e,t)=>{var n;return xe(null==(n=h(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return Me(xe(null==(n=h(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>F(h(e))?[t]:Me(w(e,t,!0)),addRelationshipIdsListener:I,addRemoteRowIdListener:(e,t,n)=>o(n,l,[e,t]),addLocalRowIdsListener:(e,t,n)=>o(n,s,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(w(e,t),o(n,r,[e,t])),delListener:e=>{var t;return L(...null!=(t=i(e))?t:[]),R},destroy:p,getListenerStats:()=>({remoteRowId:Re(l),localRowIds:Re(s),linkedRowIds:Re(r)})};return ce(R)})),wt=new k.TextEncoder,Lt=e=>{let t=2166136261;return X(wt.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},Ct=([e,t])=>Tt(e,t),Rt=([e,t,n])=>[e,t,n],Tt=(e,t)=>t?[e,t]:[e],St=(e,t,n)=>[e,t,n],yt=e=>e[2],Mt=(e,t)=>Lt(e+":"+t),mt=(e,t)=>t>e?(e?Lt(e):0)^Lt(t):0,Vt=(e,t)=>{var n;return null!=(n=(null!=e?e:"")>(null!=t?t:"")?e:t)?n:""},Et=(e,t,n)=>{t>e[1]&&(e[1]=t),e[2]=n>>>0},kt=(e=n)=>Tt(ue(),e),Dt=(e=n)=>[ke(),e,0],xt=([e,t,n],l=Rt)=>[Qe(e,l),t,n],Ht=([e,t],n=Ct)=>Tt(Qe(e,n),t),Jt=(e,n)=>N(e)&&3==A(e)&&P(e[1])&&t(e[2])==r&&O(e[2])&&n(e[0]),Ot=e=>[e,e],Ft=(e,t=Ce)=>t(e[0])+t(e[1]),Qt=()=>[ke(),ke()],jt=e=>[...e],Pt=([e,t])=>e===t,zt=JSON.stringify,Nt=JSON.parse,Wt=e=>zt(e,((e,t)=>t instanceof Map?se.fromEntries([...t]):t)),At=(e,t,n)=>Je(e,t,xe(e,t)==-n?void 0:n),_t=()=>{let e,t,n=!1,l=!1,s=0,o=[];const c=ke(),v=ke(),L=ke(),m=ke(),V=ke(),E=ke(),k=ke(),D=ke(),x=ke(),H=ke(),J=ke(),O=ke(),P=ke(),A=ke(),_=Ge(),U=ke(),G=ke(),Z=ke(),$=ke(),ee=Qt(),ne=Qt(),le=Qt(),se=Qt(),re=Qt(),oe=Qt(),ae=Qt(),ie=Qt(),de=Qt(),ue=Qt(),he=Qt(),Ie=Qt(),we=Qt(),Me=Qt(),Ae=Qt(),Be=Qt(),Xe=Qt(),Ye=Qt(),Ze=Qt(),$e=Qt(),nt=Qt(),lt=Qt(),st=ke(),rt=Qt(),[ot,at,dt,ct]=tt((()=>zn)),ut=e=>{if(!pe(e,((e,t)=>B([a,i],t))))return!1;const t=e[a];return!(!j(t)&&t!=r||(_e(e[i])!=t&&ve(e,i),0))},gt=N,vt=(t,n)=>(!e||Se(J,n)||Yt(n))&&pe(t,((e,t)=>ht(n,t,e)),(()=>Yt(n))),ht=(e,t,n,l)=>pe(l?n:pt(n,e,t),((l,s)=>Q(ft(e,t,s,l),(e=>(n[s]=e,!0)),(()=>!1))),(()=>Yt(e,t))),ft=(t,n,l,s)=>e?Q(xe(xe(J,t),l),(e=>_e(s)!=e[a]?Yt(t,n,l,s,e[i]):s),(()=>Yt(t,n,l,s))):F(_e(s))?Yt(t,n,l,s):s,bt=(e,t)=>pe(t?e:wt(e),((t,n)=>Q(It(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>Zt())),It=(e,n)=>t?Q(xe(P,e),(t=>_e(n)!=t[a]?Zt(e,n,t[i]):n),(()=>Zt(e,n))):F(_e(n))?Zt(e,n):n,pt=(e,t,n)=>(Q(xe(O,t),(([l,s])=>{Ve(l,((t,n)=>{ge(e,n)||(e[n]=t)})),Ve(s,(l=>{ge(e,l)||Yt(t,n,l)}))})),e),wt=e=>(t&&(Ve(A,((t,n)=>{ge(e,n)||(e[n]=t)})),Ve(_,(t=>{ge(e,t)||Zt(t)}))),e),Lt=e=>Fe(J,e,((e,t,n)=>{const l=ke(),s=Ge();Fe(Oe(J,t,ke),n,((e,t,n)=>{Je(e,t,n),Q(n[i],(e=>Je(l,t,e)),(()=>Ke(s,t)))})),Je(O,t,[l,s])}),((e,t)=>{Je(J,t),Je(O,t)})),Ct=e=>Fe(P,e,((e,t,n)=>{Je(P,t,n),Q(n[i],(e=>Je(A,t,e)),(()=>Ke(_,t)))}),((e,t)=>{Je(P,t),Je(A,t),Ee(_,t)})),Rt=e=>be(e)?Dn():Mn(e),Tt=e=>Fe(Z,e,((e,t,n)=>St(t,n)),((e,t)=>xt(t))),St=(e,t)=>Fe(Oe(Z,e,(()=>(Bt(e,1),Je(U,e,et()),Je(G,e,ke()),ke()))),t,((t,n,l)=>yt(e,t,n,l)),((t,n)=>Ht(e,t,n))),yt=(e,t,n,l,s)=>Fe(Oe(t,n,(()=>(Ut(e,n,1),ke()))),l,((t,l,s)=>Mt(e,n,t,l,s)),((l,r)=>Jt(e,t,n,l,r,s))),Mt=(e,t,n,l,s)=>{Se(n,l)||qt(e,t,l,1);const r=xe(n,l);s!==r&&(Gt(e,t,l,r,s),Je(n,l,s))},mt=(e,t,n,l,s)=>Q(xe(t,n),(t=>Mt(e,n,t,l,s)),(()=>yt(e,t,n,pt({[l]:s},e,n)))),Vt=e=>be(e)?Jn():mn(e),Et=e=>Fe($,e,((e,t,n)=>kt(t,n)),((e,t)=>zt(t))),kt=(e,t)=>{Se($,e)||Kt(e,1);const n=xe($,e);t!==n&&(Xt(e,n,t),Je($,e,t))},Dt=e=>{var t;return null!=(t=xe(Z,e))?t:St(e,{})},xt=e=>St(e,{}),Ht=(e,t,n)=>{const[,l]=xe(U,e);l(n),yt(e,t,n,{},!0)},Jt=(e,t,n,l,s,r)=>{var o;const a=xe(null==(o=xe(O,e))?void 0:o[0],s);if(!F(a)&&!r)return Mt(e,n,l,s,a);const i=t=>{Gt(e,n,t,xe(l,t)),qt(e,n,t,-1),Je(l,t)};F(a)?i(s):He(l,i),ye(l)&&(Ut(e,n,-1),ye(Je(t,n))&&(Bt(e,-1),Je(Z,e),Je(U,e),Je(G,e)))},zt=e=>{const t=xe(A,e);if(!F(t))return kt(e,t);Xt(e,xe($,e)),Kt(e,-1),Je($,e)},Bt=(e,t)=>At(c,e,t),Ut=(e,t,n)=>At(Oe(m,e,ke),t,n)&&Je(L,e,Oe(L,e,(()=>0))+n),qt=(e,t,n,l)=>{var s;const r=xe(G,e),o=null!=(s=xe(r,n))?s:0;(0==o&&1==l||1==o&&-1==l)&&At(Oe(v,e,ke),n,l),Je(r,n,o!=-l?o+l:null),At(Oe(Oe(V,e,ke),t,ke),n,l)},Gt=(e,t,n,l,s)=>{var r;Oe(Oe(Oe(E,e,ke),t,ke),n,(()=>[l,0]))[1]=s,null==(r=o[3])||r.call(o,e,t,n,s)},Kt=(e,t)=>At(k,e,t),Xt=(e,t,n)=>{var l;Oe(D,e,(()=>[t,0]))[1]=n,null==(l=o[4])||l.call(o,e,n)},Yt=(e,t,n,l,s)=>(te(Oe(Oe(Oe(x,e,ke),t,ke),n,(()=>[])),l),s),Zt=(e,t,n)=>(te(Oe(H,e,(()=>[])),t),n),$t=(e,t,n)=>Q(xe(xe(xe(E,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Ot(fn(e,t,n))])),en=e=>Q(xe(D,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Ot(pn(e))])),tn=e=>ye(x)||ye(Be[e])?0:Ve(e?We(x):x,((t,n)=>Ve(t,((t,l)=>Ve(t,((t,s)=>at(Be[e],[n,l,s],t))))))),nn=e=>ye(H)||ye(Xe[e])?0:Ve(e?ze(H):H,((t,n)=>at(Xe[e],[n],t))),ln=(e,t,n,l)=>{if(!ye(e))return at(t,l,(()=>Qe(e))),He(e,((e,t)=>at(n,[...null!=l?l:[],e],1==t))),1},sn=e=>{const t=wn();t!=n&&at(ee[e],void 0,t);const l=ye(ue[e]),s=ye(we[e])&&ye(Me[e])&&ye(de[e])&&ye(he[e])&&ye(oe[e])&&ye(ae[e])&&ye(ie[e])&&l&&ye(le[e])&&ye(se[e]),r=ye(Ae[e])&&ye(Ie[e])&&ye(re[e])&&ye(ne[e]);if(!s||!r){const t=e?[ze(c),Ne(v),ze(L),Ne(m),We(V),We(E)]:[c,v,L,m,V,E];if(!s){ln(t[0],le[e],se[e]),Ve(t[1],((t,n)=>ln(t,oe[e],ae[e],[n]))),Ve(t[2],((t,n)=>{0!=t&&at(ie[e],[n],un(n))}));const n=Ge();Ve(t[3],((t,s)=>{ln(t,de[e],he[e],[s])&&!l&&(at(ue[e],[s,null]),Ke(n,s))})),l||Ve(t[5],((t,l)=>{if(!Se(n,l)){const n=Ge();Ve(t,(e=>Ve(e,(([t,l],s)=>l!==t?Ke(n,s):Ee(e,s))))),Ve(n,(t=>at(ue[e],[l,t])))}})),Ve(t[4],((t,n)=>Ve(t,((t,l)=>ln(t,we[e],Me[e],[n,l])))))}if(!r){let n;Ve(t[5],((t,l)=>{let s;Ve(t,((t,r)=>{let o;Ve(t,(([t,a],i)=>{a!==t&&(at(Ae[e],[l,r,i],a,t,$t),n=s=o=1)})),o&&at(Ie[e],[l,r],$t)})),s&&at(re[e],[l],$t)})),n&&at(ne[e],void 0,$t)}}},rn=e=>{const t=Sn();t!=l&&at(Ye[e],void 0,t);const n=ye($e[e])&&ye(nt[e]),s=ye(lt[e])&&ye(Ze[e]);if(!n||!s){const t=e?[ze(k),ze(D)]:[k,D];if(n||ln(t[0],$e[e],nt[e]),!s){let n;Ve(t[1],(([t,l],s)=>{l!==t&&(at(lt[e],[s],l,t,en),n=1)})),n&&at(Ze[e],void 0,en)}}},on=(e,...t)=>(Qn((()=>e(...Y(t,M)))),zn),an=()=>Pe(Z),dn=()=>De(Z),cn=e=>De(xe(G,M(e))),un=e=>Le(xe(Z,M(e))),gn=e=>De(xe(Z,M(e))),vn=(e,t,n,l=0,s)=>{return Y(W(K((r=xe(Z,M(e)),o=(e,n)=>[F(t)?n:xe(e,M(t)),n],Y([...null!=(a=null==r?void 0:r.entries())?a:[]],(([e,t])=>o(t,e)))),(([e],[t])=>it(e,t)*(n?-1:1))),l,F(s)?s:l+s),(([,e])=>e));var r,o,a},hn=(e,t)=>De(xe(xe(Z,M(e)),M(t))),fn=(e,t,n)=>xe(xe(xe(Z,M(e)),M(t)),M(n)),bn=()=>Qe($),In=()=>De($),pn=e=>xe($,M(e)),wn=()=>!ye(Z),Ln=e=>Se(Z,M(e)),Cn=(e,t)=>Se(xe(G,M(e)),M(t)),Rn=(e,t)=>Se(xe(Z,M(e)),M(t)),Tn=(e,t,n)=>Se(xe(xe(Z,M(e)),M(t)),M(n)),Sn=()=>!ye($),yn=e=>Se($,M(e)),Mn=e=>on((()=>(e=>pe(e,vt,Yt))(e)?Tt(e):0)),mn=e=>on((()=>bt(e)?Et(e):0)),Vn=e=>{try{Rt(Nt(e))}catch(e){}return zn},En=t=>on((()=>{if((e=pe(t,(e=>pe(e,ut))))&&(Lt(t),!ye(Z))){const e=an();Dn(),Mn(e)}})),kn=e=>on((()=>{if(t=(e=>pe(e,ut))(e)){const n=bn();Fn(),Jn(),t=!0,Ct(e),mn(n)}})),Dn=()=>on((()=>Tt({}))),xn=e=>on((e=>Se(Z,e)?xt(e):0),e),Hn=(e,t)=>on(((e,t)=>Q(xe(Z,e),(n=>Se(n,t)?Ht(e,n,t):0))),e,t),Jn=()=>on((()=>Et({}))),On=()=>on((()=>{Lt({}),e=!1})),Fn=()=>on((()=>{Ct({}),t=!1})),Qn=(e,t)=>{if(-1!=s){jn();const n=e();return Pn(t),n}},jn=()=>{var e;return-1!=s&&s++,1==s&&(null==(e=o[0])||e.call(o),at(st)),zn},Pn=e=>{var t,r;return s>0&&(s--,0==s&&(s=1,tn(1),ye(E)||sn(1),nn(1),ye(D)||rn(1),(null==e?void 0:e(zn))&&(Ve(E,((e,t)=>Ve(e,((e,n)=>Ve(e,(([e],l)=>Ue(zn,t,n,l,e))))))),me(E),Ve(D,(([e],t)=>qe(zn,t,e))),me(D)),at(rt[0],void 0),s=-1,tn(0),ye(E)||sn(0),nn(0),ye(D)||rn(0),null==(t=o[1])||t.call(o),at(rt[1],void 0),null==(r=o[2])||r.call(o),s=0,n=wn(),l=Sn(),X([c,v,L,m,V,E,x,k,D,H],me))),zn},zn={getContent:()=>[an(),bn()],getTables:an,getTableIds:dn,getTable:e=>je(xe(Z,M(e))),getTableCellIds:cn,getRowCount:un,getRowIds:gn,getSortedRowIds:vn,getRow:(e,t)=>Qe(xe(xe(Z,M(e)),M(t))),getCellIds:hn,getCell:fn,getValues:bn,getValueIds:In,getValue:pn,hasTables:wn,hasTable:Ln,hasTableCell:Cn,hasRow:Rn,hasCell:Tn,hasValues:Sn,hasValue:yn,getTablesJson:()=>Wt(Z),getValuesJson:()=>Wt($),getJson:()=>Wt([Z,$]),getTablesSchemaJson:()=>Wt(J),getValuesSchemaJson:()=>Wt(P),getSchemaJson:()=>Wt([J,P]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>on((()=>{const t=z(e)?e():e;gt(t)&&(([e,t])=>{(be(e)?Dn:Mn)(e),(be(t)?Jn:mn)(t)})(t)})),setTables:Mn,setTable:(e,t)=>on((e=>vt(t,e)?St(e,t):0),e),setRow:(e,t,n)=>on(((e,t)=>ht(e,t,n)?yt(e,Dt(e),t,n):0),e,t),addRow:(e,t,n=!0)=>Qn((()=>{let l;return ht(e,l,t)&&(e=M(e),yt(e,Dt(e),l=((e,t)=>{const[n]=xe(U,e);let l;do{l=n(t)}while(Se(xe(Z,e),l));return l})(e,n?1:0),t)),l})),setPartialRow:(e,t,n)=>on(((e,t)=>{if(ht(e,t,n,1)){const l=Dt(e);fe(n,((n,s)=>mt(e,l,t,s,n)))}}),e,t),setCell:(e,t,n,l)=>on(((e,t,n)=>Q(ft(e,t,n,z(l)?l(fn(e,t,n)):l),(l=>mt(e,Dt(e),t,n,l)))),e,t,n),setValues:mn,setPartialValues:e=>on((()=>bt(e,1)?fe(e,((e,t)=>kt(t,e))):0)),setValue:(e,t)=>on((e=>Q(It(e,z(t)?t(pn(e)):t),(t=>kt(e,t)))),e),applyChanges:e=>on((()=>{fe(e[0],((e,t)=>F(e)?xn(t):fe(e,((e,n)=>F(e)?Hn(t,n):fe(e,((e,l)=>Ue(zn,t,n,l,e))))))),fe(e[1],((e,t)=>qe(zn,t,e)))})),setTablesJson:Vn,setValuesJson:e=>{try{Vt(Nt(e))}catch(e){}return zn},setJson:e=>on((()=>{try{const[t,n]=Nt(e);Rt(t),Vt(n)}catch(t){Vn(e)}})),setTablesSchema:En,setValuesSchema:kn,setSchema:(e,t)=>on((()=>{En(e),kn(t)})),delTables:Dn,delTable:xn,delRow:Hn,delCell:(e,t,n,l)=>on(((e,t,n)=>Q(xe(Z,e),(s=>Q(xe(s,t),(r=>Se(r,n)?Jt(e,s,t,r,n,l):0))))),e,t,n),delValues:Jn,delValue:e=>on((e=>Se($,e)?zt(e):0),e),delTablesSchema:On,delValuesSchema:Fn,delSchema:()=>on((()=>{On(),Fn()})),transaction:Qn,startTransaction:jn,getTransactionChanges:()=>[Qe(E,((e,t)=>-1===xe(c,t)?void 0:Qe(e,((e,n)=>-1===xe(xe(m,t),n)?void 0:Qe(e,(([,e])=>e),(e=>Pt(e)))),ye,be)),ye,be),Qe(D,(([,e])=>e),(e=>Pt(e))),1],getTransactionLog:()=>[!ye(E),!ye(D),Pe(E,jt,Pt),Pe(x),Qe(D,jt,Pt),Qe(H),Qe(c),je(m),Pe(V),Qe(k)],finishTransaction:Pn,forEachTable:e=>Ve(Z,((t,n)=>e(n,(e=>Ve(t,((t,n)=>e(n,(e=>He(t,e))))))))),forEachTableCell:(e,t)=>He(xe(G,M(e)),t),forEachRow:(e,t)=>Ve(xe(Z,M(e)),((e,n)=>t(n,(t=>He(e,t))))),forEachCell:(e,t,n)=>He(xe(xe(Z,M(e)),M(t)),n),forEachValue:e=>He($,e),addSortedRowIdsListener:(e,t,n,l,s,r,o)=>{let a=vn(e,t,n,l,s);return ot((()=>{const o=vn(e,t,n,l,s);q(o,a)||(a=o,r(zn,e,t,n,l,s,a))}),ue[o?1:0],[e,t],[dn])},addStartTransactionListener:e=>ot(e,st),addWillFinishTransactionListener:e=>ot(e,rt[0]),addDidFinishTransactionListener:e=>ot(e,rt[1]),callListener:e=>(ct(e),zn),delListener:e=>(dt(e),zn),getListenerStats:()=>({hasTables:Ft(ee),tables:Ft(ne),tableIds:Ft(le),hasTable:Ft(se),table:Ft(re),tableCellIds:Ft(oe),hasTableCell:Ft(ae,Re),rowCount:Ft(ie),rowIds:Ft(de),sortedRowIds:Ft(ue),hasRow:Ft(he,Re),row:Ft(Ie,Re),cellIds:Ft(we,Re),hasCell:Ft(Me,Te),cell:Ft(Ae,Te),invalidCell:Ft(Be,Te),hasValues:Ft(Ye),values:Ft(Ze),valueIds:Ft($e),hasValue:Ft(nt),value:Ft(lt),invalidValue:Ft(Xe),transaction:Ce(st)+Ft(rt)}),isMergeable:()=>!1,createStore:_t,addListener:ot,callListeners:at,setInternalListeners:(e,t,n,l,s)=>o=[e,t,n,l,s]};return fe({[g+f]:[0,ee,[],()=>[wn()]],[f]:[0,ne],[b]:[0,le],[g+h]:[1,se,[dn],e=>[Ln(...e)]],[h]:[1,re,[dn]],[h+R]:[1,oe,[dn]],[g+h+C]:[2,ae,[dn,cn],e=>[Cn(...e)]],[p]:[1,ie,[dn]],[w]:[1,de,[dn]],[g+I]:[2,he,[dn,gn],e=>[Rn(...e)]],[I]:[2,Ie,[dn,gn]],[R]:[2,we,[dn,gn]],[g+C]:[3,Me,[dn,gn,hn],e=>[Tn(...e)]],[C]:[3,Ae,[dn,gn,hn],e=>Ot(fn(...e))],InvalidCell:[3,Be],[g+S]:[0,Ye,[],()=>[Sn()]],[S]:[0,Ze],[y]:[0,$e],[g+T]:[1,nt,[In],e=>[yn(...e)]],[T]:[1,lt,[In],e=>Ot(pn(e[0]))],InvalidValue:[1,Xe]},(([e,t,n,l],s)=>{zn[u+s+d]=(...s)=>ot(s[e],t[s[e+1]?1:0],e>0?W(s,0,e):void 0,n,l)})),ce(zn)};var Bt=Math.pow;const Ut=Bt(2,36),qt=Bt(2,30),Gt=Bt(2,24),Kt=Bt(2,18),Xt=Bt(2,12),Yt=Bt(2,6),Zt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},$t=(e=n)=>[Dt(e),Dt(e)];e.createCheckpoints=nt,e.createIndexes=ct,e.createMergeableStore=e=>{let t=1,l=$t(),s=0;const r=ke(),o=Ge(),[a,i]=(e=>{let t=0,n=-1;const l=Q(e,(e=>{const t=Lt(e);return rt(t/Gt)+rt(t/Kt)+rt(t/Xt)+rt(t/Yt)+rt(t)}),(()=>dt(5))),s=e=>{var l;const s=t,[r,o]=F(e)||""==e?[0,0]:[ot(a=e,0)*Ut+ot(a,1)*qt+ot(a,2)*Gt+ot(a,3)*Kt+ot(a,4)*Xt+ot(a,5)*Yt+ot(a,6),ot(a,7)*Kt+ot(a,8)*Xt+ot(a,9)*Yt+ot(a,10)];var a;t=x(s,r,null!=(l=k.HLC_TIME)?l:Date.now()),n=t==s?t==r?x(n,o):n:t==r?o:-1};return[()=>{return s(),r=++n,rt((e=t)/Ut)+rt(e/qt)+rt(e/Gt)+rt(e/Kt)+rt(e/Xt)+rt(e/Yt)+rt(e)+rt(r/Kt)+rt(r/Xt)+rt(r/Yt)+rt(r)+l;var e,r},s]})(e),c=_t(),g=e=>{const n=t;return t=0,e(),t=n,I},v=(e,t=0)=>{const s={},r={},[[o,a=n,d=0],c]=e,[u,g]=l,[v,f,b]=u;let I=t?d:b,p=a;he(o,(([e,l=n,r=0],o)=>{const a=Oe(v,o,Dt),[i,d,c]=a;let u=t?r:c,g=l;he(e,((e,n)=>{const[l,r,a]=h(e,Oe(i,n,Dt),Ie(Ie(s,o,ue),n,ue),t);u^=t?0:(r?Mt(n,r):0)^Mt(n,a),g=Vt(g,l)})),u^=t?0:mt(d,l),Et(a,l,u),I^=t?0:(c?Mt(o,c):0)^Mt(o,a[2]),p=Vt(p,g)})),I^=t?0:mt(f,a),Et(u,a,I);const[w]=h(c,g,r,t);return i(Vt(p,w)),[s,r,1]},h=(e,t,l,s)=>{const[r,o=n,a=0]=e,[i,d,c]=t;let u=o,g=s?a:c;return he(r,(([e,t,r=0],o)=>{const a=Oe(i,o,(()=>[void 0,n,0])),[,d,c]=a;(!d||t>d)&&(Et(a,t,s?r:Lt(Wt(null!=e?e:null)+":"+t)),a[0]=e,l[o]=e,g^=s?0:Mt(o,c)^Mt(o,a[2]),u=Vt(u,t))})),g^=s?0:mt(d,o),Et(t,o,g),[u,c,t[2]]},f=()=>[xt(l[0],(e=>xt(e,(e=>xt(e))))),xt(l[1])],b=e=>g((()=>c.applyChanges(v(e)))),I={getMergeableContent:f,getMergeableContentHashes:()=>[l[0][2],l[1][2]],getMergeableTableHashes:()=>Qe(l[0][0],yt),getMergeableTableDiff:e=>{const t=kt(l[0][1]),n={};return He(l[0][0],((l,[s,r,o])=>ge(e,l)?o!=e[l]?n[l]=o:0:t[0][l]=Ht([s,r],(e=>Ht(e))))),[t,n]},getMergeableRowHashes:e=>{const t={};return he(e,((e,n)=>Q(xe(l[0][0],n),(([l,,s])=>s!=e?He(l,((e,[,,l])=>Ie(t,n,ue)[e]=l)):0)))),t},getMergeableRowDiff:e=>{const t=kt(l[0][1]),n={};return he(e,((e,s)=>{var r;return He(null==(r=xe(l[0][0],s))?void 0:r[0],((l,[r,o,a])=>ge(e,l)?a!==e[l]?Ie(n,s,ue)[l]=a:0:Ie(t[0],s,kt)[0][l]=Ht([r,o])))})),[t,n]},getMergeableCellHashes:e=>{const t={};return he(e,((e,n)=>Q(xe(l[0][0],n),(([l])=>he(e,((e,s)=>Q(xe(l,s),(([l,,r])=>r!==e?He(l,((e,[,,l])=>Ie(Ie(t,n,ue),s,ue)[e]=l)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,n]]=l,s={};return he(e,((e,n)=>he(e,((e,l)=>Q(xe(t,n),(([t,r])=>Q(xe(t,l),(([t,o])=>He(t,((t,[a,i,d])=>d!==e[t]?Ie(Ie(s,n,(()=>kt(r)))[0],l,(()=>kt(o)))[0][t]=[a,i]:0)))))))))),Tt(s,n)},getMergeableValueHashes:()=>Qe(l[1][0],yt),getMergeableValueDiff:e=>{const[,[t,n]]=l,s=Qe(t,Ct,(([,,t],n)=>t==(null==e?void 0:e[n])));return Tt(s,n)},setMergeableContent:e=>g((()=>(e=>N(e)&&2==A(e)&&Jt(e[0],(e=>pe(e,(e=>Jt(e,(e=>pe(e,(e=>Jt(e,(e=>pe(e,(e=>Jt(e,Be)),void 0,1)))),void 0,1)))),void 0,1)))&&Jt(e[1],(e=>pe(e,(e=>Jt(e,Be)),void 0,1))))(e)?c.transaction((()=>{c.delTables().delValues(),l=$t(),c.applyChanges(v(e,1))})):0)),setDefaultContent:e=>(c.transaction((()=>{s=1,c.setContent(e),s=0})),I),getTransactionMergeableChanges:(e=!1)=>{const[[t,n,s],[a,i,d]]=l,c=e?St:Tt,u={};Ve(r,((e,n)=>Q(xe(t,n),(([t,l,s])=>{const r={};Ve(e,((e,n)=>Q(xe(t,n),(([t,l,s])=>{const o={};Ve(e,(e=>{Q(xe(t,e),(([t,n,l])=>o[e]=c(t,n,l)))})),r[n]=c(o,l,s)})))),u[n]=c(r,l,s)}))));const g={};return Ve(o,(e=>Q(xe(a,e),(([t,n,l])=>g[e]=c(t,n,l))))),[c(u,n,s),c(g,i,d),1]},applyMergeableChanges:b,merge:e=>{const t=f(),n=e.getMergeableContent();return e.applyMergeableChanges(t),b(n)}};return c.setInternalListeners((()=>{}),(()=>{}),(()=>{me(r),me(o)}),((e,l,o,i)=>{Ke(Oe(Oe(r,e,ke),l,Ge),o),t&&v([[{[e]:[{[l]:[{[o]:[i,s?n:a()]}]}]}],[{}],1])}),((e,l)=>{Ke(o,e),t&&v([[{}],[{[e]:[l,s?n:a()]}],1])})),fe(c,((e,t)=>I[t]=m(t,"set")||m(t,"del")||m(t,"apply")||V(t,"Transaction")||t=="call"+d?(...t)=>(e(...t),I):m(t,u)&&V(t,d)?(...n)=>{var l;const s=null!=(l=Zt[W(t,3,-8)])?l:0,r=n[s];return n[s]=(e,...t)=>r(I,...t),e(...n)}:"isMergeable"==t?()=>!0:e)),ce(I)},e.createMetrics=vt,e.createQueries=It,e.createRelationships=pt,e.createStore=_t,e.defaultSorter=it,e.getUniqueId=dt},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={});
