var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),o=t(!0),r=t(0),a=t(t),l="type",i="default",c="Listener",d="Result",u="add",g="Has",h="Ids",f="Table",b=f+"s",I=f+h,w="Row",L=w+"Count",C=w+h,R="Sorted"+w+h,T="Cell",p=T+h,v="Value",S=v+"s",y=v+h,M=e=>s+e,V=(e,t)=>e.startsWith(t),m=(e,t)=>e.endsWith(t),E=(e,t=s,n)=>e.split(t,n),k=globalThis,D=Math,x=D.max,H=D.min,J=D.floor,F=isFinite,Q=e=>null==e,z=(e,t,s)=>Q(e)?s?.():t(e),N=e=>e==n||e==o,O=e=>t(e)==n,W=e=>t(e)==a,j=e=>Array.isArray(e),A=(e,t,s)=>e.slice(t,s),P=e=>e.length,_=()=>{},B=(e,t)=>e.includes(t),U=(e,t)=>e.every(t),q=(e,t)=>P(e)===P(t)&&U(e,((e,s)=>t[s]===e)),G=(e,t)=>U(e,((s,n)=>0==n||t(e[n-1],s)<=0)),K=(e,t)=>e.sort(t),X=(e,t)=>e.forEach(t),Y=(e,t)=>e.map(t),Z=e=>ee(e,((e,t)=>e+t),0),$=e=>0==P(e),ee=(e,t,s)=>e.reduce(t,s),te=(e,...t)=>e.push(...t),se=e=>e.pop(),ne=e=>e.shift(),oe=Object,re=e=>oe.getPrototypeOf(e),ae=oe.entries,le=oe.isFrozen,ie=e=>!Q(e)&&z(re(e),(e=>e==oe.prototype||Q(re(e))),(()=>!0)),ce=oe.keys,de=oe.freeze,ue=(e=[])=>oe.fromEntries(e),ge=(e,t)=>t in e,he=(e,t)=>(delete e[t],e),fe=(e,t)=>X(ae(e),(([e,s])=>t(s,e))),be=(e,t)=>ue(((e,t)=>Y(ae(e),(([e,s])=>t(s,e))))(e,((e,s)=>[s,t(e,s)]))),Ie=e=>ie(e)&&0==(e=>P(ce(e)))(e),we=(e,t,s)=>(ge(e,t)||(e[t]=s()),e[t]),Le=(e,t,s,n=0)=>Q(e)||!ie(e)||!n&&Ie(e)||le(e)?(s?.(),!1):(fe(e,((s,n)=>{t(s,n)||he(e,n)})),!!n||!Ie(e)),Ce=e=>t=>ee(Me(t),((t,s)=>t+e(s)),0),Re=e=>e?.size??0,Te=Ce(Re),pe=Ce(Te),ve=Ce(pe),Se=(e,t)=>e?.has(t)??!1,ye=e=>Q(e)||0==Re(e),Me=e=>[...e?.values()??[]],Ve=e=>e.clear(),me=(e,t)=>e?.forEach(t),Ee=(e,t)=>e?.delete(t),ke=e=>new Map(e),De=e=>[...e?.keys()??[]],xe=(e,t)=>e?.get(t),He=(e,t)=>me(e,((e,s)=>t(s,e))),Je=(e,t,s)=>Q(s)?(Ee(e,t),e):e?.set(t,s),Fe=(e,t,s,n)=>(Se(e,t)?n?.(xe(e,t)):Je(e,t,s()),xe(e,t)),Qe=(e,t,s,n=Je)=>(be(t,((t,n)=>s(e,n,t))),He(e,(s=>ge(t,s)?0:n(e,s))),e),ze=(e,t,s,n)=>{const o={};return me(e,((e,r)=>{if(!s?.(e,r)){const s=t?t(e,r):e;n?.(s)||(o[r]=s)}})),o},Ne=(e,t,s)=>ze(e,(e=>ze(e,t,s)),ye,Ie),Oe=(e,t,s)=>ze(e,(e=>Ne(e,t,s)),ye,Ie),We=(e,t)=>{const s=ke();return me(e,((e,n)=>s.set(n,t?.(e)??e))),s},je=e=>We(e,We),Ae=e=>We(e,je),Pe=(e,t,s,n,o=0)=>z((s?Fe:xe)(e,t[o],o>P(t)-2?s:ke),(r=>{if(o>P(t)-2)return n?.(r)&&Je(e,t[o]),r;const a=Pe(r,t,s,n,o+1);return ye(r)&&Je(e,t[o]),a})),_e=e=>{const s=t(e);return N(s)||s==r&&F(e)?s:void 0},Be=e=>Q(e)||!Q(_e(e)),Ue=(e,t,s,n,o)=>Q(o)?e.delCell(t,s,n,!0):e.setCell(t,s,n,o),qe=(e,t,s)=>Q(s)?e.delValue(t):e.setValue(t,s),Ge=e=>new Set(j(e)||Q(e)?e:[e]),Ke=(e,t)=>e?.add(t),Xe=(e,t,s,n,o)=>{const r=e.hasRow,a=ke(),l=ke(),i=ke(),c=ke(),d=ke(),u=ke(),g=(t,s,...n)=>{const o=Fe(u,t,Ge);return X(n,(t=>Ke(o,t)&&s&&e.callListener(t))),n},h=(t,...s)=>z(xe(u,t),(n=>{X($(s)?Me(n):s,(t=>{e.delListener(t),Ee(n,t)})),ye(n)&&Je(u,t)})),f=(e,s)=>{Je(a,e,s),Se(l,e)||(Je(l,e,t()),Je(c,e,ke()),Je(d,e,ke()),o(i))},b=e=>{Je(a,e),Je(l,e),Je(c,e),Je(d,e),h(e),o(i)};return[()=>e,()=>De(a),e=>He(l,e),e=>Se(l,e),e=>xe(a,e),e=>xe(l,e),(e,t)=>Je(l,e,t),f,(t,n,o,a,l)=>{f(t,n);const i=ke(),u=ke(),b=xe(c,t),I=xe(d,t),w=t=>{const o=s=>e.getCell(n,t,s),c=xe(b,t),d=r(n,t)?s(a(o,t)):void 0;if(c===d||j(c)&&j(d)&&q(c,d)||Je(i,t,[c,d]),!Q(l)){const e=xe(I,t),s=r(n,t)?l(o,t):void 0;e!=s&&Je(u,t,s)}},L=e=>{o((()=>{me(i,(([,e],t)=>Je(b,t,e))),me(u,((e,t)=>Je(I,t,e)))}),i,u,b,I,e),Ve(i),Ve(u)};He(b,w),e.hasTable(n)&&X(e.getRowIds(n),(e=>{Se(b,e)||w(e)})),L(!0),h(t),g(t,0,e.addRowListener(n,null,((e,t,s)=>w(s))),e.addTableListener(n,(()=>L())))},b,e=>n(e,i),()=>He(u,b),g,h]},Ye=(e,t)=>O(e)?t=>t(e):e??(()=>t??s),Ze=(e,t)=>{const s=new WeakMap;return n=>{s.has(n)||s.set(n,e(n));const o=s.get(n);return t?.(o),o}},$e=/^\d+$/,et=()=>{const e=[];let t=0;return[n=>(n?ne(e):null)??s+t++,t=>{$e.test(t)&&P(e)<1e3&&te(e,t)}]},tt=e=>{let t;const[n,o]=et(),r=ke();return[(o,a,l,i=[],c=()=>[])=>{t??=e();const d=n(1);return Je(r,d,[o,a,l,i,c]),Ke(Pe(a,l??[s],Ge),d),d},(e,n,...o)=>X(((e,t=[s])=>{const n=[],o=(e,s)=>s==P(t)?te(n,e):null===t[s]?me(e,(e=>o(e,s+1))):X([t[s],null],(t=>o(xe(e,t),s+1)));return o(e,0),n})(e,n),(e=>me(e,(e=>xe(r,e)[0](t,...n??[],...o))))),e=>z(xe(r,e),(([,t,n])=>(Pe(t,n??[s],void 0,(t=>(Ee(t,e),ye(t)?1:0))),Je(r,e),o(e),n))),e=>z(xe(r,e),(([e,,s=[],n,o])=>{const r=(...a)=>{const l=P(a);l==P(s)?e(t,...a,...o(a)):Q(s[l])?X(n[l]?.(...a)??[],(e=>r(...a,e))):r(...a,s[l])};r()}))]},st=Ze((e=>{let t,n,o,r=100,a=ke(),l=ke(),i=1;const c=ke(),d=ke(),[u,g,h]=tt((()=>H)),f=ke(),b=ke(),I=[],w=[],L=(t,s)=>{i=0,e.transaction((()=>{const[n,o]=xe(f,s);me(n,((s,n)=>me(s,((s,o)=>me(s,((s,r)=>Ue(e,n,o,r,s[t]))))))),me(o,((s,n)=>qe(e,n,s[t])))})),i=1},C=e=>{Je(f,e),Je(b,e),g(d,[e])},R=(e,t)=>X(((e,t)=>e.splice(0,t))(e,t??P(e)),C),T=()=>R(I,P(I)-r),p=()=>z(t,(()=>{te(I,t),T(),R(w),t=void 0,o=1})),v=()=>{t=se(I),o=1};let S,y;const M=(e=s)=>(Q(t)&&(t=s+n++,Je(f,t,[a,l]),D(t,e),a=ke(),l=ke(),o=1),t),V=()=>{$(I)||(((e,...t)=>{e.unshift(...t)})(w,M()),L(0,t),t=se(I),o=1)},m=()=>{$(w)||(te(I,t),t=ne(w),L(1,t),o=1)},E=()=>{o&&(g(c),o=0)},k=e=>{const t=M(e);return E(),t},D=(e,t)=>(x(e)&&xe(b,e)!==t&&(Je(b,e,t),g(d,[e])),H),x=e=>Se(f,e),H={setSize:e=>(r=e,T(),H),addCheckpoint:k,setCheckpoint:D,getStore:()=>e,getCheckpointIds:()=>[[...I],t,[...w]],forEachCheckpoint:e=>He(b,e),hasCheckpoint:x,getCheckpoint:e=>xe(b,e),goBackward:()=>(V(),E(),H),goForward:()=>(m(),E(),H),goTo:e=>{const s=B(I,e)?V:B(w,e)?m:null;for(;!Q(s)&&e!=t;)s();return E(),H},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(h(e),H),clear:()=>(R(I),R(w),Q(t)||C(t),t=void 0,n=0,k(),H),clearForward:()=>($(w)||(R(w),g(c)),H),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Te(c),checkpoint:Te(d)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,s,n,o,r)=>{if(i){p();const e=Fe(a,t,ke),l=Fe(e,s,ke),i=Fe(l,n,(()=>[r,void 0]));i[1]=o,i[0]===o&&ye(Je(l,n))&&ye(Je(e,s))&&ye(Je(a,t))&&v(),E()}})),y=e.addValueListener(null,((e,t,s,n)=>{if(i){p();const e=Fe(l,t,(()=>[n,void 0]));e[1]=s,e[0]===s&&ye(Je(l,t))&&v(),E()}}))}};return de(H.clear())}),(e=>e._registerListeners())),nt=E("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),ot=ke(Y(nt,((e,t)=>[e,t]))),rt=e=>nt[63&e],at=(e,t)=>xe(ot,e[t])??0,lt=k.crypto?e=>k.crypto.getRandomValues(e):e=>Y(e,(()=>J(256*D.random()))),it=(e,t)=>(e??0)<(t??0)?-1:1,ct=(e=16)=>ee(lt(new Uint8Array(e)),((e,t)=>e+rt(t)),""),dt=Ze((e=>{const t=ke(),n=ke(),[o,r,a]=tt((()=>C)),[l,i,c,d,u,g,h,,f,b,I,w]=Xe(e,ke,(e=>Q(e)?s:j(e)?Y(e,M):M(e)),o,r),L=(t,s,n)=>{const o=u(t);me(n,((t,n)=>s(n,(s=>me(t,(t=>s(t,(s=>e.forEachCell(o,t,s)))))))))},C={setIndexDefinition:(e,s,o,a,l,i=it)=>{const c=Q(l)?void 0:([e],[t])=>l(e,t);return f(e,s,((s,o,l,d,u,f)=>{let b=0;const I=Ge(),w=Ge(),L=g(e);if(me(o,(([e,t],s)=>{const n=Ge(e),o=Ge(t);me(n,(e=>Ee(o,e)?Ee(n,e):0)),me(n,(e=>{Ke(I,e),z(xe(L,e),(t=>{Ee(t,s),ye(t)&&(Je(L,e),b=1)}))})),me(o,(e=>{Ke(I,e),Se(L,e)||(Je(L,e,Ge()),b=1),Ke(xe(L,e),s),Q(a)||Ke(w,e)}))})),s(),ye(u)||(f?He(L,(e=>Ke(w,e))):He(l,(e=>z(xe(d,e),(e=>Ke(w,e))))),me(w,(e=>{const t=(t,s)=>i(xe(u,t),xe(u,s),e),s=[...xe(L,e)];G(s,t)||(Je(L,e,Ge(K(s,t))),Ke(I,e))}))),(b||f)&&!Q(c)){const t=[...L];G(t,c)||(h(e,ke(K(t,c))),b=1)}b&&r(t,[e]),me(I,(t=>r(n,[e,t])))}),Ye(o),z(a,Ye)),C},delIndexDefinition:e=>(b(e),C),getStore:l,getIndexIds:i,forEachIndex:e=>c(((t,s)=>e(t,(e=>L(t,e,s))))),forEachSlice:(e,t)=>L(e,t,g(e)),hasIndex:d,hasSlice:(e,t)=>Se(g(e),t),getTableId:u,getSliceIds:e=>De(g(e)),getSliceRowIds:(e,t)=>Me(xe(g(e),t)),addIndexIdsListener:I,addSliceIdsListener:(e,s)=>o(s,t,[e]),addSliceRowIdsListener:(e,t,s)=>o(s,n,[e,t]),delListener:e=>(a(e),C),destroy:w,getListenerStats:()=>({sliceIds:Te(t),sliceRowIds:pe(n)})};return de(C)})),ut=ke([["avg",[(e,t)=>Z(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>x(...e),(e,t)=>x(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:x(t,e)]],["min",[e=>H(...e),(e,t)=>H(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:H(t,e)]],["sum",[e=>Z(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),gt=(e,t,s,n,o,r=!1)=>{if(ye(s))return;const[a,l,i,c]=o;return r||=Q(e),me(n,(([s,n])=>{r||(e=Q(s)?l?.(e,n,t++):Q(n)?i?.(e,s,t--):c?.(e,n,s,t),r||=Q(e))})),r?a(Me(s),Re(s)):e},ht=Ze((e=>{const t=ke(),[n,o,r]=tt((()=>w)),[a,l,i,c,d,u,g,,h,f,b,I]=Xe(e,_,(e=>isNaN(e)||Q(e)||!0===e||!1===e||e===s?void 0:1*e),n,o),w={setMetricDefinition:(e,s,n,r,a,l,i)=>{const c=W(n)?[n,a,l,i]:xe(ut,n)??xe(ut,"sum");return h(e,s,((s,n,r,a,l,i)=>{const d=u(e),h=Re(a);i||=Q(d),s();let f=gt(d,h,a,n,c,i);F(f)||(f=void 0),f!=d&&(g(e,f),o(t,[e],f,d))}),Ye(r,1)),w},delMetricDefinition:e=>(f(e),w),getStore:a,getMetricIds:l,forEachMetric:i,hasMetric:c,getTableId:d,getMetric:u,addMetricIdsListener:b,addMetricListener:(e,s)=>n(s,t,[e]),delListener:e=>(r(e),w),destroy:I,getListenerStats:()=>({metric:Te(t)})};return de(w)})),ft=Ze((e=>{const t=e.createStore,n=t(),o=t(),r=ke(),{addListener:a,callListeners:l,delListener:i}=o,[g,h,b,I,v,,,S,,y,M,V,m,E]=Xe(e,(()=>!0),_,a,l),k=(e,t,...s)=>X(s,(s=>Ke(Fe(Fe(r,t,ke),e,Ge),s))),D=e=>{z(xe(r,e),(e=>{He(e,((e,t)=>me(t,(t=>e.delListener(t))))),Ve(e)})),X([o,n],(t=>t.delTable(e)))},x=(e,t,s)=>k(t,e,t.addStartTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),H={setQueryDefinition:(t,r,a)=>{S(t,r),D(t);const l=[],i=[[null,[r,null,null,[],ke()]]],c=[],d=[],u=[];a({select:(e,t)=>{const n=W(e)?[P(l)+s,e]:[Q(t)?e:t,s=>s(e,t)];return te(l,n),{as:e=>n[0]=e}},join:(e,t,s)=>{const n=Q(s)||W(t)?null:t,o=Q(n)?t:s,r=[e,[e,n,W(o)?o:e=>e(o),[],ke()]];return te(i,r),{as:e=>r[0]=e}},where:(e,t,s)=>te(c,W(e)?e:Q(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,o)=>{const r=[e,[e,W(t)?[t,s,n,o]:xe(ut,t)??[(e,t)=>t]]];return te(d,r),{as:e=>r[0]=e}},having:(e,t)=>te(u,W(e)?e:s=>s(e)===t)});const g=ke(l);if(ye(g))return H;const h=ke(i);He(h,((e,[,t])=>z(xe(h,t),(({3:t})=>Q(e)?0:te(t,e)))));const f=ke(d);let b=n;if(ye(f)&&$(u))b=o;else{x(t,b,o);const e=ke();He(f,((t,[s,n])=>Ke(Fe(e,s,Ge),[t,n])));const s=Ge();He(g,(t=>Se(e,t)?0:Ke(s,t)));const n=ke(),r=(s,n,r,a)=>z(s,(([l,i,c,d])=>{He(n,((t,[s])=>{const n=Fe(l,t,ke),o=xe(n,r),i=a?void 0:s;if(o!==i){const s=Ge([[o,i]]),a=Re(n);Je(n,r,i),me(xe(e,t),(([e,t])=>{const o=gt(d[e],a,n,s,t);d[e]=Q(_e(o))?null:o}))}})),ye(i)||!U(u,(e=>e((e=>d[e]))))?o.delRow(t,c):Q(c)?s[2]=o.addRow(t,d):o.setRow(t,c,d)}));k(b,t,b.addRowListener(t,null,((o,a,l,i)=>{const c=[],d=[],u=ke(),g=b.hasRow(t,l);let h=!g;me(s,(e=>{const[s,n,o]=i(t,l,e);te(c,n),te(d,o),h||=s})),He(e,(e=>{const[s,,n]=i(t,l,e);(h||s)&&Je(u,e,[n])})),h&&r(Pe(n,c,void 0,(([,e])=>(Ee(e,l),ye(e)))),u,l,1),g&&r(Pe(n,d,(()=>{const e={};return me(s,(s=>e[s]=b.getCell(t,l,s))),[ke(),Ge(),void 0,e]}),(([,e])=>{Ke(e,l)})),u,l)})))}x(t,e,b);const I=(s,n,o,a)=>{const l=t=>e.getCell(n,o,t);X(a,(n=>{const[o,,r,a,i]=xe(h,n),c=r?.(l,s),[d,u]=xe(i,s)??[];c!=d&&(Q(u)||E(t,u),Je(i,s,Q(c)?null:[c,...m(t,1,e.addRowListener(o,c,(()=>I(s,o,c,a))))]))})),(s=>{const n=(t,n)=>e.getCell(...Q(n)?[r,s,t]:t===r?[r,s,n]:[xe(h,t)?.[0],xe(xe(h,t)?.[4],s)?.[0],n]);b.transaction((()=>U(c,(e=>e(n)))?He(g,((e,o)=>Ue(b,t,s,e,o(n,s)))):b.delRow(t,s)))})(s)},{3:w}=xe(h,null);return b.transaction((()=>m(t,1,e.addRowListener(r,null,((s,n,o)=>{e.hasRow(r,o)?I(o,r,o,w):(b.delRow(t,o),me(h,(({4:e})=>z(xe(e,o),(([,s])=>{E(t,s),Je(e,o)})))))}))))),H},delQueryDefinition:e=>(D(e),y(e),H),getStore:g,getQueryIds:h,forEachQuery:b,hasQuery:I,getTableId:v,addQueryIdsListener:e=>M((()=>e(H))),delListener:e=>(i(e),H),destroy:V,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=o.getListenerStats();return n}};return be({[f]:[1,1],[f+p]:[0,1],[L]:[0,1],[C]:[0,1],[R]:[0,5],[w]:[1,2],[p]:[0,2],[T]:[1,3]},(([e,t],s)=>{X(e?["get","has","forEach"]:["get"],(e=>H[e+d+s]=(...t)=>o[e+s](...t))),H[u+d+s+c]=(...e)=>o[u+s+c](...A(e,0,t),((s,...n)=>e[t](H,...n)),!0)})),de(H)})),bt=Ze((e=>{const t=ke(),n=ke(),o=ke(),r=ke(),[a,l,i]=tt((()=>p)),[c,d,u,g,h,f,,,b,I,w,L]=Xe(e,(()=>[ke(),ke(),ke(),ke()]),(e=>Q(e)?void 0:e+s),a,l),C=(e,t,s)=>z(f(e),(([n,,o])=>{if(!Se(o,t)){const r=Ge();if(h(e)!=T(e))Ke(r,t);else{let e=t;for(;!Q(e)&&!Se(r,e);)Ke(r,e),e=xe(n,e)}if(s)return r;Je(o,t,r)}return xe(o,t)})),R=(e,t)=>z(f(e),(([,,e])=>Je(e,t))),T=e=>xe(t,e),p={setRelationshipDefinition:(e,s,a,i)=>(Je(t,e,a),b(e,s,((t,s)=>{const a=Ge(),i=Ge(),c=Ge(),[d,u]=f(e);me(s,(([t,s],n)=>{Q(t)||(Ke(i,t),z(xe(u,t),(e=>{Ee(e,n),ye(e)&&Je(u,t)}))),Q(s)||(Ke(i,s),Se(u,s)||Je(u,s,Ge()),Ke(xe(u,s),n)),Ke(a,n),Je(d,n,s),He(xe(r,e),(t=>{Se(C(e,t),n)&&Ke(c,t)}))})),t(),me(a,(t=>l(n,[e,t]))),me(i,(t=>l(o,[e,t]))),me(c,(t=>{R(e,t),l(r,[e,t])}))}),Ye(i)),p),delRelationshipDefinition:e=>(Je(t,e),I(e),p),getStore:c,getRelationshipIds:d,forEachRelationship:t=>u((s=>t(s,(t=>e.forEachRow(h(s),t))))),hasRelationship:g,getLocalTableId:h,getRemoteTableId:T,getRemoteRowId:(e,t)=>xe(f(e)?.[0],t),getLocalRowIds:(e,t)=>Me(xe(f(e)?.[1],t)),getLinkedRowIds:(e,t)=>Q(f(e))?[t]:Me(C(e,t,!0)),addRelationshipIdsListener:w,addRemoteRowIdListener:(e,t,s)=>a(s,n,[e,t]),addLocalRowIdsListener:(e,t,s)=>a(s,o,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(C(e,t),a(s,r,[e,t])),delListener:e=>(R(...i(e)??[]),p),destroy:L,getListenerStats:()=>({remoteRowId:pe(n),localRowIds:pe(o),linkedRowIds:pe(r)})};return de(p)})),It=new k.TextEncoder,wt=e=>{let t=2166136261;return X(It.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},Lt=([e,t])=>Rt(e,t),Ct=([e,t,s])=>[e,t,s],Rt=(e,t)=>t?[e,t]:[e],Tt=(e,t,s)=>[e,t,s],pt=e=>e[2],vt=(e,t)=>wt(e+":"+t),St=(e,t)=>t>e?(e?wt(e):0)^wt(t):0,yt=(e,t)=>((e??"")>(t??"")?e:t)??"",Mt=(e,t,s)=>{t>e[1]&&(e[1]=t),e[2]=s>>>0},Vt=(e=s)=>Rt(ue(),e),mt=(e=s)=>[ke(),e,0],Et=([e,t,s],n=Ct)=>[ze(e,n),t,s],kt=([e,t],s=Lt)=>Rt(ze(e,s),t),Dt=(e,s)=>j(e)&&3==P(e)&&O(e[1])&&t(e[2])==r&&F(e[2])&&s(e[0]),xt=e=>[e,e],Ht=(e,t=Te)=>t(e[0])+t(e[1]),Jt=()=>[ke(),ke()],Ft=e=>[...e],Qt=([e,t])=>e===t,zt=JSON.stringify,Nt=JSON.parse,Ot=e=>zt(e,((e,t)=>t instanceof Map?oe.fromEntries([...t]):t)),Wt=(e,t,s)=>Je(e,t,xe(e,t)==-s?void 0:s),jt=()=>{let e,t,s=!1,n=!1,o=0,a=[];const d=ke(),h=ke(),R=ke(),V=ke(),m=ke(),E=ke(),k=ke(),D=ke(),x=ke(),H=ke(),J=ke(),F=ke(),O=ke(),P=ke(),_=Ge(),U=ke(),G=ke(),Z=ke(),$=ke(),ee=Jt(),se=Jt(),ne=Jt(),oe=Jt(),re=Jt(),ae=Jt(),le=Jt(),ie=Jt(),ce=Jt(),ue=Jt(),fe=Jt(),we=Jt(),Ce=Jt(),Me=Jt(),Pe=Jt(),Be=Jt(),Xe=Jt(),Ye=Jt(),Ze=Jt(),$e=Jt(),st=Jt(),nt=Jt(),ot=ke(),rt=Jt(),[at,lt,ct,dt]=tt((()=>Os)),ut=e=>{if(!Le(e,((e,t)=>B([l,i],t))))return!1;const t=e[l];return!(!N(t)&&t!=r||(_e(e[i])!=t&&he(e,i),0))},gt=j,ht=(t,s)=>(!e||Se(J,s)||Yt(s))&&Le(t,((e,t)=>ft(s,t,e)),(()=>Yt(s))),ft=(e,t,s,n)=>Le(n?s:Lt(s,e,t),((n,o)=>z(bt(e,t,o,n),(e=>(s[o]=e,!0)),(()=>!1))),(()=>Yt(e,t))),bt=(t,s,n,o)=>e?z(xe(xe(J,t),n),(e=>_e(o)!=e[l]?Yt(t,s,n,o,e[i]):o),(()=>Yt(t,s,n,o))):Q(_e(o))?Yt(t,s,n,o):o,It=(e,t)=>Le(t?e:Ct(e),((t,s)=>z(wt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Zt())),wt=(e,s)=>t?z(xe(O,e),(t=>_e(s)!=t[l]?Zt(e,s,t[i]):s),(()=>Zt(e,s))):Q(_e(s))?Zt(e,s):s,Lt=(e,t,s)=>(z(xe(F,t),(([n,o])=>{me(n,((t,s)=>{ge(e,s)||(e[s]=t)})),me(o,(n=>{ge(e,n)||Yt(t,s,n)}))})),e),Ct=e=>(t&&(me(P,((t,s)=>{ge(e,s)||(e[s]=t)})),me(_,(t=>{ge(e,t)||Zt(t)}))),e),Rt=e=>Qe(J,e,((e,t,s)=>{const n=ke(),o=Ge();Qe(Fe(J,t,ke),s,((e,t,s)=>{Je(e,t,s),z(s[i],(e=>Je(n,t,e)),(()=>Ke(o,t)))})),Je(F,t,[n,o])}),((e,t)=>{Je(J,t),Je(F,t)})),Tt=e=>Qe(O,e,((e,t,s)=>{Je(O,t,s),z(s[i],(e=>Je(P,t,e)),(()=>Ke(_,t)))}),((e,t)=>{Je(O,t),Je(P,t),Ee(_,t)})),pt=e=>Ie(e)?ks():ys(e),vt=e=>Qe(Z,e,((e,t,s)=>St(t,s)),((e,t)=>zt(t))),St=(e,t)=>Qe(Fe(Z,e,(()=>(Bt(e,1),Je(U,e,et()),Je(G,e,ke()),ke()))),t,((t,s,n)=>yt(e,t,s,n)),((t,s)=>At(e,t,s))),yt=(e,t,s,n,o)=>Qe(Fe(t,s,(()=>(Ut(e,s,1),ke()))),n,((t,n,o)=>Mt(e,s,t,n,o)),((n,r)=>Pt(e,t,s,n,r,o))),Mt=(e,t,s,n,o)=>{Se(s,n)||qt(e,t,n,1);const r=xe(s,n);o!==r&&(Gt(e,t,n,r,o),Je(s,n,o))},Vt=(e,t,s,n,o)=>z(xe(t,s),(t=>Mt(e,s,t,n,o)),(()=>yt(e,t,s,Lt({[n]:o},e,s)))),mt=e=>Ie(e)?Hs():Ms(e),Et=e=>Qe($,e,((e,t,s)=>kt(t,s)),((e,t)=>_t(t))),kt=(e,t)=>{Se($,e)||Kt(e,1);const s=xe($,e);t!==s&&(Xt(e,s,t),Je($,e,t))},Dt=e=>xe(Z,e)??St(e,{}),zt=e=>St(e,{}),At=(e,t,s)=>{const[,n]=xe(U,e);n(s),yt(e,t,s,{},!0)},Pt=(e,t,s,n,o,r)=>{const a=xe(xe(F,e)?.[0],o);if(!Q(a)&&!r)return Mt(e,s,n,o,a);const l=t=>{Gt(e,s,t,xe(n,t)),qt(e,s,t,-1),Je(n,t)};Q(a)?l(o):He(n,l),ye(n)&&(Ut(e,s,-1),ye(Je(t,s))&&(Bt(e,-1),Je(Z,e),Je(U,e),Je(G,e)))},_t=e=>{const t=xe(P,e);if(!Q(t))return kt(e,t);Xt(e,xe($,e)),Kt(e,-1),Je($,e)},Bt=(e,t)=>Wt(d,e,t),Ut=(e,t,s)=>Wt(Fe(V,e,ke),t,s)&&Je(R,e,Fe(R,e,(()=>0))+s),qt=(e,t,s,n)=>{const o=xe(G,e),r=xe(o,s)??0;(0==r&&1==n||1==r&&-1==n)&&Wt(Fe(h,e,ke),s,n),Je(o,s,r!=-n?r+n:null),Wt(Fe(Fe(m,e,ke),t,ke),s,n)},Gt=(e,t,s,n,o)=>{Fe(Fe(Fe(E,e,ke),t,ke),s,(()=>[n,0]))[1]=o,a[3]?.(e,t,s,o)},Kt=(e,t)=>Wt(k,e,t),Xt=(e,t,s)=>{Fe(D,e,(()=>[t,0]))[1]=s,a[4]?.(e,s)},Yt=(e,t,s,n,o)=>(te(Fe(Fe(Fe(x,e,ke),t,ke),s,(()=>[])),n),o),Zt=(e,t,s)=>(te(Fe(H,e,(()=>[])),t),s),$t=(e,t,s)=>z(xe(xe(xe(E,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...xt(fs(e,t,s))])),es=e=>z(xe(D,e),(([e,t])=>[!0,e,t]),(()=>[!1,...xt(ws(e))])),ts=e=>ye(x)||ye(Be[e])?0:me(e?Ae(x):x,((t,s)=>me(t,((t,n)=>me(t,((t,o)=>lt(Be[e],[s,n,o],t))))))),ss=e=>ye(H)||ye(Xe[e])?0:me(e?We(H):H,((t,s)=>lt(Xe[e],[s],t))),ns=(e,t,s,n)=>{if(!ye(e))return lt(t,n,(()=>ze(e))),He(e,((e,t)=>lt(s,[...n??[],e],1==t))),1},os=e=>{const t=Ls();t!=s&&lt(ee[e],void 0,t);const n=ye(ue[e]),o=ye(Ce[e])&&ye(Me[e])&&ye(ce[e])&&ye(fe[e])&&ye(ae[e])&&ye(le[e])&&ye(ie[e])&&n&&ye(ne[e])&&ye(oe[e]),r=ye(Pe[e])&&ye(we[e])&&ye(re[e])&&ye(se[e]);if(!o||!r){const t=e?[We(d),je(h),We(R),je(V),Ae(m),Ae(E)]:[d,h,R,V,m,E];if(!o){ns(t[0],ne[e],oe[e]),me(t[1],((t,s)=>ns(t,ae[e],le[e],[s]))),me(t[2],((t,s)=>{0!=t&&lt(ie[e],[s],ds(s))}));const s=Ge();me(t[3],((t,o)=>{ns(t,ce[e],fe[e],[o])&&!n&&(lt(ue[e],[o,null]),Ke(s,o))})),n||me(t[5],((t,n)=>{if(!Se(s,n)){const s=Ge();me(t,(e=>me(e,(([t,n],o)=>n!==t?Ke(s,o):Ee(e,o))))),me(s,(t=>lt(ue[e],[n,t])))}})),me(t[4],((t,s)=>me(t,((t,n)=>ns(t,Ce[e],Me[e],[s,n])))))}if(!r){let s;me(t[5],((t,n)=>{let o;me(t,((t,r)=>{let a;me(t,(([t,l],i)=>{l!==t&&(lt(Pe[e],[n,r,i],l,t,$t),s=o=a=1)})),a&&lt(we[e],[n,r],$t)})),o&&lt(re[e],[n],$t)})),s&&lt(se[e],void 0,$t)}}},rs=e=>{const t=vs();t!=n&&lt(Ye[e],void 0,t);const s=ye($e[e])&&ye(st[e]),o=ye(nt[e])&&ye(Ze[e]);if(!s||!o){const t=e?[We(k),We(D)]:[k,D];if(s||ns(t[0],$e[e],st[e]),!o){let s;me(t[1],(([t,n],o)=>{n!==t&&(lt(nt[e],[o],n,t,es),s=1)})),s&&lt(Ze[e],void 0,es)}}},as=(e,...t)=>(Qs((()=>e(...Y(t,M)))),Os),ls=()=>Oe(Z),is=()=>De(Z),cs=e=>De(xe(G,M(e))),ds=e=>Re(xe(Z,M(e))),us=e=>De(xe(Z,M(e))),gs=(e,t,s,n=0,o)=>{return Y(A(K((r=xe(Z,M(e)),a=(e,s)=>[Q(t)?s:xe(e,M(t)),s],Y([...r?.entries()??[]],(([e,t])=>a(t,e)))),(([e],[t])=>it(e,t)*(s?-1:1))),n,Q(o)?o:n+o),(([,e])=>e));var r,a},hs=(e,t)=>De(xe(xe(Z,M(e)),M(t))),fs=(e,t,s)=>xe(xe(xe(Z,M(e)),M(t)),M(s)),bs=()=>ze($),Is=()=>De($),ws=e=>xe($,M(e)),Ls=()=>!ye(Z),Cs=e=>Se(Z,M(e)),Rs=(e,t)=>Se(xe(G,M(e)),M(t)),Ts=(e,t)=>Se(xe(Z,M(e)),M(t)),ps=(e,t,s)=>Se(xe(xe(Z,M(e)),M(t)),M(s)),vs=()=>!ye($),Ss=e=>Se($,M(e)),ys=e=>as((()=>(e=>Le(e,ht,Yt))(e)?vt(e):0)),Ms=e=>as((()=>It(e)?Et(e):0)),Vs=e=>{try{pt(Nt(e))}catch{}return Os},ms=t=>as((()=>{if((e=Le(t,(e=>Le(e,ut))))&&(Rt(t),!ye(Z))){const e=ls();ks(),ys(e)}})),Es=e=>as((()=>{if(t=(e=>Le(e,ut))(e)){const s=bs();Fs(),Hs(),t=!0,Tt(e),Ms(s)}})),ks=()=>as((()=>vt({}))),Ds=e=>as((e=>Se(Z,e)?zt(e):0),e),xs=(e,t)=>as(((e,t)=>z(xe(Z,e),(s=>Se(s,t)?At(e,s,t):0))),e,t),Hs=()=>as((()=>Et({}))),Js=()=>as((()=>{Rt({}),e=!1})),Fs=()=>as((()=>{Tt({}),t=!1})),Qs=(e,t)=>{if(-1!=o){zs();const s=e();return Ns(t),s}},zs=()=>(-1!=o&&o++,1==o&&(a[0]?.(),lt(ot)),Os),Ns=e=>(o>0&&(o--,0==o&&(o=1,ts(1),ye(E)||os(1),ss(1),ye(D)||rs(1),e?.(Os)&&(me(E,((e,t)=>me(e,((e,s)=>me(e,(([e],n)=>Ue(Os,t,s,n,e))))))),Ve(E),me(D,(([e],t)=>qe(Os,t,e))),Ve(D)),lt(rt[0],void 0),o=-1,ts(0),ye(E)||os(0),ss(0),ye(D)||rs(0),a[1]?.(),lt(rt[1],void 0),a[2]?.(),o=0,s=Ls(),n=vs(),X([d,h,R,V,m,E,x,k,D,H],Ve))),Os),Os={getContent:()=>[ls(),bs()],getTables:ls,getTableIds:is,getTable:e=>Ne(xe(Z,M(e))),getTableCellIds:cs,getRowCount:ds,getRowIds:us,getSortedRowIds:gs,getRow:(e,t)=>ze(xe(xe(Z,M(e)),M(t))),getCellIds:hs,getCell:fs,getValues:bs,getValueIds:Is,getValue:ws,hasTables:Ls,hasTable:Cs,hasTableCell:Rs,hasRow:Ts,hasCell:ps,hasValues:vs,hasValue:Ss,getTablesJson:()=>Ot(Z),getValuesJson:()=>Ot($),getJson:()=>Ot([Z,$]),getTablesSchemaJson:()=>Ot(J),getValuesSchemaJson:()=>Ot(O),getSchemaJson:()=>Ot([J,O]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>as((()=>{const t=W(e)?e():e;gt(t)&&(([e,t])=>{(Ie(e)?ks:ys)(e),(Ie(t)?Hs:Ms)(t)})(t)})),setTables:ys,setTable:(e,t)=>as((e=>ht(t,e)?St(e,t):0),e),setRow:(e,t,s)=>as(((e,t)=>ft(e,t,s)?yt(e,Dt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Qs((()=>{let n;return ft(e,n,t)&&(e=M(e),yt(e,Dt(e),n=((e,t)=>{const[s]=xe(U,e);let n;do{n=s(t)}while(Se(xe(Z,e),n));return n})(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>as(((e,t)=>{if(ft(e,t,s,1)){const n=Dt(e);be(s,((s,o)=>Vt(e,n,t,o,s)))}}),e,t),setCell:(e,t,s,n)=>as(((e,t,s)=>z(bt(e,t,s,W(n)?n(fs(e,t,s)):n),(n=>Vt(e,Dt(e),t,s,n)))),e,t,s),setValues:Ms,setPartialValues:e=>as((()=>It(e,1)?be(e,((e,t)=>kt(t,e))):0)),setValue:(e,t)=>as((e=>z(wt(e,W(t)?t(ws(e)):t),(t=>kt(e,t)))),e),applyChanges:e=>as((()=>{be(e[0],((e,t)=>Q(e)?Ds(t):be(e,((e,s)=>Q(e)?xs(t,s):be(e,((e,n)=>Ue(Os,t,s,n,e))))))),be(e[1],((e,t)=>qe(Os,t,e)))})),setTablesJson:Vs,setValuesJson:e=>{try{mt(Nt(e))}catch{}return Os},setJson:e=>as((()=>{try{const[t,s]=Nt(e);pt(t),mt(s)}catch{Vs(e)}})),setTablesSchema:ms,setValuesSchema:Es,setSchema:(e,t)=>as((()=>{ms(e),Es(t)})),delTables:ks,delTable:Ds,delRow:xs,delCell:(e,t,s,n)=>as(((e,t,s)=>z(xe(Z,e),(o=>z(xe(o,t),(r=>Se(r,s)?Pt(e,o,t,r,s,n):0))))),e,t,s),delValues:Hs,delValue:e=>as((e=>Se($,e)?_t(e):0),e),delTablesSchema:Js,delValuesSchema:Fs,delSchema:()=>as((()=>{Js(),Fs()})),transaction:Qs,startTransaction:zs,getTransactionChanges:()=>[ze(E,((e,t)=>-1===xe(d,t)?void 0:ze(e,((e,s)=>-1===xe(xe(V,t),s)?void 0:ze(e,(([,e])=>e),(e=>Qt(e)))),ye,Ie)),ye,Ie),ze(D,(([,e])=>e),(e=>Qt(e))),1],getTransactionLog:()=>[!ye(E),!ye(D),Oe(E,Ft,Qt),Oe(x),ze(D,Ft,Qt),ze(H),ze(d),Ne(V),Oe(m),ze(k)],finishTransaction:Ns,forEachTable:e=>me(Z,((t,s)=>e(s,(e=>me(t,((t,s)=>e(s,(e=>He(t,e))))))))),forEachTableCell:(e,t)=>He(xe(G,M(e)),t),forEachRow:(e,t)=>me(xe(Z,M(e)),((e,s)=>t(s,(t=>He(e,t))))),forEachCell:(e,t,s)=>He(xe(xe(Z,M(e)),M(t)),s),forEachValue:e=>He($,e),addSortedRowIdsListener:(e,t,s,n,o,r,a)=>{let l=gs(e,t,s,n,o);return at((()=>{const a=gs(e,t,s,n,o);q(a,l)||(l=a,r(Os,e,t,s,n,o,l))}),ue[a?1:0],[e,t],[is])},addStartTransactionListener:e=>at(e,ot),addWillFinishTransactionListener:e=>at(e,rt[0]),addDidFinishTransactionListener:e=>at(e,rt[1]),callListener:e=>(dt(e),Os),delListener:e=>(ct(e),Os),getListenerStats:()=>({hasTables:Ht(ee),tables:Ht(se),tableIds:Ht(ne),hasTable:Ht(oe),table:Ht(re),tableCellIds:Ht(ae),hasTableCell:Ht(le,pe),rowCount:Ht(ie),rowIds:Ht(ce),sortedRowIds:Ht(ue),hasRow:Ht(fe,pe),row:Ht(we,pe),cellIds:Ht(Ce,pe),hasCell:Ht(Me,ve),cell:Ht(Pe,ve),invalidCell:Ht(Be,ve),hasValues:Ht(Ye),values:Ht(Ze),valueIds:Ht($e),hasValue:Ht(st),value:Ht(nt),invalidValue:Ht(Xe),transaction:Te(ot)+Ht(rt)}),isMergeable:()=>!1,createStore:jt,addListener:at,callListeners:lt,setInternalListeners:(e,t,s,n,o)=>a=[e,t,s,n,o]};return be({[g+b]:[0,ee,[],()=>[Ls()]],[b]:[0,se],[I]:[0,ne],[g+f]:[1,oe,[is],e=>[Cs(...e)]],[f]:[1,re,[is]],[f+p]:[1,ae,[is]],[g+f+T]:[2,le,[is,cs],e=>[Rs(...e)]],[L]:[1,ie,[is]],[C]:[1,ce,[is]],[g+w]:[2,fe,[is,us],e=>[Ts(...e)]],[w]:[2,we,[is,us]],[p]:[2,Ce,[is,us]],[g+T]:[3,Me,[is,us,hs],e=>[ps(...e)]],[T]:[3,Pe,[is,us,hs],e=>xt(fs(...e))],InvalidCell:[3,Be],[g+S]:[0,Ye,[],()=>[vs()]],[S]:[0,Ze],[y]:[0,$e],[g+v]:[1,st,[Is],e=>[Ss(...e)]],[v]:[1,nt,[Is],e=>xt(ws(e[0]))],InvalidValue:[1,Xe]},(([e,t,s,n],o)=>{Os[u+o+c]=(...o)=>at(o[e],t[o[e+1]?1:0],e>0?A(o,0,e):void 0,s,n)})),de(Os)},At=2**36,Pt=2**30,_t=2**24,Bt=2**18,Ut=4096,qt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Gt=(e=s)=>[mt(e),mt(e)];e.createCheckpoints=st,e.createIndexes=dt,e.createMergeableStore=e=>{let t=1,n=Gt(),o=0;const r=ke(),a=Ge(),[l,i]=(e=>{let t=0,s=-1;const n=z(e,(e=>{const t=wt(e);return rt(t/_t)+rt(t/Bt)+rt(t/Ut)+rt(t/64)+rt(t)}),(()=>ct(5))),o=e=>{const n=t,[o,r]=Q(e)||""==e?[0,0]:[at(a=e,0)*At+at(a,1)*Pt+at(a,2)*_t+at(a,3)*Bt+at(a,4)*Ut+64*at(a,5)+at(a,6),at(a,7)*Bt+at(a,8)*Ut+64*at(a,9)+at(a,10)];var a;t=x(n,o,k.HLC_TIME??Date.now()),s=t==n?t==o?x(s,r):s:t==o?r:-1};return[()=>{return o(),r=++s,rt((e=t)/At)+rt(e/Pt)+rt(e/_t)+rt(e/Bt)+rt(e/Ut)+rt(e/64)+rt(e)+rt(r/Bt)+rt(r/Ut)+rt(r/64)+rt(r)+n;var e,r},o]})(e),d=jt(),g=e=>{const s=t;return t=0,e(),t=s,w},h=(e,t=0)=>{const o={},r={},[[a,l=s,c=0],d]=e,[u,g]=n,[h,b,I]=u;let w=t?c:I,L=l;fe(a,(([e,n=s,r=0],a)=>{const l=Fe(h,a,mt),[i,c,d]=l;let u=t?r:d,g=n;fe(e,((e,s)=>{const[n,r,l]=f(e,Fe(i,s,mt),we(we(o,a,ue),s,ue),t);u^=t?0:(r?vt(s,r):0)^vt(s,l),g=yt(g,n)})),u^=t?0:St(c,n),Mt(l,n,u),w^=t?0:(d?vt(a,d):0)^vt(a,l[2]),L=yt(L,g)})),w^=t?0:St(b,l),Mt(u,l,w);const[C]=f(d,g,r,t);return i(yt(L,C)),[o,r,1]},f=(e,t,n,o)=>{const[r,a=s,l=0]=e,[i,c,d]=t;let u=a,g=o?l:d;return fe(r,(([e,t,r=0],a)=>{const l=Fe(i,a,(()=>[void 0,s,0])),[,c,d]=l;(!c||t>c)&&(Mt(l,t,o?r:wt(Ot(e??null)+":"+t)),l[0]=e,n[a]=e,g^=o?0:vt(a,d)^vt(a,l[2]),u=yt(u,t))})),g^=o?0:St(c,a),Mt(t,a,g),[u,d,t[2]]},b=()=>[Et(n[0],(e=>Et(e,(e=>Et(e))))),Et(n[1])],I=e=>g((()=>d.applyChanges(h(e)))),w={getMergeableContent:b,getMergeableContentHashes:()=>[n[0][2],n[1][2]],getMergeableTableHashes:()=>ze(n[0][0],pt),getMergeableTableDiff:e=>{const t=Vt(n[0][1]),s={};return He(n[0][0],((n,[o,r,a])=>ge(e,n)?a!=e[n]?s[n]=a:0:t[0][n]=kt([o,r],(e=>kt(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return fe(e,((e,s)=>z(xe(n[0][0],s),(([n,,o])=>o!=e?He(n,((e,[,,n])=>we(t,s,ue)[e]=n)):0)))),t},getMergeableRowDiff:e=>{const t=Vt(n[0][1]),s={};return fe(e,((e,o)=>He(xe(n[0][0],o)?.[0],((n,[r,a,l])=>ge(e,n)?l!==e[n]?we(s,o,ue)[n]=l:0:we(t[0],o,Vt)[0][n]=kt([r,a]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return fe(e,((e,s)=>z(xe(n[0][0],s),(([n])=>fe(e,((e,o)=>z(xe(n,o),(([n,,r])=>r!==e?He(n,((e,[,,n])=>we(we(t,s,ue),o,ue)[e]=n)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=n,o={};return fe(e,((e,s)=>fe(e,((e,n)=>z(xe(t,s),(([t,r])=>z(xe(t,n),(([t,a])=>He(t,((t,[l,i,c])=>c!==e[t]?we(we(o,s,(()=>Vt(r)))[0],n,(()=>Vt(a)))[0][t]=[l,i]:0)))))))))),Rt(o,s)},getMergeableValueHashes:()=>ze(n[1][0],pt),getMergeableValueDiff:e=>{const[,[t,s]]=n,o=ze(t,Lt,(([,,t],s)=>t==e?.[s]));return Rt(o,s)},setMergeableContent:e=>g((()=>(e=>j(e)&&2==P(e)&&Dt(e[0],(e=>Le(e,(e=>Dt(e,(e=>Le(e,(e=>Dt(e,(e=>Le(e,(e=>Dt(e,Be)),void 0,1)))),void 0,1)))),void 0,1)))&&Dt(e[1],(e=>Le(e,(e=>Dt(e,Be)),void 0,1))))(e)?d.transaction((()=>{d.delTables().delValues(),n=Gt(),d.applyChanges(h(e,1))})):0)),setDefaultContent:e=>(d.transaction((()=>{o=1,d.setContent(e),o=0})),w),getTransactionMergeableChanges:(e=!1)=>{const[[t,s,o],[l,i,c]]=n,d=e?Tt:Rt,u={};me(r,((e,s)=>z(xe(t,s),(([t,n,o])=>{const r={};me(e,((e,s)=>z(xe(t,s),(([t,n,o])=>{const a={};me(e,(e=>{z(xe(t,e),(([t,s,n])=>a[e]=d(t,s,n)))})),r[s]=d(a,n,o)})))),u[s]=d(r,n,o)}))));const g={};return me(a,(e=>z(xe(l,e),(([t,s,n])=>g[e]=d(t,s,n))))),[d(u,s,o),d(g,i,c),1]},applyMergeableChanges:I,merge:e=>{const t=b(),s=e.getMergeableContent();return e.applyMergeableChanges(t),I(s)}};return d.setInternalListeners((()=>{}),(()=>{}),(()=>{Ve(r),Ve(a)}),((e,n,a,i)=>{Ke(Fe(Fe(r,e,ke),n,Ge),a),t&&h([[{[e]:[{[n]:[{[a]:[i,o?s:l()]}]}]}],[{}],1])}),((e,n)=>{Ke(a,e),t&&h([[{}],[{[e]:[n,o?s:l()]}],1])})),be(d,((e,t)=>w[t]=V(t,"set")||V(t,"del")||V(t,"apply")||m(t,"Transaction")||t=="call"+c?(...t)=>(e(...t),w):V(t,u)&&m(t,c)?(...s)=>{const n=qt[A(t,3,-8)]??0,o=s[n];return s[n]=(e,...t)=>o(w,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),de(w)},e.createMetrics=ht,e.createQueries=ft,e.createRelationships=bt,e.createStore=jt,e.defaultSorter=it,e.getUniqueId=ct},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={});
