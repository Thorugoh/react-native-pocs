var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=e=>n+e,o=e=>null==e,d=(e,t,n)=>o(e)?n?.():t(e),i=e=>Array.isArray(e),c=e=>e.length,l=(e,t)=>e.every(t),a=(e,t)=>l(e,((n,s)=>0==s||t(e[s-1],n)<=0)),u=(e,t)=>e.sort(t),f=(e,t)=>e.forEach(t),I=(e,...t)=>e.push(...t),h=Object.freeze,g=e=>t=>{return n=(t,n)=>t+e(n),L(t).reduce(n,0);var n},p=e=>e?.size??0,x=g(p),y=g(x),v=(e,t)=>e?.has(t)??!1,w=e=>o(e)||0==p(e),L=e=>[...e?.values()??[]],S=e=>e.clear(),b=(e,t)=>e?.forEach(t),R=(e,t)=>e?.delete(t),T=e=>new Map(e),E=e=>[...e?.keys()??[]],m=(e,t)=>e?.get(t),j=(e,t)=>b(e,((e,n)=>t(n,e))),k=(e,t,n)=>o(n)?(R(e,t),e):e?.set(t,n),z=(e,t,n,s)=>(v(e,t)?s?.(m(e,t)):k(e,t,n()),m(e,t)),A=(e,t,n,s,r=0)=>d((n?z:m)(e,t[r],r>c(t)-2?n:T),(o=>{if(r>c(t)-2)return s?.(o)&&k(e,t[r]),o;const d=A(o,t,n,s,r+1);return w(o)&&k(e,t[r]),d})),C=e=>new Set(i(e)||o(e)?e:[e]),D=(e,t)=>e?.add(t),M=(e,r)=>t(e)==s?t=>t(e):e??(()=>r??n),B=(e,t)=>(e??0)<(t??0)?-1:1,O=/^\d+$/,W=(()=>{const e=new WeakMap;return t=>(e.has(t)||e.set(t,(e=>{const t=T(),s=T(),[g,p,W]=(()=>{let e;const[t,s]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{O.test(t)&&c(e)<1e3&&I(e,t)}]})(),r=T();return[(s,o,d,i=[],c=()=>[])=>{e??=X;const l=t(1);return k(r,l,[s,o,d,i,c]),D(A(o,d??[n],C),l),l},(t,s,...o)=>f(((e,t=[n])=>{const s=[],r=(e,n)=>n==c(t)?I(s,e):null===t[n]?b(e,(e=>r(e,n+1))):f([t[n],null],(t=>r(m(e,t),n+1)));return r(e,0),s})(t,s),(t=>b(t,(t=>m(r,t)[0](e,...s??[],...o))))),e=>d(m(r,e),(([,t,o])=>(A(t,o??[n],void 0,(t=>(R(t,e),w(t)?1:0))),k(r,e),s(e),o))),t=>d(m(r,t),(([t,,n=[],s,r])=>{const d=(...i)=>{const l=c(i);l==c(n)?t(e,...i,...r(i)):o(n[l])?f(s[l]?.(...i)??[],(e=>d(...i,e))):d(...i,n[l])};d()}))]})(),[$,q,F,G,H,J,K,,N,P,Q,U]=((e,t,n,s,r)=>{const a=e.hasRow,u=T(),I=T(),h=T(),g=T(),p=T(),x=T(),y=(t,n,...s)=>{const r=z(x,t,C);return f(s,(t=>D(r,t)&&n&&e.callListener(t))),s},A=(t,...n)=>d(m(x,t),(s=>{f(0==c(n)?L(s):n,(t=>{e.delListener(t),R(s,t)})),w(s)&&k(x,t)})),M=(e,n)=>{k(u,e,n),v(I,e)||(k(I,e,t()),k(g,e,T()),k(p,e,T()),r(h))},B=e=>{k(u,e),k(I,e),k(g,e),k(p,e),A(e),r(h)};return[()=>e,()=>E(u),e=>j(I,e),e=>v(I,e),e=>m(u,e),e=>m(I,e),(e,t)=>k(I,e,t),M,(t,s,r,d,u)=>{M(t,s);const I=T(),h=T(),x=m(g,t),w=m(p,t),L=t=>{const r=n=>e.getCell(s,t,n),f=m(x,t),g=a(s,t)?n(d(r,t)):void 0;var p,y;if(f===g||i(f)&&i(g)&&(y=g,c(p=f)===c(y)&&l(p,((e,t)=>y[t]===e)))||k(I,t,[f,g]),!o(u)){const e=m(w,t),n=a(s,t)?u(r,t):void 0;e!=n&&k(h,t,n)}},R=e=>{r((()=>{b(I,(([,e],t)=>k(x,t,e))),b(h,((e,t)=>k(w,t,e)))}),I,h,x,w,e),S(I),S(h)};j(x,L),e.hasTable(s)&&f(e.getRowIds(s),(e=>{v(x,e)||L(e)})),R(!0),A(t),y(t,0,e.addRowListener(s,null,((e,t,n)=>L(n))),e.addTableListener(s,(()=>R())))},B,e=>s(e,h),()=>j(x,B),y,A]})(e,T,(e=>{return o(e)?n:i(e)?(t=r,e.map(t)):r(e);var t}),g,p),V=(t,n,s)=>{const r=H(t);b(s,((t,s)=>n(s,(n=>b(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},X={setIndexDefinition:(e,n,r,i,c,l=B)=>{const f=o(c)?void 0:([e],[t])=>c(e,t);return N(e,n,((n,r,c,I,h,g)=>{let x=0;const y=C(),L=C(),S=J(e);if(b(r,(([e,t],n)=>{const s=C(e),r=C(t);b(s,(e=>R(r,e)?R(s,e):0)),b(s,(e=>{D(y,e),d(m(S,e),(t=>{R(t,n),w(t)&&(k(S,e),x=1)}))})),b(r,(e=>{D(y,e),v(S,e)||(k(S,e,C()),x=1),D(m(S,e),n),o(i)||D(L,e)}))})),n(),w(h)||(g?j(S,(e=>D(L,e))):j(c,(e=>d(m(I,e),(e=>D(L,e))))),b(L,(e=>{const t=(t,n)=>l(m(h,t),m(h,n),e),n=[...m(S,e)];a(n,t)||(k(S,e,C(u(n,t))),D(y,e))}))),(x||g)&&!o(f)){const t=[...S];a(t,f)||(K(e,T(u(t,f))),x=1)}x&&p(t,[e]),b(y,(t=>p(s,[e,t])))}),M(r),d(i,M)),X},delIndexDefinition:e=>(P(e),X),getStore:$,getIndexIds:q,forEachIndex:e=>F(((t,n)=>e(t,(e=>V(t,e,n))))),forEachSlice:(e,t)=>V(e,t,J(e)),hasIndex:G,hasSlice:(e,t)=>v(J(e),t),getTableId:H,getSliceIds:e=>E(J(e)),getSliceRowIds:(e,t)=>L(m(J(e),t)),addIndexIdsListener:Q,addSliceIdsListener:(e,n)=>g(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>g(n,s,[e,t]),delListener:e=>(W(e),X),destroy:U,getListenerStats:()=>({sliceIds:x(t),sliceRowIds:y(s)})};return h(X)})(t)),e.get(t))})();e.createIndexes=W},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
