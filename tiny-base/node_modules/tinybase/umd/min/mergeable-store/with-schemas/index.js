var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",a=t(s),l=t(!0),n=t(0),r=t(t),o="type",c="default",i="Listener",d="Has",u="Ids",g="Table",h=g+"s",b=g+u,f="Row",C=f+"Count",T=f+u,v="Cell",p=v+u,V="Value",w=V+"s",y=V+u,I=e=>s+e,M=(e,t)=>e.startsWith(t),R=(e,t)=>e.endsWith(t),S=(e,t=s,a)=>e.split(t,a),m=globalThis,L=Math,H=L.max,E=L.floor,J=isFinite,D=e=>null==e,x=(e,t,s)=>D(e)?s?.():t(e),F=e=>e==a||e==l,O=e=>t(e)==r,z=e=>Array.isArray(e),A=(e,t,s)=>e.slice(t,s),P=e=>e.length,W=(e,t)=>e.forEach(t),j=(e,t)=>e.map(t),k=(e,t,s)=>e.reduce(t,s),N=(e,...t)=>e.push(...t),B=Object,U=e=>B.getPrototypeOf(e),_=B.entries,q=B.isFrozen,G=e=>!D(e)&&x(U(e),(e=>e==B.prototype||D(U(e))),(()=>!0)),K=B.keys,Q=B.freeze,X=(e=[])=>B.fromEntries(e),Y=(e,t)=>t in e,Z=(e,t)=>(delete e[t],e),$=(e,t)=>W(_(e),(([e,s])=>t(s,e))),ee=(e,t)=>X(((e,t)=>j(_(e),(([e,s])=>t(s,e))))(e,((e,s)=>[s,t(e,s)]))),te=e=>G(e)&&0==(e=>P(K(e)))(e),se=(e,t,s)=>(Y(e,t)||(e[t]=s()),e[t]),ae=(e,t,s,a=0)=>D(e)||!G(e)||!a&&te(e)||q(e)?(s?.(),!1):($(e,((s,a)=>{t(s,a)||Z(e,a)})),!!a||!te(e)),le=e=>new Set(z(e)||D(e)?e:[e]),ne=(e,t)=>e?.add(t),re=e=>t=>k(he(t),((t,s)=>t+e(s)),0),oe=e=>e?.size??0,ce=re(oe),ie=re(ce),de=re(ie),ue=(e,t)=>e?.has(t)??!1,ge=e=>D(e)||0==oe(e),he=e=>[...e?.values()??[]],be=e=>e.clear(),fe=(e,t)=>e?.forEach(t),Ce=(e,t)=>e?.delete(t),Te=e=>new Map(e),ve=e=>[...e?.keys()??[]],pe=(e,t)=>e?.get(t),Ve=(e,t)=>fe(e,((e,s)=>t(s,e))),we=(e,t,s)=>D(s)?(Ce(e,t),e):e?.set(t,s),ye=(e,t,s,a)=>(ue(e,t)?a?.(pe(e,t)):we(e,t,s()),pe(e,t)),Ie=(e,t,s,a=we)=>(ee(t,((t,a)=>s(e,a,t))),Ve(e,(s=>Y(t,s)?0:a(e,s))),e),Me=(e,t,s,a)=>{const l={};return fe(e,((e,n)=>{if(!s?.(e,n)){const s=t?t(e,n):e;a?.(s)||(l[n]=s)}})),l},Re=(e,t,s)=>Me(e,(e=>Me(e,t,s)),ge,te),Se=(e,t,s)=>Me(e,(e=>Re(e,t,s)),ge,te),me=(e,t)=>{const s=Te();return fe(e,((e,a)=>s.set(a,t?.(e)??e))),s},Le=e=>me(e,me),He=e=>me(e,Le),Ee=(e,t,s,a,l=0)=>x((s?ye:pe)(e,t[l],l>P(t)-2?s:Te),(n=>{if(l>P(t)-2)return a?.(n)&&we(e,t[l]),n;const r=Ee(n,t,s,a,l+1);return ge(n)&&we(e,t[l]),r})),Je=new m.TextEncoder,De=e=>{let t=2166136261;return W(Je.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},xe=([e,t])=>Oe(e,t),Fe=([e,t,s])=>[e,t,s],Oe=(e,t)=>t?[e,t]:[e],ze=(e,t,s)=>[e,t,s],Ae=e=>e[2],Pe=(e,t)=>De(e+":"+t),We=(e,t)=>t>e?(e?De(e):0)^De(t):0,je=(e,t)=>((e??"")>(t??"")?e:t)??"",ke=(e,t,s)=>{t>e[1]&&(e[1]=t),e[2]=s>>>0},Ne=(e=s)=>Oe(X(),e),Be=(e=s)=>[Te(),e,0],Ue=([e,t,s],a=Fe)=>[Me(e,a),t,s],_e=([e,t],s=xe)=>Oe(Me(e,s),t),qe=(e,s)=>{return z(e)&&3==P(e)&&(l=e[1],t(l)==a)&&t(e[2])==n&&J(e[2])&&s(e[0]);var l},Ge=/^\d+$/,Ke=()=>{const e=[];let t=0;return[a=>(a?e.shift():null)??s+t++,t=>{Ge.test(t)&&P(e)<1e3&&N(e,t)}]},Qe=e=>[e,e],Xe=(e,t=ce)=>t(e[0])+t(e[1]),Ye=()=>[Te(),Te()],Ze=e=>[...e],$e=([e,t])=>e===t,et=e=>{const s=t(e);return F(s)||s==n&&J(e)?s:void 0},tt=e=>D(e)||!D(et(e)),st=(e,t,s,a,l)=>D(l)?e.delCell(t,s,a,!0):e.setCell(t,s,a,l),at=(e,t,s)=>D(s)?e.delValue(t):e.setValue(t,s),lt=JSON.stringify,nt=JSON.parse,rt=e=>lt(e,((e,t)=>t instanceof Map?B.fromEntries([...t]):t)),ot=S("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),ct=Te(j(ot,((e,t)=>[e,t]))),it=e=>ot[63&e],dt=(e,t)=>pe(ct,e[t])??0,ut=m.crypto?e=>m.crypto.getRandomValues(e):e=>j(e,(()=>E(256*L.random()))),gt=(e,t,s)=>we(e,t,pe(e,t)==-s?void 0:s),ht=()=>{let e,t,a=!1,l=!1,r=0,u=[];const M=Te(),R=Te(),S=Te(),m=Te(),L=Te(),H=Te(),E=Te(),J=Te(),k=Te(),B=Te(),U=Te(),_=Te(),q=Te(),G=Te(),K=le(),X=Te(),$=Te(),se=Te(),re=Te(),he=Ye(),Je=Ye(),De=Ye(),xe=Ye(),Fe=Ye(),Oe=Ye(),ze=Ye(),Ae=Ye(),Pe=Ye(),We=Ye(),je=Ye(),ke=Ye(),Ne=Ye(),Be=Ye(),Ue=Ye(),_e=Ye(),qe=Ye(),Ge=Ye(),tt=Ye(),lt=Ye(),ot=Ye(),ct=Ye(),it=Te(),dt=Ye(),[ut,bt,ft,Ct]=(()=>{let e;const[t,a]=Ke(),l=Te();return[(a,n,r,o=[],c=()=>[])=>{e??=zs;const i=t(1);return we(l,i,[a,n,r,o,c]),ne(Ee(n,r??[s],le),i),i},(t,a,...n)=>W(((e,t=[s])=>{const a=[],l=(e,s)=>s==P(t)?N(a,e):null===t[s]?fe(e,(e=>l(e,s+1))):W([t[s],null],(t=>l(pe(e,t),s+1)));return l(e,0),a})(t,a),(t=>fe(t,(t=>pe(l,t)[0](e,...a??[],...n))))),e=>x(pe(l,e),(([,t,n])=>(Ee(t,n??[s],void 0,(t=>(Ce(t,e),ge(t)?1:0))),we(l,e),a(e),n))),t=>x(pe(l,t),(([t,,s=[],a,l])=>{const n=(...r)=>{const o=P(r);o==P(s)?t(e,...r,...l(r)):D(s[o])?W(a[o]?.(...r)??[],(e=>n(...r,e))):n(...r,s[o])};n()}))]})(),Tt=e=>{if(!ae(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!F(t)&&t!=n||(et(e[c])!=t&&Z(e,c),0))},vt=z,pt=(t,s)=>(!e||ue(U,s)||Kt(s))&&ae(t,((e,t)=>Vt(s,t,e)),(()=>Kt(s))),Vt=(e,t,s,a)=>ae(a?s:Mt(s,e,t),((a,l)=>x(wt(e,t,l,a),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Kt(e,t))),wt=(t,s,a,l)=>e?x(pe(pe(U,t),a),(e=>et(l)!=e[o]?Kt(t,s,a,l,e[c]):l),(()=>Kt(t,s,a,l))):D(et(l))?Kt(t,s,a,l):l,yt=(e,t)=>ae(t?e:Rt(e),((t,s)=>x(It(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Qt())),It=(e,s)=>t?x(pe(q,e),(t=>et(s)!=t[o]?Qt(e,s,t[c]):s),(()=>Qt(e,s))):D(et(s))?Qt(e,s):s,Mt=(e,t,s)=>(x(pe(_,t),(([a,l])=>{fe(a,((t,s)=>{Y(e,s)||(e[s]=t)})),fe(l,(a=>{Y(e,a)||Kt(t,s,a)}))})),e),Rt=e=>(t&&(fe(G,((t,s)=>{Y(e,s)||(e[s]=t)})),fe(K,(t=>{Y(e,t)||Qt(t)}))),e),St=e=>Ie(U,e,((e,t,s)=>{const a=Te(),l=le();Ie(ye(U,t,Te),s,((e,t,s)=>{we(e,t,s),x(s[c],(e=>we(a,t,e)),(()=>ne(l,t)))})),we(_,t,[a,l])}),((e,t)=>{we(U,t),we(_,t)})),mt=e=>Ie(q,e,((e,t,s)=>{we(q,t,s),x(s[c],(e=>we(G,t,e)),(()=>ne(K,t)))}),((e,t)=>{we(q,t),we(G,t),Ce(K,t)})),Lt=e=>te(e)?ms():ys(e),Ht=e=>Ie(se,e,((e,t,s)=>Et(t,s)),((e,t)=>Pt(t))),Et=(e,t)=>Ie(ye(se,e,(()=>(Nt(e,1),we(X,e,Ke()),we($,e,Te()),Te()))),t,((t,s,a)=>Jt(e,t,s,a)),((t,s)=>Wt(e,t,s))),Jt=(e,t,s,a,l)=>Ie(ye(t,s,(()=>(Bt(e,s,1),Te()))),a,((t,a,l)=>Dt(e,s,t,a,l)),((a,n)=>jt(e,t,s,a,n,l))),Dt=(e,t,s,a,l)=>{ue(s,a)||Ut(e,t,a,1);const n=pe(s,a);l!==n&&(_t(e,t,a,n,l),we(s,a,l))},xt=(e,t,s,a,l)=>x(pe(t,s),(t=>Dt(e,s,t,a,l)),(()=>Jt(e,t,s,Mt({[a]:l},e,s)))),Ft=e=>te(e)?Es():Is(e),Ot=e=>Ie(re,e,((e,t,s)=>zt(t,s)),((e,t)=>kt(t))),zt=(e,t)=>{ue(re,e)||qt(e,1);const s=pe(re,e);t!==s&&(Gt(e,s,t),we(re,e,t))},At=e=>pe(se,e)??Et(e,{}),Pt=e=>Et(e,{}),Wt=(e,t,s)=>{const[,a]=pe(X,e);a(s),Jt(e,t,s,{},!0)},jt=(e,t,s,a,l,n)=>{const r=pe(pe(_,e)?.[0],l);if(!D(r)&&!n)return Dt(e,s,a,l,r);const o=t=>{_t(e,s,t,pe(a,t)),Ut(e,s,t,-1),we(a,t)};D(r)?o(l):Ve(a,o),ge(a)&&(Bt(e,s,-1),ge(we(t,s))&&(Nt(e,-1),we(se,e),we(X,e),we($,e)))},kt=e=>{const t=pe(G,e);if(!D(t))return zt(e,t);Gt(e,pe(re,e)),qt(e,-1),we(re,e)},Nt=(e,t)=>gt(M,e,t),Bt=(e,t,s)=>gt(ye(m,e,Te),t,s)&&we(S,e,ye(S,e,(()=>0))+s),Ut=(e,t,s,a)=>{const l=pe($,e),n=pe(l,s)??0;(0==n&&1==a||1==n&&-1==a)&&gt(ye(R,e,Te),s,a),we(l,s,n!=-a?n+a:null),gt(ye(ye(L,e,Te),t,Te),s,a)},_t=(e,t,s,a,l)=>{ye(ye(ye(H,e,Te),t,Te),s,(()=>[a,0]))[1]=l,u[3]?.(e,t,s,l)},qt=(e,t)=>gt(E,e,t),Gt=(e,t,s)=>{ye(J,e,(()=>[t,0]))[1]=s,u[4]?.(e,s)},Kt=(e,t,s,a,l)=>(N(ye(ye(ye(k,e,Te),t,Te),s,(()=>[])),a),l),Qt=(e,t,s)=>(N(ye(B,e,(()=>[])),t),s),Xt=(e,t,s)=>x(pe(pe(pe(H,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Qe(us(e,t,s))])),Yt=e=>x(pe(J,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Qe(bs(e))])),Zt=e=>ge(k)||ge(_e[e])?0:fe(e?He(k):k,((t,s)=>fe(t,((t,a)=>fe(t,((t,l)=>bt(_e[e],[s,a,l],t))))))),$t=e=>ge(B)||ge(qe[e])?0:fe(e?me(B):B,((t,s)=>bt(qe[e],[s],t))),es=(e,t,s,a)=>{if(!ge(e))return bt(t,a,(()=>Me(e))),Ve(e,((e,t)=>bt(s,[...a??[],e],1==t))),1},ts=e=>{const t=fs();t!=a&&bt(he[e],void 0,t);const s=ge(We[e]),l=ge(Ne[e])&&ge(Be[e])&&ge(Pe[e])&&ge(je[e])&&ge(Oe[e])&&ge(ze[e])&&ge(Ae[e])&&s&&ge(De[e])&&ge(xe[e]),n=ge(Ue[e])&&ge(ke[e])&&ge(Fe[e])&&ge(Je[e]);if(!l||!n){const t=e?[me(M),Le(R),me(S),Le(m),He(L),He(H)]:[M,R,S,m,L,H];if(!l){es(t[0],De[e],xe[e]),fe(t[1],((t,s)=>es(t,Oe[e],ze[e],[s]))),fe(t[2],((t,s)=>{0!=t&&bt(Ae[e],[s],os(s))}));const a=le();fe(t[3],((t,l)=>{es(t,Pe[e],je[e],[l])&&!s&&(bt(We[e],[l,null]),ne(a,l))})),s||fe(t[5],((t,s)=>{if(!ue(a,s)){const a=le();fe(t,(e=>fe(e,(([t,s],l)=>s!==t?ne(a,l):Ce(e,l))))),fe(a,(t=>bt(We[e],[s,t])))}})),fe(t[4],((t,s)=>fe(t,((t,a)=>es(t,Ne[e],Be[e],[s,a])))))}if(!n){let s;fe(t[5],((t,a)=>{let l;fe(t,((t,n)=>{let r;fe(t,(([t,o],c)=>{o!==t&&(bt(Ue[e],[a,n,c],o,t,Xt),s=l=r=1)})),r&&bt(ke[e],[a,n],Xt)})),l&&bt(Fe[e],[a],Xt)})),s&&bt(Je[e],void 0,Xt)}}},ss=e=>{const t=Vs();t!=l&&bt(Ge[e],void 0,t);const s=ge(lt[e])&&ge(ot[e]),a=ge(ct[e])&&ge(tt[e]);if(!s||!a){const t=e?[me(E),me(J)]:[E,J];if(s||es(t[0],lt[e],ot[e]),!a){let s;fe(t[1],(([t,a],l)=>{a!==t&&(bt(ct[e],[l],a,t,Yt),s=1)})),s&&bt(tt[e],void 0,Yt)}}},as=(e,...t)=>(xs((()=>e(...j(t,I)))),zs),ls=()=>Se(se),ns=()=>ve(se),rs=e=>ve(pe($,I(e))),os=e=>oe(pe(se,I(e))),cs=e=>ve(pe(se,I(e))),is=(e,t,s,a=0,l)=>{return j(A((r=pe(se,I(e)),o=(e,s)=>[D(t)?s:pe(e,I(t)),s],n=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),j([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(n)),a,D(l)?l:a+l),(([,e])=>e));var n,r,o},ds=(e,t)=>ve(pe(pe(se,I(e)),I(t))),us=(e,t,s)=>pe(pe(pe(se,I(e)),I(t)),I(s)),gs=()=>Me(re),hs=()=>ve(re),bs=e=>pe(re,I(e)),fs=()=>!ge(se),Cs=e=>ue(se,I(e)),Ts=(e,t)=>ue(pe($,I(e)),I(t)),vs=(e,t)=>ue(pe(se,I(e)),I(t)),ps=(e,t,s)=>ue(pe(pe(se,I(e)),I(t)),I(s)),Vs=()=>!ge(re),ws=e=>ue(re,I(e)),ys=e=>as((()=>(e=>ae(e,pt,Kt))(e)?Ht(e):0)),Is=e=>as((()=>yt(e)?Ot(e):0)),Ms=e=>{try{Lt(nt(e))}catch{}return zs},Rs=t=>as((()=>{if((e=ae(t,(e=>ae(e,Tt))))&&(St(t),!ge(se))){const e=ls();ms(),ys(e)}})),Ss=e=>as((()=>{if(t=(e=>ae(e,Tt))(e)){const s=gs();Ds(),Es(),t=!0,mt(e),Is(s)}})),ms=()=>as((()=>Ht({}))),Ls=e=>as((e=>ue(se,e)?Pt(e):0),e),Hs=(e,t)=>as(((e,t)=>x(pe(se,e),(s=>ue(s,t)?Wt(e,s,t):0))),e,t),Es=()=>as((()=>Ot({}))),Js=()=>as((()=>{St({}),e=!1})),Ds=()=>as((()=>{mt({}),t=!1})),xs=(e,t)=>{if(-1!=r){Fs();const s=e();return Os(t),s}},Fs=()=>(-1!=r&&r++,1==r&&(u[0]?.(),bt(it)),zs),Os=e=>(r>0&&(r--,0==r&&(r=1,Zt(1),ge(H)||ts(1),$t(1),ge(J)||ss(1),e?.(zs)&&(fe(H,((e,t)=>fe(e,((e,s)=>fe(e,(([e],a)=>st(zs,t,s,a,e))))))),be(H),fe(J,(([e],t)=>at(zs,t,e))),be(J)),bt(dt[0],void 0),r=-1,Zt(0),ge(H)||ts(0),$t(0),ge(J)||ss(0),u[1]?.(),bt(dt[1],void 0),u[2]?.(),r=0,a=fs(),l=Vs(),W([M,R,S,m,L,H,k,E,J,B],be))),zs),zs={getContent:()=>[ls(),gs()],getTables:ls,getTableIds:ns,getTable:e=>Re(pe(se,I(e))),getTableCellIds:rs,getRowCount:os,getRowIds:cs,getSortedRowIds:is,getRow:(e,t)=>Me(pe(pe(se,I(e)),I(t))),getCellIds:ds,getCell:us,getValues:gs,getValueIds:hs,getValue:bs,hasTables:fs,hasTable:Cs,hasTableCell:Ts,hasRow:vs,hasCell:ps,hasValues:Vs,hasValue:ws,getTablesJson:()=>rt(se),getValuesJson:()=>rt(re),getJson:()=>rt([se,re]),getTablesSchemaJson:()=>rt(U),getValuesSchemaJson:()=>rt(q),getSchemaJson:()=>rt([U,q]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>as((()=>{const t=O(e)?e():e;vt(t)&&(([e,t])=>{(te(e)?ms:ys)(e),(te(t)?Es:Is)(t)})(t)})),setTables:ys,setTable:(e,t)=>as((e=>pt(t,e)?Et(e,t):0),e),setRow:(e,t,s)=>as(((e,t)=>Vt(e,t,s)?Jt(e,At(e),t,s):0),e,t),addRow:(e,t,s=!0)=>xs((()=>{let a;return Vt(e,a,t)&&(e=I(e),Jt(e,At(e),a=((e,t)=>{const[s]=pe(X,e);let a;do{a=s(t)}while(ue(pe(se,e),a));return a})(e,s?1:0),t)),a})),setPartialRow:(e,t,s)=>as(((e,t)=>{if(Vt(e,t,s,1)){const a=At(e);ee(s,((s,l)=>xt(e,a,t,l,s)))}}),e,t),setCell:(e,t,s,a)=>as(((e,t,s)=>x(wt(e,t,s,O(a)?a(us(e,t,s)):a),(a=>xt(e,At(e),t,s,a)))),e,t,s),setValues:Is,setPartialValues:e=>as((()=>yt(e,1)?ee(e,((e,t)=>zt(t,e))):0)),setValue:(e,t)=>as((e=>x(It(e,O(t)?t(bs(e)):t),(t=>zt(e,t)))),e),applyChanges:e=>as((()=>{ee(e[0],((e,t)=>D(e)?Ls(t):ee(e,((e,s)=>D(e)?Hs(t,s):ee(e,((e,a)=>st(zs,t,s,a,e))))))),ee(e[1],((e,t)=>at(zs,t,e)))})),setTablesJson:Ms,setValuesJson:e=>{try{Ft(nt(e))}catch{}return zs},setJson:e=>as((()=>{try{const[t,s]=nt(e);Lt(t),Ft(s)}catch{Ms(e)}})),setTablesSchema:Rs,setValuesSchema:Ss,setSchema:(e,t)=>as((()=>{Rs(e),Ss(t)})),delTables:ms,delTable:Ls,delRow:Hs,delCell:(e,t,s,a)=>as(((e,t,s)=>x(pe(se,e),(l=>x(pe(l,t),(n=>ue(n,s)?jt(e,l,t,n,s,a):0))))),e,t,s),delValues:Es,delValue:e=>as((e=>ue(re,e)?kt(e):0),e),delTablesSchema:Js,delValuesSchema:Ds,delSchema:()=>as((()=>{Js(),Ds()})),transaction:xs,startTransaction:Fs,getTransactionChanges:()=>[Me(H,((e,t)=>-1===pe(M,t)?void 0:Me(e,((e,s)=>-1===pe(pe(m,t),s)?void 0:Me(e,(([,e])=>e),(e=>$e(e)))),ge,te)),ge,te),Me(J,(([,e])=>e),(e=>$e(e))),1],getTransactionLog:()=>[!ge(H),!ge(J),Se(H,Ze,$e),Se(k),Me(J,Ze,$e),Me(B),Me(M),Re(m),Se(L),Me(E)],finishTransaction:Os,forEachTable:e=>fe(se,((t,s)=>e(s,(e=>fe(t,((t,s)=>e(s,(e=>Ve(t,e))))))))),forEachTableCell:(e,t)=>Ve(pe($,I(e)),t),forEachRow:(e,t)=>fe(pe(se,I(e)),((e,s)=>t(s,(t=>Ve(e,t))))),forEachCell:(e,t,s)=>Ve(pe(pe(se,I(e)),I(t)),s),forEachValue:e=>Ve(re,e),addSortedRowIdsListener:(e,t,s,a,l,n,r)=>{let o=is(e,t,s,a,l);return ut((()=>{const r=is(e,t,s,a,l);var c,i,d;i=o,P(c=r)===P(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,n(zs,e,t,s,a,l,o))}),We[r?1:0],[e,t],[ns])},addStartTransactionListener:e=>ut(e,it),addWillFinishTransactionListener:e=>ut(e,dt[0]),addDidFinishTransactionListener:e=>ut(e,dt[1]),callListener:e=>(Ct(e),zs),delListener:e=>(ft(e),zs),getListenerStats:()=>({hasTables:Xe(he),tables:Xe(Je),tableIds:Xe(De),hasTable:Xe(xe),table:Xe(Fe),tableCellIds:Xe(Oe),hasTableCell:Xe(ze,ie),rowCount:Xe(Ae),rowIds:Xe(Pe),sortedRowIds:Xe(We),hasRow:Xe(je,ie),row:Xe(ke,ie),cellIds:Xe(Ne,ie),hasCell:Xe(Be,de),cell:Xe(Ue,de),invalidCell:Xe(_e,de),hasValues:Xe(Ge),values:Xe(tt),valueIds:Xe(lt),hasValue:Xe(ot),value:Xe(ct),invalidValue:Xe(qe),transaction:ce(it)+Xe(dt)}),isMergeable:()=>!1,createStore:ht,addListener:ut,callListeners:bt,setInternalListeners:(e,t,s,a,l)=>u=[e,t,s,a,l]};return ee({[d+h]:[0,he,[],()=>[fs()]],[h]:[0,Je],[b]:[0,De],[d+g]:[1,xe,[ns],e=>[Cs(...e)]],[g]:[1,Fe,[ns]],[g+p]:[1,Oe,[ns]],[d+g+v]:[2,ze,[ns,rs],e=>[Ts(...e)]],[C]:[1,Ae,[ns]],[T]:[1,Pe,[ns]],[d+f]:[2,je,[ns,cs],e=>[vs(...e)]],[f]:[2,ke,[ns,cs]],[p]:[2,Ne,[ns,cs]],[d+v]:[3,Be,[ns,cs,ds],e=>[ps(...e)]],[v]:[3,Ue,[ns,cs,ds],e=>Qe(us(...e))],InvalidCell:[3,_e],[d+w]:[0,Ge,[],()=>[Vs()]],[w]:[0,tt],[y]:[0,lt],[d+V]:[1,ot,[hs],e=>[ws(...e)]],[V]:[1,ct,[hs],e=>Qe(bs(e[0]))],InvalidValue:[1,qe]},(([e,t,s,a],l)=>{zs["add"+l+i]=(...l)=>ut(l[e],t[l[e+1]?1:0],e>0?A(l,0,e):void 0,s,a)})),Q(zs)},bt=2**36,ft=2**30,Ct=2**24,Tt=2**18,vt=4096,pt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Vt=(e=s)=>[Be(e),Be(e)];e.createMergeableStore=e=>{let t=1,a=Vt(),l=0;const n=Te(),r=le(),[o,c]=(e=>{let t=0,s=-1;const a=x(e,(e=>{const t=De(e);return it(t/Ct)+it(t/Tt)+it(t/vt)+it(t/64)+it(t)}),(()=>((e=16)=>k(ut(new Uint8Array(e)),((e,t)=>e+it(t)),""))(5))),l=e=>{const a=t,[l,n]=D(e)||""==e?[0,0]:[dt(r=e,0)*bt+dt(r,1)*ft+dt(r,2)*Ct+dt(r,3)*Tt+dt(r,4)*vt+64*dt(r,5)+dt(r,6),dt(r,7)*Tt+dt(r,8)*vt+64*dt(r,9)+dt(r,10)];var r;t=H(a,l,m.HLC_TIME??Date.now()),s=t==a?t==l?H(s,n):s:t==l?n:-1};return[()=>{return l(),n=++s,it((e=t)/bt)+it(e/ft)+it(e/Ct)+it(e/Tt)+it(e/vt)+it(e/64)+it(e)+it(n/Tt)+it(n/vt)+it(n/64)+it(n)+a;var e,n},l]})(e),d=ht(),u=e=>{const s=t;return t=0,e(),t=s,C},g=(e,t=0)=>{const l={},n={},[[r,o=s,i=0],d]=e,[u,g]=a,[b,f,C]=u;let T=t?i:C,v=o;$(r,(([e,a=s,n=0],r)=>{const o=ye(b,r,Be),[c,i,d]=o;let u=t?n:d,g=a;$(e,((e,s)=>{const[a,n,o]=h(e,ye(c,s,Be),se(se(l,r,X),s,X),t);u^=t?0:(n?Pe(s,n):0)^Pe(s,o),g=je(g,a)})),u^=t?0:We(i,a),ke(o,a,u),T^=t?0:(d?Pe(r,d):0)^Pe(r,o[2]),v=je(v,g)})),T^=t?0:We(f,o),ke(u,o,T);const[p]=h(d,g,n,t);return c(je(v,p)),[l,n,1]},h=(e,t,a,l)=>{const[n,r=s,o=0]=e,[c,i,d]=t;let u=r,g=l?o:d;return $(n,(([e,t,n=0],r)=>{const o=ye(c,r,(()=>[void 0,s,0])),[,i,d]=o;(!i||t>i)&&(ke(o,t,l?n:De(rt(e??null)+":"+t)),o[0]=e,a[r]=e,g^=l?0:Pe(r,d)^Pe(r,o[2]),u=je(u,t))})),g^=l?0:We(i,r),ke(t,r,g),[u,d,t[2]]},b=()=>[Ue(a[0],(e=>Ue(e,(e=>Ue(e))))),Ue(a[1])],f=e=>u((()=>d.applyChanges(g(e)))),C={getMergeableContent:b,getMergeableContentHashes:()=>[a[0][2],a[1][2]],getMergeableTableHashes:()=>Me(a[0][0],Ae),getMergeableTableDiff:e=>{const t=Ne(a[0][1]),s={};return Ve(a[0][0],((a,[l,n,r])=>Y(e,a)?r!=e[a]?s[a]=r:0:t[0][a]=_e([l,n],(e=>_e(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return $(e,((e,s)=>x(pe(a[0][0],s),(([a,,l])=>l!=e?Ve(a,((e,[,,a])=>se(t,s,X)[e]=a)):0)))),t},getMergeableRowDiff:e=>{const t=Ne(a[0][1]),s={};return $(e,((e,l)=>Ve(pe(a[0][0],l)?.[0],((a,[n,r,o])=>Y(e,a)?o!==e[a]?se(s,l,X)[a]=o:0:se(t[0],l,Ne)[0][a]=_e([n,r]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return $(e,((e,s)=>x(pe(a[0][0],s),(([a])=>$(e,((e,l)=>x(pe(a,l),(([a,,n])=>n!==e?Ve(a,((e,[,,a])=>se(se(t,s,X),l,X)[e]=a)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=a,l={};return $(e,((e,s)=>$(e,((e,a)=>x(pe(t,s),(([t,n])=>x(pe(t,a),(([t,r])=>Ve(t,((t,[o,c,i])=>i!==e[t]?se(se(l,s,(()=>Ne(n)))[0],a,(()=>Ne(r)))[0][t]=[o,c]:0)))))))))),Oe(l,s)},getMergeableValueHashes:()=>Me(a[1][0],Ae),getMergeableValueDiff:e=>{const[,[t,s]]=a,l=Me(t,xe,(([,,t],s)=>t==e?.[s]));return Oe(l,s)},setMergeableContent:e=>u((()=>(e=>z(e)&&2==P(e)&&qe(e[0],(e=>ae(e,(e=>qe(e,(e=>ae(e,(e=>qe(e,(e=>ae(e,(e=>qe(e,tt)),void 0,1)))),void 0,1)))),void 0,1)))&&qe(e[1],(e=>ae(e,(e=>qe(e,tt)),void 0,1))))(e)?d.transaction((()=>{d.delTables().delValues(),a=Vt(),d.applyChanges(g(e,1))})):0)),setDefaultContent:e=>(d.transaction((()=>{l=1,d.setContent(e),l=0})),C),getTransactionMergeableChanges:(e=!1)=>{const[[t,s,l],[o,c,i]]=a,d=e?ze:Oe,u={};fe(n,((e,s)=>x(pe(t,s),(([t,a,l])=>{const n={};fe(e,((e,s)=>x(pe(t,s),(([t,a,l])=>{const r={};fe(e,(e=>{x(pe(t,e),(([t,s,a])=>r[e]=d(t,s,a)))})),n[s]=d(r,a,l)})))),u[s]=d(n,a,l)}))));const g={};return fe(r,(e=>x(pe(o,e),(([t,s,a])=>g[e]=d(t,s,a))))),[d(u,s,l),d(g,c,i),1]},applyMergeableChanges:f,merge:e=>{const t=b(),s=e.getMergeableContent();return e.applyMergeableChanges(t),f(s)}};return d.setInternalListeners((()=>{}),(()=>{}),(()=>{be(n),be(r)}),((e,a,r,c)=>{ne(ye(ye(n,e,Te),a,le),r),t&&g([[{[e]:[{[a]:[{[r]:[c,l?s:o()]}]}]}],[{}],1])}),((e,a)=>{ne(r,e),t&&g([[{}],[{[e]:[a,l?s:o()]}],1])})),ee(d,((e,t)=>C[t]=M(t,"set")||M(t,"del")||M(t,"apply")||R(t,"Transaction")||t=="call"+i?(...t)=>(e(...t),C):M(t,"add")&&R(t,i)?(...s)=>{const a=pt[A(t,3,-8)]??0,l=s[a];return s[a]=(e,...t)=>l(C,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),Q(C)}},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseMergeableStore={});
