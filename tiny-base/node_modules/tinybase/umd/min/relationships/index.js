var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),o=e=>null==e,r=(e,t,n)=>o(e)?n?.():t(e),i=e=>Array.isArray(e),a=e=>e.length,d=(e,t)=>e.forEach(t),l=(e,...t)=>e.push(...t),c=Object.freeze,u=e=>t=>{return n=(t,n)=>t+e(n),g(t).reduce(n,0);var n},f=e=>e?.size??0,R=u(f),h=u(R),p=(e,t)=>e?.has(t)??!1,w=e=>o(e)||0==f(e),g=e=>[...e?.values()??[]],L=e=>e.clear(),I=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),y=e=>new Map(e),b=(e,t)=>e?.get(t),T=(e,t)=>I(e,((e,n)=>t(n,e))),m=(e,t,n)=>o(n)?(v(e,t),e):e?.set(t,n),k=(e,t,n,s)=>(p(e,t)?s?.(b(e,t)):m(e,t,n()),b(e,t)),E=(e,t,n,s,o=0)=>r((n?k:b)(e,t[o],o>a(t)-2?n:y),(r=>{if(o>a(t)-2)return s?.(r)&&m(e,t[o]),r;const i=E(r,t,n,s,o+1);return w(r)&&m(e,t[o]),i})),x=e=>new Set(i(e)||o(e)?e:[e]),S=(e,t)=>e?.add(t),j=/^\d+$/,z=(()=>{const e=new WeakMap;return u=>(e.has(u)||e.set(u,(e=>{const u=y(),f=y(),R=y(),z=y(),[A,D,M]=(()=>{let e;const[t,s]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{j.test(t)&&a(e)<1e3&&l(e,t)}]})(),i=y();return[(s,o,r,a=[],d=()=>[])=>{e??=Q;const l=t(1);return m(i,l,[s,o,r,a,d]),S(E(o,r??[n],x),l),l},(t,s,...o)=>d(((e,t=[n])=>{const s=[],o=(e,n)=>n==a(t)?l(s,e):null===t[n]?I(e,(e=>o(e,n+1))):d([t[n],null],(t=>o(b(e,t),n+1)));return o(e,0),s})(t,s),(t=>I(t,(t=>b(i,t)[0](e,...s??[],...o))))),e=>r(b(i,e),(([,t,o])=>(E(t,o??[n],void 0,(t=>(v(t,e),w(t)?1:0))),m(i,e),s(e),o))),t=>r(b(i,t),(([t,,n=[],s,r])=>{const i=(...l)=>{const c=a(l);c==a(n)?t(e,...l,...r(l)):o(n[c])?d(s[c]?.(...l)??[],(e=>i(...l,e))):i(...l,n[c])};i()}))]})(),[B,C,O,W,$,q,,,F,G,H,J]=((e,t,s,l,c)=>{const u=e.hasRow,f=y(),R=y(),h=y(),E=y(),j=y(),z=y(),A=(t,n,...s)=>{const o=k(z,t,x);return d(s,(t=>S(o,t)&&n&&e.callListener(t))),s},D=(t,...n)=>r(b(z,t),(s=>{d(0==a(n)?g(s):n,(t=>{e.delListener(t),v(s,t)})),w(s)&&m(z,t)})),M=(e,t)=>{m(f,e,t),p(R,e)||(m(R,e,[y(),y(),y(),y()]),m(E,e,y()),m(j,e,y()),c(h))},B=e=>{m(f,e),m(R,e),m(E,e),m(j,e),D(e),c(h)};return[()=>e,()=>{return e=f,[...e?.keys()??[]];var e},e=>T(R,e),e=>p(R,e),e=>b(f,e),e=>b(R,e),(e,t)=>m(R,e,t),M,(t,s,r,l,c)=>{M(t,s);const f=y(),R=y(),h=b(E,t),w=b(j,t),g=t=>{const r=n=>e.getCell(s,t,n),d=b(h,t),p=u(s,t)?(g=l(r,t),o(g)?void 0:g+n):void 0;var g,L,I,v;if(d===p||i(d)&&i(p)&&(I=p,a(L=d)===a(I)&&(v=(e,t)=>I[t]===e,L.every(v)))||m(f,t,[d,p]),!o(c)){const e=b(w,t),n=u(s,t)?c(r,t):void 0;e!=n&&m(R,t,n)}},v=e=>{r((()=>{I(f,(([,e],t)=>m(h,t,e))),I(R,((e,t)=>m(w,t,e)))}),f,R,h,w,e),L(f),L(R)};T(h,g),e.hasTable(s)&&d(e.getRowIds(s),(e=>{p(h,e)||g(e)})),v(!0),D(t),A(t,0,e.addRowListener(s,null,((e,t,n)=>g(n))),e.addTableListener(s,(()=>v())))},B,e=>l(e,h),()=>T(z,B),A,D]})(e,0,0,A,D),K=(e,t,n)=>r(q(e),(([s,,r])=>{if(!p(r,t)){const i=x();if($(e)!=P(e))S(i,t);else{let e=t;for(;!o(e)&&!p(i,e);)S(i,e),e=b(s,e)}if(n)return i;m(r,t,i)}return b(r,t)})),N=(e,t)=>r(q(e),(([,,e])=>m(e,t))),P=e=>b(u,e),Q={setRelationshipDefinition:(e,i,a,d)=>{return m(u,e,a),F(e,i,((t,n)=>{const s=x(),i=x(),a=x(),[d,l]=q(e);I(n,(([t,n],c)=>{o(t)||(S(i,t),r(b(l,t),(e=>{v(e,c),w(e)&&m(l,t)}))),o(n)||(S(i,n),p(l,n)||m(l,n,x()),S(b(l,n),c)),S(s,c),m(d,c,n),T(b(z,e),(t=>{p(K(e,t),c)&&S(a,t)}))})),t(),I(s,(t=>D(f,[e,t]))),I(i,(t=>D(R,[e,t]))),I(a,(t=>{N(e,t),D(z,[e,t])}))}),t(l=d)==s?e=>e(l):l??(()=>n)),Q;var l},delRelationshipDefinition:e=>(m(u,e),G(e),Q),getStore:B,getRelationshipIds:C,forEachRelationship:t=>O((n=>t(n,(t=>e.forEachRow($(n),t))))),hasRelationship:W,getLocalTableId:$,getRemoteTableId:P,getRemoteRowId:(e,t)=>b(q(e)?.[0],t),getLocalRowIds:(e,t)=>g(b(q(e)?.[1],t)),getLinkedRowIds:(e,t)=>o(q(e))?[t]:g(K(e,t,!0)),addRelationshipIdsListener:H,addRemoteRowIdListener:(e,t,n)=>A(n,f,[e,t]),addLocalRowIdsListener:(e,t,n)=>A(n,R,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(K(e,t),A(n,z,[e,t])),delListener:e=>(N(...M(e)??[]),Q),destroy:J,getListenerStats:()=>({remoteRowId:h(f),localRowIds:h(R),linkedRowIds:h(z)})};return c(Q)})(u)),e.get(u))})();e.createRelationships=z},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
