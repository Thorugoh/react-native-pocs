var e,n;e=this,n=function(e){"use strict";const n=e=>null==e,t=(e,t,s)=>n(e)?s?.():t(e),s=(e,n,t)=>e.slice(n,t),o=Object.freeze,r=(e,n)=>e?.delete(n),c=e=>new Map(e),i=(e,n)=>e?.get(n),a=(e,t,s)=>n(s)?(r(e,t),e):e?.set(t,s),f=/\/([^?]*)/;e.createWsServerSimple=e=>{const l=c();return e.on("connection",((e,o)=>{return t((d=o.url,u=f,d?.match(u)),(([,f])=>t(o.headers["sec-websocket-key"],(async t=>{const o=(p=c,y=d=l,h=u=f,y?.has(h)||a(d,u,p()),i(d,u));var d,u,p,y,h;a(o,t,e),e.on("message",(e=>(e=>{const n=e.indexOf("\n");-1!==n&&((e,n)=>{const s=((e,n)=>e+"\n"+n)(t,n);""===e?(e=>{((e,n)=>{e?.forEach(n)})(e,((e,n)=>{return o=e,n!==t?o.send(s):0;var o}))})(o):i(o,e)?.send(s)})(s(e,0,n),s(e,n+1))})(e.toString("utf8")))),e.on("close",(()=>{r(o,t),(e=>n(e)||0==(e=>e?.size??0)(e))(o)&&r(l,f)}))}))));var d,u})),o({getWebSocketServer:()=>e,destroy:()=>{l.clear(),e.close()}})}},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseSynchronizerWsServerSimple={});
